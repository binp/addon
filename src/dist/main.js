/*! For license information please see main.js.LICENSE.txt */
var helloWorld;(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(){var e=Object.defineProperty,t=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(n,i){if(i)e:{var r=t;n=n.split(".");for(var s=0;s<n.length-1;s++){var o=n[s];if(!(o in r))break e;r=r[o]}(i=i(s=r[n=n[n.length-1]]))!=s&&null!=i&&e(r,n,{configurable:!0,writable:!0,value:i})}}("Symbol.dispose",(function(e){return e||Symbol("Symbol.dispose")}));var n,i,r=this||self;function s(e,t){function n(){}n.prototype=t.prototype,e.qa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.oa=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function o(e,t){if(Error.captureStackTrace)Error.captureStackTrace(this,o);else{const e=Error().stack;e&&(this.stack=e)}e&&(this.message=String(e)),void 0!==t&&(this.cause=t)}function a(e){r.setTimeout((()=>{throw e}),0)}s(o,Error),o.prototype.name="CustomError";e:{for(var c=["CLOSURE_FLAGS"],l=r,h=0;h<c.length;h++)if(null==(l=l[c[h]])){i=null;break e}i=l}var u,d=i&&i[610401301];n=null!=d&&d;const p=r.navigator;function f(e){return!!n&&!!u&&u.brands.some((({brand:t})=>t&&-1!=t.indexOf(e)))}function g(e){var t;return(t=r.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}function m(){return!!n&&!!u&&u.brands.length>0}function _(){return m()?f("Chromium"):(g("Chrome")||g("CriOS"))&&!(!m()&&g("Edge"))||g("Silk")}function y(e,t){(t=Array.prototype.indexOf.call(e,t,void 0))>=0&&Array.prototype.splice.call(e,t,1)}function v(e){let t="",n=0;const i=e.length-10240;for(;n<i;)t+=String.fromCharCode.apply(null,e.subarray(n,n+=10240));return t+=String.fromCharCode.apply(null,n?e.subarray(n):e),btoa(t)}u=p&&p.userAgentData||null,!g("Android")||_(),_(),g("Safari")&&(_()||!m()&&g("Coast")||!m()&&g("Opera")||!m()&&g("Edge")||(m()?f("Microsoft Edge"):g("Edg/"))||m()&&f("Opera"));const w=/[-_.]/g,I={"-":"+",_:"/",".":"="};function b(e){return I[e]||""}function C(e){return null!=e&&e instanceof Uint8Array}var T={};function E(){return k||(k=new S(null,T))}var S=class{constructor(e,t){if(N(t),this.g=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}};let k,P;function N(e){if(e!==T)throw Error("illegal external caller")}function R(e,t){e.__closure__error__context__984382||(e.__closure__error__context__984382={}),e.__closure__error__context__984382.severity=t}function A(){const e=Error();R(e,"incident"),a(e)}function O(e){return R(e=Error(e),"warning"),e}function x(){return"function"==typeof BigInt}function D(e){return Array.prototype.slice.call(e)}function L(e,t){return t&&Symbol.for&&e?Symbol.for(e):null!=e?Symbol(e):Symbol()}var M=L("jas",!0);L();var U=L(),F=L();function j(e,t){t[M]=-30975&e}function q(e,t){t[M]=-30941&e|34}L(),L();var $,W={},V={};function B(e){return!(!e||"object"!=typeof e||e.g!==V)}function H(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&e.constructor===Object}function z(e,t){if(null!=e)if("string"==typeof e)e=e?new S(e,T):E();else if(e.constructor!==S)if(C(e))e=e.length?new S(new Uint8Array(e),T):E();else{if(!t)throw Error();e=void 0}return e}function K(e){return!(!Array.isArray(e)||e.length||!(1&e[M]))}const G=[];function Y(e){if(2&e)throw Error()}G[M]=55,$=Object.freeze(G);var J=Object.freeze({});function Q(e){return e.pa=!0,e}var X=Q((e=>"number"==typeof e)),Z=Q((e=>"string"==typeof e)),ee=Q((e=>"boolean"==typeof e)),te="function"==typeof r.BigInt&&"bigint"==typeof r.BigInt(0),ne=Q((e=>te?e>=re&&e<=oe:"-"===e[0]?ae(e,ie):ae(e,se)));const ie=Number.MIN_SAFE_INTEGER.toString(),re=te?BigInt(Number.MIN_SAFE_INTEGER):void 0,se=Number.MAX_SAFE_INTEGER.toString(),oe=te?BigInt(Number.MAX_SAFE_INTEGER):void 0;function ae(e,t){if(e.length>t.length)return!1;if(e.length<t.length||e===t)return!0;for(let n=0;n<e.length;n++){const i=e[n],r=t[n];if(i>r)return!1;if(i<r)return!0}}let ce=0,le=0;function he(e){const t=e>>>0;ce=t,le=(e-t)/4294967296>>>0}function ue(e){if(e<0){he(-e);const[t,n]=fe(ce,le);ce=t>>>0,le=n>>>0}else he(e)}function de(e,t){if(e>>>=0,(t>>>=0)<=2097151)var n=""+(4294967296*t+e);else x()?n=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(e=(16777215&e)+6777216*(n=16777215&(e>>>24|t<<8))+6710656*(t=t>>16&65535),n+=8147497*t,t*=2,e>=1e7&&(n+=e/1e7>>>0,e%=1e7),n>=1e7&&(t+=n/1e7>>>0,n%=1e7),n=t+pe(n)+pe(e));return n}function pe(e){return e=String(e),"0000000".slice(e.length)+e}function fe(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function ge(e){return null==e||"boolean"==typeof e?e:"number"==typeof e?!!e:void 0}const me=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function _e(e){const t=typeof e;switch(t){case"bigint":return!0;case"number":return Number.isFinite(e)}return"string"===t&&me.test(e)}function ye(e){if(null!=e){if(!Number.isFinite(e))throw O("enum");e|=0}return e}function ve(e){if(null!=e){if("string"==typeof e){if(!e)return;e=+e}"number"==typeof e&&Number.isFinite(e)}}function we(e){if(null!=e)e:{if(!_e(e))throw O("int64");switch(typeof e){case"string":e=be(e);break e;case"bigint":var t=e=BigInt.asIntN(64,e);if(Z(t)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(t))throw Error(String(t))}else if(X(t)&&!Number.isSafeInteger(t))throw Error(String(t));e=te?BigInt(e):ee(e)?e?"1":"0":Z(e)?e.trim()||"0":String(e);break e;default:e=Ie(e)}}return e}function Ie(e){if(e=Math.trunc(e),!Number.isSafeInteger(e)){ue(e);var t=ce,n=le;(e=2147483648&n)&&(n=~n>>>0,0==(t=1+~t>>>0)&&(n=n+1>>>0));const i=4294967296*n+(t>>>0);e="number"==typeof(t=Number.isSafeInteger(i)?i:de(t,n))?e?-t:t:e?"-"+t:t}return e}function be(e){var t=Math.trunc(Number(e));if(Number.isSafeInteger(t))return String(t);if(-1!==(t=e.indexOf("."))&&(e=e.substring(0,t)),!("-"===e[0]?e.length<20||20===e.length&&Number(e.substring(0,7))>-922337:e.length<19||19===e.length&&Number(e.substring(0,6))<922337)){if(e.length<16)ue(Number(e));else if(x())e=BigInt(e),ce=Number(e&BigInt(4294967295))>>>0,le=Number(e>>BigInt(32)&BigInt(4294967295));else{t=+("-"===e[0]),le=ce=0;const n=e.length;for(let i=t,r=(n-t)%6+t;r<=n;i=r,r+=6){const t=Number(e.slice(i,r));le*=1e6,ce=1e6*ce+t,ce>=4294967296&&(le+=Math.trunc(ce/4294967296),le>>>=0,ce>>>=0)}if(t){const[e,t]=fe(ce,le);ce=e,le=t}}if(e=ce,2147483648&(t=le))if(x())e=""+(BigInt(0|t)<<BigInt(32)|BigInt(e>>>0));else{const[n,i]=fe(e,t);e="-"+de(n,i)}else e=de(e,t)}return e}function Ce(e){if(null!=e&&"string"!=typeof e)throw Error();return e}function Te(e,t,n){if(null!=e&&"object"==typeof e&&e.H===W)return e;if(Array.isArray(e)){var i=0|e[M],r=i;return 0===r&&(r|=32&n),(r|=2&n)!==i&&(e[M]=r),new t(e)}}let Ee,Se,ke,Pe,Ne,Re;function Ae(e){let t;return null==(t=Ee)?void 0:t.get(e)}function Oe(e){try{return-1!==e.toString().indexOf("[native code]")?e:null}catch{return null}}function xe(e,t){return De(t)}function De(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return ne(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(K(e))return}else{if(C(e))return v(e);if(e instanceof S){const t=e.g;return null==t?"":"string"==typeof t?t:e.g=v(t)}}}return e}function Le(e,t,n,i,r){if(null!=e){if(Array.isArray(e))e=K(e)?void 0:r&&2&e[M]?e:Me(e,t,n,void 0!==i,r);else if(H(e)){const s={};for(let o in e)s[o]=Le(e[o],t,n,i,r);e=s}else e=t(e,i);return e}}function Me(e,t,n,i,r){const s=i||n?0|e[M]:0;i=i?!!(32&s):void 0,e=D(e);for(let s=0;s<e.length;s++)e[s]=Le(e[s],t,n,i,r);return n&&n(s,e),e}function Ue(e){return e.H===W?e.toJSON():De(e)}function Fe(e,t,n=q){if(null!=e){if(e instanceof Uint8Array)return t?e:new Uint8Array(e);if(Array.isArray(e)){var i=0|e[M];return 2&i?e:(t&&(t=0===i||!!(32&i)&&!(64&i||!(16&i))),t?(e[M]=-12293&i|34,e):Me(e,Fe,4&i?q:n,!0,!0))}return e.H===W&&(e=2&(i=(n=e.m)[M])?e:new e.constructor(je(n,i,!0))),e}}function je(e,t,n){const i=n||2&t?q:j,r=!!(32&t);return e=function(e,t,n){var i=(e=D(e)).length;const r=256&t?e[i-1]:void 0;for(i+=r?-1:0,t=512&t?1:0;t<i;t++)e[t]=n(e[t]);if(r){t=e[t]={};for(const e in r)t[e]=n(r[e])}return e}(e,t,(e=>Fe(e,r,i))),e[M]=32|e[M]|(n?2:0),e}function qe(e){const t=e.m,n=t[M];return 2&n?new e.constructor(je(t,n,!1)):e}function $e(e,t){return Ve(e=e.m,e[M],t)}function We(e,t,n,i){if(!((t=i+(+!!(512&t)-1))<0||t>=e.length||t>=n))return e[t]}function Ve(e,t,n,i){if(-1===n)return null;const r=t>>15&1023||536870912;if(!(n>=r)){var s,o=e.length;return i&&256&t&&null!=(i=e[o-1][n])?(We(e,t,r,n)&&null!=U&&(e=null!=(s=P)?s:P={},(s=e[U]||0)>=4||(e[U]=s+1,A())),i):We(e,t,r,n)}return 256&t?e[e.length-1][n]:void 0}function Be(e,t,n){const i=e.m;let r=i[M];return Y(r),He(i,r,t,n),e}function He(e,t,n,i){const r=t>>15&1023||536870912;if(n>=r){let s,o=t;if(256&t)s=e[e.length-1];else{if(null==i)return o;s=e[r+(+!!(512&t)-1)]={},o|=256}return s[n]=i,n<r&&(e[n+(+!!(512&t)-1)]=void 0),o!==t&&(e[M]=o),o}return e[n+(+!!(512&t)-1)]=i,256&t&&n in(e=e[e.length-1])&&delete e[n],t}function ze(e,t,n,i){return void 0!==Xe(e,t,n=Ye(e,i)===n?n:-1)}function Ke(e){return!!(2&e)&&!!(4&e)||!!(2048&e)}function Ge(e,t,n,i){const r=e.m;let s=r[M];return Y(s),He(r,s,t,("0"===i?0===Number(n):n===i)?void 0:n),e}function Ye(e,t){return Qe(Je(e=e.m),e,e[M],t)}function Je(e){let t;return null!=(t=e[F])?t:e[F]=new Map}function Qe(e,t,n,i){let r=e.get(i);if(null!=r)return r;r=0;for(let e=0;e<i.length;e++){const s=i[e];null!=Ve(t,n,s)&&(0!==r&&(n=He(t,n,r)),r=s)}return e.set(i,r),r}function Xe(e,t,n,i){let r=(e=e.m)[M];return(t=Te(i=Ve(e,r,n,i),t,r))!==i&&null!=t&&He(e,r,n,t),t}function Ze(e,t,n){if(null==(t=Xe(e,t,n,!1)))return t;let i=(e=e.m)[M];if(!(2&i)){const r=qe(t);r!==t&&He(e,i,n,t=r)}return t}function et(e,t,n){return null==n&&(n=void 0),Be(e,t,n)}function tt(e,t,n,i){null==i&&(i=void 0);e:{const o=e.m;var r=o[M];if(Y(r),null==i){var s=Je(o);if(Qe(s,o,r,n)!==t)break e;s.set(n,0)}else{const e=Je(s=o),i=Qe(e,s,r,n);i!==t&&(i&&(r=He(s,r,i)),e.set(n,t))}He(o,r,t,i)}return e}function nt(e,t){const n=e.m;let i=n[M];if(Y(i),null==t)return He(n,i,1),e;var r,s=t;t=(null==(r=Se)?void 0:r.get(s))||s,r=s=0|t[M];const o=Ke(s),a=o||Object.isFrozen(t);let c=!0,l=!0;for(let e=0;e<t.length;e++){var h=t[e];o||(h=!!(2&h.m[M]),c&&(c=!h),l&&(l=h))}return o||(s=c?13:5,s=l?16|s:-17&s),a&&s===r||(t=D(t),r=0,s=rt(s=it(s,i),i,!0)),s!==r&&(t[M]=s),He(n,i,1,t),e}function it(e,t){return-2049&(2&t?2|e:-3&e)|32}function rt(e,t,n){return 32&t&&n||(e&=-33),e}function st(e,t){return null!=e?e:t}function ot(e){return null!=(e=$e(e,1))&&("bigint"==typeof e?ne(e)?e=Number(e):(e=BigInt.asIntN(64,e),e=ne(e)?Number(e):String(e)):e=_e(e)?"number"==typeof e?Ie(e):be(e):void 0),st(e,0)}function at(e,t){return st(null==(e=$e(e,t))||"string"==typeof e?e:void 0,"")}function ct(e,t){return st(e=null==(e=$e(e,t))?e:Number.isFinite(e)?0|e:void 0,0)}function lt(e,t,n,i){return Ze(e,t,n=Ye(e,i)===n?n:-1)}function ht(e){try{return Re=!0,JSON.stringify(dt(e),xe)}finally{Re=!1}}var ut=class{constructor(e){e:{var t=null!=t?t:0;if(null==e){var n=96;e=[]}else{if(!Array.isArray(e))throw Error("narr");if(2048&(n=0|e[M]))throw Error("farr");if(64&n)break e;1===t||2===t||(n|=64);var i=(t=e).length;if(i&&H(t[--i])){if((t=i-(+!!(512&(n|=256))-1))>=1024)throw Error("pvtlmt");n=-33521665&n|(1023&t)<<15}}e[M]=n}this.m=e}toJSON(){return dt(this)}};function dt(e){e=e.m,e=Re?e:Me(e,Ue,void 0,void 0,!1);{var t=!Re;let l=e.length;if(l){var n=e[l-1],i=H(n);i?l--:n=void 0;var r=e;if(i){e:{var s,o=n,a=!1;if(o)for(let e in o)if(isNaN(+e)){let t;(null!=(t=s)?t:s={})[e]=o[e]}else if(i=o[e],Array.isArray(i)&&(K(i)||B(i)&&0===i.size)&&(i=null),null==i&&(a=!0),null!=i){let t;(null!=(t=s)?t:s={})[e]=i}if(a||(s=o),s)for(let e in s){a=s;break e}a=null}o=null==a?null!=n:a!==n}for(;l>0&&(null==(s=r[l-1])||K(s)||B(s)&&0===s.size);l--)var c=!0;(r!==e||o||c)&&(t?(c||o||a)&&(r.length=l):r=Array.prototype.slice.call(r,0,l),a&&r.push(a)),c=r}else c=e}return c}function pt(e){return t=>{if(null==t||""==t)t=new e;else{if(t=JSON.parse(t),!Array.isArray(t))throw Error("dnarr");t[M]|=32,t=new e(t)}return t}}ut.prototype.H=W,ut.prototype.toString=function(){try{return Re=!0,dt(this).toString()}finally{Re=!1}};var ft,gt=(ft=class extends ut{},e=>{if(e=JSON.parse(e),!Array.isArray(e)){var t=typeof e;throw Error("Expected jspb data to be an array, got "+("object"!=t?t:e?Array.isArray(e)?"array":t:"null")+": "+e)}return e[M]|=34,new ft(e)}),mt=class extends ut{};function _t(e){return yt(e,e.index)>=e.g&&(e.h[e.index]=Date.now(),e.index=(e.index+1)%1,!0)}function yt(e,t){let n;return Date.now()-(null!=(n=e.h[t])?n:-1*e.g)}var vt=class{constructor(e){this.g=e,this.h=[],this.index=0}},wt=class extends ut{},It=[2,3],bt=class extends ut{},Ct=class extends Error{constructor({errorType:e,message:t,i:n}){super(`Meet Add-on SDK error: ${t}${n?` - ${n}`:""}`),this.errorType=e}},Tt={errorType:"InternalError",message:"An unexpected error has occurred.",i:"No further information is available."},Et={errorType:"MissingUrlParameter",message:"Missing required Meet SDK URL parameter",i:"This parameter is automatically appended by Meet to the iframe URL. Ensure that your infrastructure does not strip URL parameters (e.g. as part of a redirect)."},St={errorType:"NeedsMainStageContext",message:"This method can only be invoked if the addon is running in the main stage.",i:"Use getFrameType to check whether the addon is running in the main stage before invoking this method."},kt={errorType:"NeedsSidePanelContext",message:"This method can only be invoked if the addon is running in the side panel.",i:"Use getFrameType to check whether the addon is running in the side panel before invoking this method."},Pt={errorType:"NotSupportedInStandalone",message:"This method is not supported in standalone mode.",i:"Do not call this method in standalone mode."},Nt={errorType:"InternalError",message:"The frame type URL parameter is set to an unexpected value.",i:"This parameter is automatically appended by Meet to the iframe URL. Ensure that your infrastructure does not modify URL parameters (e.g. as part of a redirect)."},Rt={errorType:"InvalidCloudProjectNumber",message:"Cloud Project Number provided by meet does not match the one passed in by the SDK. Ensure that the correct Cloud Project Number is passed to the SDK as a string.",i:"This parameter is automatically appended by Meet to the iframe URL. Ensure that your infrastructure does not modify URL parameters (e.g. as part of a redirect) and ensure that the correct Cloud Project Number was passed into the SDK as a string."},At={errorType:"DestinationNotReady",message:"The recipient frame is not connected via the addon SDK and cannot receive the notification.",i:"Make sure the destination frame has connected before sending messages to it."},Ot={errorType:"InvalidActivityStartingState",message:"Origin of the ActivityStartingState iframeURLs does not match the origin of the URLs provided in the Add-on manifest.",i:"Ensure that the ActivityStartingState iframeURL origins match the origins of the URLs provided in the Add-on manifest."},xt={errorType:"ActivityStartingStateMissingAttributes",message:"The supplied ActivityStartingState object does not contain any recognized attributes.",i:"Ensure that the ActivityStartingState object contains at least one of the following attributes: mainStageUrl, sidePanelUrl, additionalData."},Dt={errorType:"ActivityStartingStateUnrecognizedAttributes",message:"The supplied ActivityStartingState object contains attributes that are not recognized.",i:"Ensure that the ActivityStartingState object has only the following attributes: mainStageUrl, sidePanelUrl, additionalData."},Lt={errorType:"AddonStartingStateMissingAttributes",message:"The supplied AddonStartingState object does not contain any recognized attributes.",i:"Ensure that the AddonStartingState object contains at least one of the following attributes: sidePanelUrl, additionalData."},Mt={errorType:"AddonStartingStateUnrecognizedAttributes",message:"The supplied AddonStartingState object contains attributes that are not recognized.",i:"Ensure that the AddonStartingState object has only the following attributes: sidePanelUrl, additionalData."},Ut=e=>({errorType:"ArgumentNullError",message:`The argument supplied for '${e}' was 'null' but a value was expected.`,i:"Ensure you are passing a value of the expected type for the argument."}),Ft=(e,t,n)=>({errorType:"ArgumentTypeError",message:`The type '${t}' of argument supplied for '${e}' did not match the expected type '${n}'.`,i:"Ensure the type of the argument provided matches the expected type."}),jt={errorType:"ActivityIsOngoing",message:"Operation cannot be performed while an activity is ongoing.",i:"Ensure that no activity is ongoing."},qt={errorType:"InternalError",message:"Frame message missing required Meet SDK command.",i:"Send one of the available commands in the frame message."},$t={errorType:"NoActivityFound",message:"No activity found.",i:"Ensure that the activity is started before performing this operation."},Wt={errorType:"RequiresEapEnrollment",message:"This feature is only available to early access partners.",i:"Meet add-on early access enrollment is currently closed."},Vt={errorType:"UserNotInitiator",message:"Operation cannot be performed because the user is not the initiator of the current activity.",i:"Ensure that the user is the initiator of the current activity or that the activity has ended."},Bt={errorType:"SizeLimitExceededActivityStartingState",message:"The size of the activityStartingState URLs and/or its data exceed the limits allowed.",i:"Ensure that the activityStartingState URL size is less than 512 characters and the additional data size is less than 4096 characters."},Ht={errorType:"SizeLimitExceededFrameToFrameMessage",message:"The size of the frame to frame message exceeds the limits allowed.",i:"Ensure that the frame to frame message size is less than 1,000,000 characters."},zt={errorType:"AddonSessionAlreadyCreated",message:"The addon session has already been created.",i:"Only instantiate the AddonSession once."},Kt={errorType:"UserCancelled",message:"The user cancelled starting an activity.",i:"The user needs to click continue to start the activity."},Gt={errorType:"NotSupportedInMeetCall",message:"This method is not supported during a Meet call.",i:"Do not call this method during a Meet call."},Yt={errorType:"InvalidAddonStartingState",message:"Origin of the AddonStartingState iframeURLs does not match the origin of the URLs provided in the Add-on manifest.",i:"Ensure that the AddonStartingState iframeURL origins match the origins of the URLs provided in the Add-on manifest."},Jt={errorType:"SizeLimitExceededAddonStartingState",message:"The size of the AddonStartingState URLs and/or its data exceed the limits allowed.",i:"Ensure that the AddonStartingState URL size is less than 512 characters and the additional data size is less than 4096 characters."},Qt={errorType:"MeetingPolicyPreventsStartingActivity",message:"A meeting policy (such as using host control settings) prevents the user from starting the activity.",i:"Have a meeting host or administrator modify the necessary settings to allow the current user to start the activity."};function Xt({errorType:e,message:t,i:n},i=""){throw new Ct({errorType:e,message:i?`${t} ${i}`:t,i:n})}function Zt(e,t){Xt({...Et,message:`${Et.message}: ${e}. In URL ${t}`})}function en(e){return Ge(new rn,1,ye(e),0)}function tn(e,t){return Ge(e,2,Ce(t),"")}function nn(e,t){return Ge(e,3,Ce(t),"")}var rn=class extends ut{getFrameType(){return ct(this,1)}};function sn(e){var t;t=void 0===J?2:4;var n=e.m[M],i=n,r=!(2&n),s=rn;t=(n=!!(2&i))?1:t,r&&(r=!n),n=Ve(e=e.m,i,1);var o=0|(n=Array.isArray(n)?n:$)[M],a=!!(4&o);if(!a){var c=o;0===c&&(c=it(c,i)),o=n;var l=i;const e=!!(2&(c|=1));e&&(l|=2);let t=!e,r=!0,a=0,h=0;for(;a<o.length;a++){const n=Te(o[a],s,l);if(n instanceof s){if(!e){const e=!!(2&n.m[M]);t&&(t=!e),r&&(r=e)}o[h++]=n}}h<a&&(o.length=h),c|=4,c=r?16|c:-17&c,c=t?8|c:-9&c,o[M]=c,e&&Object.freeze(o),o=c}if(r&&!(8&o||!n.length&&(1===t||4===t&&32&o))){for(Ke(o)&&(n=D(n),o=it(o,i),i=He(e,i,1,n)),r=n,s=o,o=0;o<r.length;o++)(c=r[o])!==(l=qe(c))&&(r[o]=l);s|=8,s=r.length?-17&s:16|s,o=r[M]=s}let h;if(1===t||4===t&&32&o){if(!Ke(o)){i=o;var u=!!(32&o);(o|=!n.length||16&o&&(!a||u)?2:2048)!==i&&(n[M]=o),Object.freeze(n)}}else a=5===t&&(!!(32&o)||Ke(o)||!!Ae(n)),(2===t||a)&&Ke(o)&&(n=D(n),o=rt(o=it(o,i),i,!1),n[M]=o,i=He(e,i,1,n)),Ke(o)||(e=o,(o=rt(o,i,!1))!==e&&(n[M]=o)),a?h=function(e){var t;return void 0===ke&&(ke="function"==typeof Proxy?Oe(Proxy):null),(t=!ke)||(void 0===Pe&&(Pe="function"==typeof WeakMap?Oe(WeakMap):null),t=!Pe),t?e:(t=Ae(e))?t:Math.random()>.01?e:(function(e){if(void 0===Ne){const e=new ke([],{});Ne=1===Array.prototype.concat.call([],e).length}Ne&&"function"==typeof Symbol&&Symbol.isConcatSpreadable&&(e[Symbol.isConcatSpreadable]=!0)}(e),function(e,t){(Ee||(Ee=new Pe)).set(e,t),(Se||(Se=new Pe)).set(t,e)}(e,t=new ke(e,{set:(e,t,n)=>(A(),e[t]=n,!0)})),t)}(n):2===t&&(null==(u=Ee)||u.delete(n));return h||n}function on(e){return nt(new an,e)}var an=class extends ut{},cn=class extends ut{};function ln(e){return Ge(new hn,1,ye(e),0)}var hn=class extends ut{},un=class extends ut{},dn=class extends ut{},pn=class extends ut{},fn=class extends ut{getMeetingInfo(){return lt(this,pn,3,gn)}getMeetPlatformInfo(){return lt(this,dn,4,gn)}},gn=[2,3,4,5],mn=class extends ut{},_n=[1,4,5,6,7,8,9,10,11,12,13,14,15,16,17],yn=class extends ut{},vn=class extends ut{},wn=new Map([[2,"MAIN_STAGE"],[1,"SIDE_PANEL"]]),In=new Map([[0,"UNKNOWN"],[1,"OPEN_ADDON"],[2,"START_ACTIVITY"],[3,"JOIN_ACTIVITY"]]);function bn(e){e&&"function"==typeof e.dispose&&e.dispose()}function Cn(){this.s=this.s,this.g=this.g}function Tn(e,t){e.s?t():(e.g||(e.g=[]),e.g.push(t))}function En({J:e,R:t}){if(null===e)throw new Ct(Ut("activityStartingState"));if(t||void 0!==e){if("object"!=typeof e)throw new Ct(Ft("activityStartingState",typeof e,"object"+(t?"":" | undefined")));if(void 0!==e.mainStageUrl&&"string"!=typeof e.mainStageUrl)throw new Ct(Ft("mainStageUrl",typeof e.mainStageUrl,"string | undefined"));if(void 0!==e.sidePanelUrl&&"string"!=typeof e.sidePanelUrl)throw new Ct(Ft("sidePanelUrl",typeof e.sidePanelUrl,"string | undefined"));if(void 0!==e.additionalData&&"string"!=typeof e.additionalData)throw new Ct(Ft("additionalData",typeof e.additionalData,"string | undefined"));if(Object.keys(e).length!==+!!e.mainStageUrl+ +!!e.sidePanelUrl+ +!!e.additionalData)throw new Ct(Dt);if(0===Object.keys(e).length)throw new Ct(xt)}}function Sn(e){const t=[];return t.push(nn(tn(en(2),e.mainStageUrl),e.additionalData)),t.push(nn(tn(en(1),e.sidePanelUrl),e.additionalData)),t}Cn.prototype.s=!1,Cn.prototype.dispose=function(){this.s||(this.s=!0,this.G())},Cn.prototype[Symbol.dispose]=function(){this.dispose()},Cn.prototype.G=function(){if(this.g)for(;this.g.length;)this.g.shift()()};var kn=class extends Cn{constructor(e){super(),this.context=e,this.h={},Ai(this.context.g.U,(e=>{if(7===Ye(e.content,_n)){const n=this.h.frameToFrameMessage;if(e=lt(e.content,un,7,_n),n&&e){var t=ct(e,1);if(void 0===(t=wn.get(t)))throw Error("Unknown frame type.");n({originator:t,payload:at(e,2)})}}}))}async getMeetingInfo(){const e=await Yi(this.context.g,ln(2));return{meetingId:at(e.getMeetingInfo(),1),meetingCode:at(e.getMeetingInfo(),2)}}async getFrameOpenReason(){let e;const t=null!=(e=this.context.h.ca)?e:0;let n;return null!=(n=In.get(t))?n:"UNKNOWN"}async getActivityStartingState(){var e=lt(await Yi(this.context.g,ln(1)),an,2,gn);const t=null==e?void 0:sn(e).find((e=>2===e.getFrameType()));return e=null==e?void 0:sn(e).find((e=>1===e.getFrameType())),{mainStageUrl:(null==t?void 0:at(t,2))||void 0,sidePanelUrl:(null==e?void 0:at(e,2))||void 0,additionalData:(null==e?void 0:at(e,3))||void 0}}async setActivityStartingState(e){En({J:e,R:!0});var t=Sn(e);e=Ji;var n=this.context.g,i=new yn;i=et(i,1,t=on(t)),await e(n,i)}on(e,t){this.h[e]=t}async getMeetPlatformInfo(){return{isMeetHardware:st(ge($e((await Yi(this.context.g,ln(3))).getMeetPlatformInfo(),1)),!1)}}async closeAddon(){await async function(e){var t=Xi,n=new $n,i=new Rn;n=tt(n,11,Wn,i),await t(e,Fi(n))}(this.context.g)}async startActivity(e){En({J:e,R:!1});const t=new vn;e&&et(t,1,e=on(e=Sn(e))),await async function(e,t){var n=Xi;t=tt(new $n,14,Wn,t),await n(e,Fi(t))}(this.context.g,t)}async endActivity(e){var t=Qi,n=this.context.g;e=Ge(new cn,1,ye("aab61ee0-51b4-475d-aa4d-849f2498640d"===e?999:0),0),await t(n,e)}},Pn=pt(class extends ut{getFrameOpenReason(){return ct(this,5)}});function Nn(){var e=window.location.href,t=window.location.href,n=new URL(t).searchParams.get("meet_sdk");if(n?t=Pn(atob(n)):(Zt("meet_sdk",t),t=void 0),(n=at(t,1))||Zt("meet_addon_frame_type",e),2!==(n=Number(n))&&1!==n)throw new Ct(Nt);const i=at(t,2);i||Zt("meet_control_channel_name",e);const r=at(t,4);var s;return r||Zt("addon_cloud_project_number",e),{ca:e=null!=(s=t.getFrameOpenReason())?s:0,frameType:n,ba:i,cloudProjectNumber:r,S:s=at(t,3)||"https://meet.google.com"}}var Rn=class extends ut{},An=class extends ut{},On=class extends ut{},xn=[1,2],Dn=class extends ut{},Ln=class extends ut{},Mn=class extends ut{},Un=class extends ut{},Fn=class extends ut{},jn=class extends ut{setAddonStartingState(e){return et(this,1,e)}},qn=class extends ut{},$n=class extends ut{},Wn=[1,2,5,6,7,8,9,10,11,13,14,15,16],Vn=class extends ut{},Bn=pt(Vn),Hn=[1,2];class zn{constructor(e,t){this.data=e,this.channel=t}}var Kn=Promise;function Gn(e){const t=new MessageChannel;return Qn(t.port1,e),t}function Yn(e,t){return Qn(e,t),new Jn(e)}class Jn{constructor(e){this.g=e}send(e,t,n=[]){t=Gn(t),this.g.postMessage(e,[t.port2].concat(n))}C(e,t){return new Kn((n=>{this.send(e,n,t)}))}}function Qn(e,t){t&&(e.onmessage=e=>{var n=e.data;e=Yn(e.ports[0]),t(new zn(n,e))})}var Xn="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function Zn(e,t){e.l(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}class ei{constructor(e,t){this.j=e,this.l=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.j(),e}}function ti(){var e=oi;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var ni=new ei((()=>new ii),(e=>e.reset()));class ii{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let ri,si=!1,oi=new class{constructor(){this.h=this.g=null}add(e,t){const n=ni.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},ai=(e,t)=>{ri||ci(),si||(ri(),si=!0),oi.add(e,t)},ci=()=>{const e=Promise.resolve(void 0);ri=()=>{e.then(li)}};function li(){let e;for(;e=ti();){try{e.h.call(e.g)}catch(e){a(e)}Zn(ni,e)}si=!1}function hi(){}function ui(e){if(this.g=0,this.T=void 0,this.l=this.h=this.j=null,this.v=this.B=!1,e!=hi)try{const t=this;e.call(void 0,(function(e){yi(t,2,e)}),(function(e){yi(t,3,e)}))}catch(e){yi(this,3,e)}}function di(){this.next=this.context=this.h=this.l=this.g=null,this.j=!1}di.prototype.reset=function(){this.context=this.h=this.l=this.g=null,this.j=!1};var pi=new ei((function(){return new di}),(function(e){e.reset()}));function fi(e,t,n){const i=pi.get();return i.l=e,i.h=t,i.context=n,i}function gi(e,t){(t=fi(t=Xn(t),t)).j=!0,_i(e,t)}function mi(e,t){if(0==e.g)if(e.j){var n=e.j;if(n.h){var i=0,r=null,s=null;for(let t=n.h;t&&(t.j||(i++,t.g==e&&(r=t),!(r&&i>1)));t=t.next)r||(s=t);r&&(0==n.g&&1==i?mi(n,t):(s?((i=s).next==n.l&&(n.l=i),i.next=i.next.next):wi(n),Ii(n,r,3,t)))}e.j=null}else yi(e,3,t)}function _i(e,t){e.h||2!=e.g&&3!=e.g||vi(e),e.l?e.l.next=t:e.h=t,e.l=t}function yi(e,t,n){if(0==e.g){e===n&&(t=3,n=new TypeError("Promise cannot resolve to itself")),e.g=1;e:{var i=n,r=e.ma,s=e.na;if(i instanceof ui){_i(i,fi(r||hi,s||null,e));var o=!0}else{if(i)try{var a=!!i.$goog_Thenable}catch(e){a=!1}else a=!1;if(a)i.then(r,s,e),o=!0;else{if("object"==(a=typeof i)&&null!=i||"function"==a)try{const t=i.then;if("function"==typeof t){!function(e,t,n,i,r){function s(e){o||(o=!0,i.call(r,e))}let o=!1;try{t.call(e,(function(e){o||(o=!0,n.call(r,e))}),s)}catch(e){s(e)}}(i,t,r,s,e),o=!0;break e}}catch(t){s.call(e,t),o=!0;break e}o=!1}}}o||(e.T=n,e.g=t,e.j=null,vi(e),3!=t||n instanceof Ti||function(e,t){e.v=!0,ai((function(){e.v&&Ci.call(null,t)}))}(e,n))}}function vi(e){e.B||(e.B=!0,ai(e.la,e))}function wi(e){let t=null;return e.h&&(t=e.h,e.h=t.next,t.next=null),e.h||(e.l=null),t}function Ii(e,t,n,i){if(3==n&&t.h&&!t.j)for(;e&&e.v;e=e.j)e.v=!1;if(t.g)t.g.j=null,bi(t,n,i);else try{t.j?t.l.call(t.context):bi(t,n,i)}catch(e){Ci.call(null,e)}Zn(pi,t)}function bi(e,t,n){2==t?e.l.call(e.context,n):e.h&&e.h.call(e.context,n)}ui.prototype.then=function(e,t,n){return function(e,t,n,i){const r=fi(null,null,null);return r.g=new ui((function(e,s){r.l=t?function(n){try{const r=t.call(i,n);e(r)}catch(e){s(e)}}:e,r.h=n?function(t){try{const r=n.call(i,t);void 0===r&&t instanceof Ti?s(t):e(r)}catch(e){s(e)}}:s})),r.g.j=e,_i(e,r),r.g}(this,Xn("function"==typeof e?e:null),Xn("function"==typeof t?t:null),n)},ui.prototype.$goog_Thenable=!0,ui.prototype.cancel=function(e){if(0==this.g){const t=new Ti(e);ai((function(){mi(this,t)}),this)}},ui.prototype.ma=function(e){this.g=0,yi(this,2,e)},ui.prototype.na=function(e){this.g=0,yi(this,3,e)},ui.prototype.la=function(){let e;for(;e=wi(this);)Ii(this,e,this.g,this.T);this.B=!1};var Ci=a;function Ti(e){o.call(this,e)}function Ei(e,t,n){this.promise=e,this.resolve=t,this.reject=n}s(Ti,o),Ti.prototype.name="cancel";let Si=1,ki=new WeakMap;function Pi(e,t,n){var i=Ri;e.h.has(t),i(t,n)}var Ni=class extends Cn{constructor(){super(),this.h=new Set}signal(){const e=new Oi;return this.h.add(e),Tn(this,function(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}(bn,e)),e}};function Ri(e,t){return new Promise((n=>{Li((()=>{e.L&&(e.ea=t,e.P=!0);for(const{I:n,slot:i}of e.o.values())try{i(t,{signal:e,I:n})}catch(e){a(e)}for(const n of e.A)n.resolve(t);e.A.clear(),n()}))}))}function Ai(e,t,n){const i=Si++;return Li((()=>{!function(e,t,n,i){if(!e.s)if(i){if(!i.s){const r=()=>{Li((()=>{e.o.delete(t);const n=ki.get(i);n&&y(n,r)}))};e.o.set(t,{I:t,slot:n,F:r}),Ui(i,r)}}else e.o.set(t,{I:t,slot:n,F:()=>e.o.delete(t)})}(e,i,t,n)})),i}var Oi=class extends Cn{constructor(){super(),this.L=!1,this.o=new Map,this.A=new Set,this.P=!1}detach(e){Li((()=>{const t=this.o.get(e);t&&t.F()}))}value(e){return this.promise(!0,e)}next(e){return this.promise(!1,e)}promise(e,t){const n=function(){let e,t;return new Ei(new ui((function(n,i){e=n,t=i})),e,t)}();return Li((()=>{if(this.s)n.reject(new Ti("Signal initially disposed"));else if(t&&t.s)n.reject(new Ti("Owner initially disposed"));else if(e&&this.L&&this.P)n.resolve(this.ea);else if(this.A.add(n),gi(n.promise,(()=>{this.A.delete(n)})),t){const e=()=>{n.reject(new Ti("Owner asynchronously disposed"))};gi(n.promise,(()=>{const n=ki.get(t);n&&y(n,e)})),Ui(t,e)}})),n.promise}G(){super.G(),Li((()=>{for(const{F:e}of this.o.values())e();this.o.clear();for(const e of this.A)e.reject(new Ti("Signal asynchronously disposed"));this.A.clear()}))}};const xi=[];let Di=!1;function Li(e){xi.push(e),async function(){if(!Di)try{Di=!0;let e=Mi(0);for(;e<xi.length;)await Promise.resolve(),e=Mi(e)}catch(e){a(e)}finally{xi.length=0,Di=!1}}()}function Mi(e){const t=e+100;for(;e<t&&e<xi.length;)try{xi[e++]()}catch(e){a(e)}return e}function Ui(e,t){if(e.s)t();else{var n=ki.get(e);if(n)n.push(t);else{const n=[t];ki.set(e,n),Tn(e,(()=>{for(const e of[...n])e();ki.delete(e)}))}}}function Fi(e){return{content:ht(e=tt(new Vn,1,Hn,e))}}const ji=new Ni;function qi(e,t){const n=ji.signal();return{channel:Yn(e,(e=>{const i=t(e.data);Pi(ji,n,{content:i,ka:e})})),signal:n}}let $i;var Wi=class extends ut{},Vi=class extends ut{},Bi=class extends ut{h(){return lt(this,Wi,2,Hi)}g(){return ze(this,Wi,2,Hi)}j(){return lt(this,Vi,3,Hi)}l(){return ze(this,Vi,3,Hi)}},Hi=[2,3],zi=pt(class extends ut{}),Ki=pt(class extends ut{}),Gi=[1,2];async function Yi(e,t){var n=Xi;let i;return t=tt(new $n,9,Wn,t),e=await n(e,Fi(t)),null==(i=lt(Bn(e.data.content),mn,2,Hn))?void 0:lt(i,fn,9,_n)}async function Ji(e,t){var n=Xi;t=tt(new $n,8,Wn,t),await n(e,Fi(t))}async function Qi(e,t){var n=Xi;t=tt(new $n,15,Wn,t),await n(e,Fi(t))}async function Xi(e,t){let n;(e=await e.channel.C(t))||Xt(Tt,`Falsy response received from the message channel. ${JSON.stringify(e)}`),(t=e.data)||Xt(Tt,`Data field in the response from the message channel is falsy. ${JSON.stringify(t)}`),(t=t.content)||Xt(Tt,`Content field in the response from the message channel is falsy. ${JSON.stringify(t)}`);try{n=Bn(t)}catch(e){Xt(Tt,`The ControlMessage can't be deserialized. ${JSON.stringify(t)}. ${JSON.stringify(e)}`)}if((t=lt(n,mn,2,Hn))||Xt(Tt,`MeetToAddonMessage field on ControlMessage is falsy. ${JSON.stringify(t)}`),void 0!==(null==(t=null==t?void 0:lt(t,bt,10,_n))?void 0:ct(t,1)))throw new Ct(function(e){switch(e){case 0:default:return Tt;case 1:return At;case 2:return Ot;case 3:return jt;case 4:return qt;case 5:return Wt;case 6:return Pt;case 7:return Vt;case 8:return Bt;case 9:return Ht;case 10:return Kt;case 11:return Gt;case 12:return Yt;case 13:return Jt;case 14:return $t;case 15:return Qt}}(ct(t,1)));return e}async function Zi(e){const t=function(){var e=new On,t=new An;return tt(e,1,xn,t)}(),{channel:n,response:i}=await async function(e,t){var n,i=Xi;return t=tt(new $n,1,Wn,t),e=(i=await i(e,Fi(t))).data.messagePort,n=null!=(i=null==(n=lt(Bn(i.data.content),mn,2,Hn))?void 0:lt(n,wt,1,_n))?i:Ge(n=new wt,1,ye(0),0),{channel:e?qi(e,(e=>Ki(e))):void 0,response:n}}(e,t);if(!n)throw new Ct(function(e){let t;var n=null!=(t=ct(e,1))?t:0;switch(e=function(e){switch(e){case 2:return"co";case 3:return"gd";default:return"unknown"}}(Ye(e,It)),n){case 1:return{errorType:"InternalError",message:`Could not connect to ${e} channel. Meet did not respond with a MessagePort.`,i:"No further information is available."};case 2:return{errorType:"InternalError",message:`Could not connect to ${e}. A conflicting ${e} exists.`,i:"No further information is available."};case 3:return{errorType:"InternalError",message:`Could not connect to ${e} channel. The addon does not have permission to open a ${e}.`,i:"This method might require EAP enrollment."};case 4:return{errorType:"InternalError",message:`Could not connect to ${e} channel. The addon is not authorized for this ${e}.`,i:"No further information is available."};case 0:default:return(e=>({errorType:"InternalError",message:`Could not connect to ${e} channel. Unknown error`,i:"No further information is available."}))(e);case 5:return"co"===e?{errorType:"InternalError",message:`Could not connect to ${e} channel. The coActivity was not found.`,i:`Consider starting the ${e} only after after the startActivity promise returns.`}:{errorType:"InternalError",message:`Could not connect to ${e} channel.`,i:"No further information is available."}}}(i));return n}async function er(e,t,n){var i=Xi,r=new $n;t=Ge(new Mn,1,ye(t),0),n=Ge(t,2,Ce(n),""),r=tt(r,7,Wn,n),await i(e,Fi(r))}class tr extends Cn{constructor(e,t,n){super(),this.U=e,this.channel=t,this.h=function(e){var t=new vt(100),n=Promise.resolve();return(...i)=>_t(t)?e(...i):n}((async()=>{var e=this.channel,t=e.C,n=new $n,i=new Un;n=tt(n,13,Wn,i),await t.call(e,Fi(n))})),e=function(){var e=$i||($i=gt("[1,2,0]"));const t=(e=Be(e=qe(e),4,Ce("dev-706864954"))).m,n=t[M];return 2&n?e:new e.constructor(je(t,n,!0))}(),at(e,4),ve($e(e,1)),ve($e(e,2)),ve($e(e,3)),n=function(e,t){return tt(e,2,Wn,t)}(new $n,function(e,t){return Ge(e,3,Ce(t),"")}(function(e){return et(new Dn,2,e)}(e),n)),this.channel.send(Fi(n)),Ai(this.U,(async e=>{16===Ye(e.content,_n)&&await async function(e){await e.h()}(this)}))}}let nr;var ir=class{constructor(e){var t=nr;this.h=e,this.g=t}delete(){throw Error("Not implemented.")}},rr=class extends ut{h(){return lt(this,Wi,2,sr)}g(){return ze(this,Wi,2,sr)}j(){return lt(this,Vi,3,sr)}l(){return ze(this,Vi,3,sr)}},sr=[2,3],or=class extends ut{},ar=class extends ut{},cr=class extends ut{},lr=class extends ut{h(){return lt(this,Wi,2,hr)}g(){return ze(this,Wi,2,hr)}j(){return lt(this,Vi,3,hr)}l(){return ze(this,Vi,3,hr)}},hr=[2,3],ur=[5,6],dr=class extends ut{},pr=class extends ut{},fr=[1,2,3],gr=class extends Error{constructor(){super("Failed to create CoActivity: Connection refused - Meet refused to begin Live Sharing")}},mr=class{constructor(e){this.config=e}start(){return null!=this.g||(this.g=setInterval((()=>{this.config.ha()}),this.config.da)),this}shutdown(){clearInterval(this.g)}};function _r(){const e=new Map,t={set:(n,i)=>(e.set(n,i),t),D:()=>e};return t}function yr(e){if(e.g()){var t=(e=e.h().m)[M],n=Ve(e,t,1),i=z(n,!0);if(null!=i&&i!==n&&He(e,t,1,i),t=null==(e=i)?E():e,e=Uint8Array,N(T),null!=(n=t.g)&&!C(n))if("string"==typeof n){w.test(n)&&(n=n.replace(w,b)),n=atob(n),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);n=i}else n=null;return{bytes:new e((t=null==n?n:t.g=n)||0)}}}function vr(e,t){return t=Ir(t),tt(e,2,hr,t),e}function wr(e,t){return t=Ir(t),tt(e,2,sr,t),e}function Ir(e){return Ge(new Wi,1,z(e.bytes,!1),E())}function br(e){if(e.l()){var t,n,i=at(e=e.j(),1),r=null!=(n=null==(t=Ze(e,mt,2))?void 0:ot(t))?n:0;let s=(n=e.m)[M];const o=Ve(n,s,4);return null!=(t=null==o||"number"==typeof o?o:"NaN"===o||"Infinity"===o||"-Infinity"===o?Number(o):void 0)&&t!==o&&He(n,s,4,t),{mediaId:i,mediaPlayoutPosition:r,mediaPlayoutRate:st(t,0),playbackState:Er.get(ct(e,3))}}}function Cr(e,t){return t=kr(t),tt(e,3,hr,t),e}function Tr(e,t){return t=kr(t),tt(e,3,sr,t),e}const Er=_r().set(0,"INVALID").set(1,"BUFFERING").set(2,"PLAY").set(3,"PAUSE").set(4,"ENDED").D(),Sr=_r().set("INVALID",0).set("BUFFERING",1).set("PLAY",2).set("PAUSE",3).set("ENDED",4).D();function kr(e){var t=new Vi;t=Ge(t,1,Ce(e.mediaId),"");var n=e.mediaPlayoutRate;if(null!=n&&"number"!=typeof n)throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);return t=Ge(t,4,n,0),n=Ge(n=new mt,1,we(e.mediaPlayoutPosition),"0"),Ge(t=et(t,2,n),3,ye(e=Sr.get(e.playbackState)),0)}function Pr(e,t){return t=Ge(new ar,1,ye(t.u),0),tt(e,6,ur,t),e}function Nr(e){var t=new or;return tt(e,5,ur,t),e}const Rr=_r().set("co-doing",1).set("co-watching",2).D();async function Ar(e,t,n){var i=t.C,r=new pr,s=new dr;let o;if(s=Ge(s,1,Ce(e.activityTitle),""),s=Ge(s,2,ye(Rr.get(e.K)),0),r=tt(r,3,fr,s),null!=(o=st(ge($e(i=await i.call(t,r,zi),1)),!1))&&o)return new Dr(e,t,n,Ze(i,Bi,2));throw new gr}function Or(e,t){const n=e.config.N(t);n&&!e.config.M(e.g,n)&&(e.g=n,e.j=ot(t),e.v(e.g))}function xr(e,t){const{state:n,fa:i,context:r}=t(e.g);e.g=n,e.notify(e.g,r,i)}class Dr{constructor(e,t,n,i){this.l=e,this.h=t,this.config=n,this.v=function(e){var t=new vt(500);let n,i=0;return(...r)=>{_t(t)?e(...r):(n=()=>{e(...r)},i||(i=setTimeout((()=>{let e;i=0,null==(e=n)||e()}),function(e){const t=e.g;return(e=yt(e,e.index))>=t?0:t-e}(t))))}}((e=>{this.l.O(e)})),function(e,t){const n=Ai(e.signal,(e=>{t(e)}));e.o.push(n)}(this.h,(e=>{const t=Ye(e,Gi);switch(t){case 1:Or(this,lt(e,Bi,1,Gi));break;case 2:case 0:console.warn(`IllegalMessage: ${t} - Unhandled message - Please raise a bug with the MeetJS team`)}})),this.B=new mr({da:1e3,ha:()=>{var e,t,n=null==(t=(e=this.l).ja)?void 0:t.call(e);if(null!==this.g){this.g={...this.g,...n},e=new pr,n=(t=this.config).W;var i=new rr;i=Ge(i,1,we(this.j),"0"),t=n.call(t,i,this.g),e=tt(e,1,fr,t),this.h.send(e)}}}).start(),this.g=null,this.j=0,i&&Or(this,i)}disconnect(){this.h.shutdown(),this.B.shutdown()}notify(e,t,n){var i=n?function({activityTitle:e}){return Be(new cr,4,Ce(e))}(n):void 0,r=(n=this.config).X,s=new lr;i=et(s=Ge(s,1,we(this.j),"0"),4,i),e=r.call(n,i,e),e=this.config.V(e,t),n=(t=this.h).send,e=tt(r=new pr,2,fr,e),n.call(t,e)}}var Lr=class{constructor(e){this.g=e}broadcastStateUpdate(e){xr(this.g,(()=>({state:e,context:{}})))}disconnect(){this.g.disconnect()}};function Mr(e,t){return null!=e&&null!=t&&e.bytes.length===t.bytes.length&&e.bytes.every(((e,n)=>e===t.bytes[n]))}var Ur=class{constructor(e){this.g=e}notifySwitchedToMedia(e,t,n){xr(this.g,(()=>({state:{mediaId:t,mediaPlayoutRate:1,mediaPlayoutPosition:n,playbackState:"PLAY"},fa:{activityTitle:e},context:{u:1}})))}notifyPauseState(e,t){xr(this.g,(n=>{if(null==n)throw Error("Invalid before coWatchingState");return{state:{...n,playbackState:e?"PAUSE":"PLAY",mediaPlayoutPosition:t},context:{u:3}}}))}notifySeekToTimestamp(e){xr(this.g,(t=>{if(null==t)throw Error("Invalid before coWatchingState");return{state:{...t,mediaPlayoutPosition:e},context:{u:2}}}))}notifyPlayoutRate(e){xr(this.g,(t=>{if(null==t)throw Error("Invalid before coWatchingState");return{state:{...t,mediaPlayoutRate:e},context:{u:4}}}))}notifyBuffering(e){xr(this.g,(t=>{if(null==t)throw Error("Invalid before coWatchingState");return{state:{...t,mediaPlayoutPosition:e,playbackState:"BUFFERING"},context:{u:3}}}))}notifyReady(e){xr(this.g,(t=>{if(null==t)throw Error("Invalid before coWatchingState");return{state:{...t,mediaPlayoutPosition:e},context:{u:3}}}))}disconnect(){this.g.disconnect()}};function Fr(e,t){if(null==e||null==t)return!1;const n="PLAY"===e.playbackState?3*Math.max(e.mediaPlayoutRate,1):0,i=Math.abs(e.mediaPlayoutPosition-t.mediaPlayoutPosition);return e.mediaId===t.mediaId&&e.mediaPlayoutRate===t.mediaPlayoutRate&&i<=n&&e.playbackState===t.playbackState}var jr=class{constructor(e,t){this.channel=e,this.signal=t,this.o=[]}send(e){this.channel.send(ht(e))}async C(e,t){return t((e=await this.channel.C(ht(e))).data)}shutdown(){this.o.forEach((e=>{this.signal.detach(e)}))}};async function qr(e){const t=new Ni,n=t.signal();!function(e,t,n,i=e=>e){Ai(n,(n=>{Pi(e,t,i(n))}),e)}(t,n,(e=await e).signal,(e=>e.content));const{ia:i,ga:r}=function(e,t){var n=$r;const i=e.signal(),r=e.signal();return Ai(t,(t=>{const s=n(t)?i:r;Pi(e,s,t)}),e),{ia:i,ga:r}}(t,n);return{Z:new jr(e.channel,i),aa:new jr(e.channel,r)}}function $r(e){if(1!==Ye(e,Gi))throw Error("CA Message arrived with no known content message set");return(e=lt(e,Bi,1,Gi)).g()}var Wr=class extends kn{async notifySidePanel(e){await er(this.context.g,1,e)}async unloadSidePanel(){await async function(e){var t=Xi,n=new $n,i=new qn;n=tt(n,5,Wn,i),await t(e,Fi(n))}(this.context.g)}async loadSidePanel(){await async function(e){var t=Xi,n=new $n,i=new Ln;n=tt(n,6,Wn,i),await t(e,Fi(n))}(this.context.g)}},Vr=class extends kn{async setAddonStartingState(e){if(null===e)throw new Ct(Ut("addonStartingState"));if("object"!=typeof e)throw new Ct(Ft("addonStartingState",typeof e,"object | undefined"));if(void 0!==e.sidePanelUrl&&"string"!=typeof e.sidePanelUrl)throw new Ct(Ft("sidePanelUrl",typeof e.sidePanelUrl,"string | undefined"));if(void 0!==e.additionalData&&"string"!=typeof e.additionalData)throw new Ct(Ft("additionalData",typeof e.additionalData,"string | undefined"));if(Object.keys(e).length!==+!!e.sidePanelUrl+ +!!e.additionalData)throw new Ct(Mt);if(0===Object.keys(e).length)throw new Ct(Lt);var t=[];t.push(nn(tn(en(1),e.sidePanelUrl),e.additionalData)),e=this.context.g;var n=new jn,i=n.setAddonStartingState;t=nt(new Fn,t),await async function(e,t){var n=Xi;t=tt(new $n,16,Wn,t),await n(e,Fi(t))}(e,i.call(n,t))}},Br=class extends kn{async notifyMainStage(e){await er(this.context.g,2,e)}},Hr=class{constructor(e){e=e.cloudProjectNumber;const t=Nn();if(t.cloudProjectNumber!==e)throw new Ct(Rt);const n=t.S,i=t.ba;let r;nr=null!=(r=nr)?r:function(e,t,n){const i=new Ni,r=i.signal();return e=(({destination:e,origin:t,ra:n,Y:i="ZNWN1d",onMessage:r})=>{if("*"===t)throw Error("Sending to wildcard origin not allowed.");const s=Gn(r);return e.postMessage(n?{n:i,t:n}:i,t,[s.port2]),Yn(s.port1,r)})({destination:window.parent,origin:t,Y:e,onMessage:e=>{const t=Bn(e.data.content);2===Ye(t,Hn)&&Pi(i,r,{content:lt(t,mn,2,Hn),ka:e,messagePort:e.data.messagePort})}}),new tr(r,e,n)}(i,n,e),this.g=new ir(t)}async createMainStageClient(){var e=this.g;if(2!==e.h.frameType)throw new Ct(St);return await Promise.resolve(new Wr(e))}async createSidePanelClient(){var e=this.g;if(1!==e.h.frameType)throw new Ct(kt);return await Promise.resolve(new Br(e))}async createCoWatchingClient(e){return await async function(e,t){if(({aa:e}=await qr(Zi(e.g))),t=await async function(e,t){if(t)return e=await Ar({activityTitle:t.activityTitle,K:"co-watching",ja:()=>t.onCoWatchingStateQuery(),O:e=>{t.onCoWatchingStateChanged(e)}},e,{X:Cr,W:Tr,V:Pr,N:br,M:Fr}),new Ur(e)}(e,t),!t)throw Error("Failed to create co-watching session");return t}(this.g,e)}async createCoDoingClient(e){return await async function(e,t){if(({Z:e}=await qr(Zi(e.g))),t=await async function(e,t){if(t)return e=await Ar({activityTitle:t.activityTitle,K:"co-doing",O:e=>{t.onCoDoingStateChanged(e)}},e,{X:vr,W:wr,V:Nr,N:yr,M:Mr}),new Lr(e)}(e,t),!t)throw Error("Failed to create co-doing session");return t}(this.g,e)}async createRoomsStandaloneClient(){var e=this.g;if(2!==e.h.frameType)throw new Ct(St);return await Promise.resolve(new Vr(e))}};let zr=null;var Kr,Gr={addon:{getFrameType:function(){e:{var e=Nn().frameType;switch(e){case 2:e="MAIN_STAGE";break e;case 1:e="SIDE_PANEL";break e;default:throw Error(`Unknown frame type: ${e}`)}}return e},createAddonSession:async function(e){if(null===e)throw new Ct(Ut("config"));if("object"!=typeof e)throw new Ct(Ft("config",typeof e,"object"));if("string"!=typeof e.cloudProjectNumber)throw new Ct(Ft("cloudProjectNumber",typeof e.cloudProjectNumber,"string"));if(zr&&"integration.test.google.com"!==Nn().S)throw new Ct(zt);return zr=new Hr(e)}}},Yr=["meet"],Jr=r;Yr[0]in Jr||void 0===Jr.execScript||Jr.execScript("var "+Yr[0]);for(;Yr.length&&(Kr=Yr.shift());)Yr.length||void 0===Gr?Jr=Jr[Kr]&&Jr[Kr]!==Object.prototype[Kr]?Jr[Kr]:Jr[Kr]={}:Jr[Kr]=Gr}).apply(t);const n=t.meet,i=function(e,t){if(!e)throw r(t)},r=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},s=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=r>>2,h=(3&r)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(u=64)),i.push(n[l],n[h],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==c)throw new a;const l=r<<2|s>>4;if(i.push(l),64!==o){const e=s<<4&240|o>>2;if(i.push(e),64!==c){const e=o<<6&192|c;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class a extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const c=function(e){const t=s(e);return o.encodeByteArray(t,!0)},l=function(e){return c(e).replace(/\./g,"")},h=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e){return d(void 0,e)}function d(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=d(e[n],t[n]));return e}const p=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&h(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},f=e=>{var t,n;return null===(n=null===(t=p())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},g=e=>{const t=f(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},m=()=>{var e;return null===(e=p())||void 0===e?void 0:e.config},_=e=>{var t;return null===(t=p())||void 0===t?void 0:t[`_${e}`]};class y{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function v(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(s)),""].join(".")}function w(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function b(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function C(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function T(){try{return"object"==typeof indexedDB}catch(e){return!1}}function E(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,k.prototype.create)}}class k{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(P,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new S(i,o,n)}}const P=/\{\$([^}]+)}/g;function N(e){return JSON.parse(e)}function R(e){return JSON.stringify(e)}const A=function(e){let t={},n={},i={},r="";try{const s=e.split(".");t=N(h(s[0])||""),n=N(h(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}};function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function D(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function L(e,t,n){const i={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function M(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(U(n)&&U(s)){if(!M(n,s))return!1}else if(n!==s)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function U(e){return null!==e&&"object"==typeof e}function F(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function j(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function q(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class ${constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,r,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=c^o&(a^c),r=1518500249):(i=o^a^c,r=1859775393):e<60?(i=o&a|c&(o|a),r=2400959708):(i=o^a^c,r=3395469782);const t=(s<<5|s>>>27)+i+l+r+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const r=this.buf_;let s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class W{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=V),void 0===i.error&&(i.error=V),void 0===i.complete&&(i.complete=V);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function V(){}function B(e,t){return`${e} failed: ${t} argument `}const H=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function z(e,t=1e3,n=2){const i=t*Math.pow(n,e),r=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+r)}function K(e){return e&&e._delegate?e._delegate:e}class G{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Y="[DEFAULT]";class J{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new y;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Y})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=Y){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=Y){return this.instances.has(e)}getOptions(e=Y){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===Y?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=Y){return this.component?this.component.multipleInstances?e:Y:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Q{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new J(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const X=[];var Z;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Z||(Z={}));const ee={debug:Z.DEBUG,verbose:Z.VERBOSE,info:Z.INFO,warn:Z.WARN,error:Z.ERROR,silent:Z.SILENT},te=Z.INFO,ne={[Z.DEBUG]:"log",[Z.VERBOSE]:"log",[Z.INFO]:"info",[Z.WARN]:"warn",[Z.ERROR]:"error"},ie=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=ne[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class re{constructor(e){this.name=e,this._logLevel=te,this._logHandler=ie,this._userLogHandler=null,X.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ee[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Z.DEBUG,...e),this._logHandler(this,Z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Z.VERBOSE,...e),this._logHandler(this,Z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Z.INFO,...e),this._logHandler(this,Z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Z.WARN,...e),this._logHandler(this,Z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Z.ERROR,...e),this._logHandler(this,Z.ERROR,...e)}}let se,oe;const ae=new WeakMap,ce=new WeakMap,le=new WeakMap,he=new WeakMap,ue=new WeakMap;let de={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ce.get(e);if("objectStoreNames"===t)return e.objectStoreNames||le.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return fe(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function pe(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(oe||(oe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(ge(this),e),fe(ae.get(this))}:function(...e){return fe(t.apply(ge(this),e))}:function(e,...n){const i=t.call(ge(this),e,...n);return le.set(i,e.sort?e.sort():[e]),fe(i)}:(e instanceof IDBTransaction&&function(e){if(ce.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));ce.set(e,t)}(e),n=e,(se||(se=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,de):e);var t,n}function fe(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(fe(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&ae.set(t,e)})).catch((()=>{})),ue.set(t,e),t}(e);if(he.has(e))return he.get(e);const t=pe(e);return t!==e&&(he.set(e,t),ue.set(t,e)),t}const ge=e=>ue.get(e);function me(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=fe(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(fe(o.result),e.oldVersion,e.newVersion,fe(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}const _e=["get","getKey","getAll","getAllKeys","count"],ye=["put","add","delete","clear"],ve=new Map;function we(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ve.get(t))return ve.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=ye.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!_e.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return ve.set(t,s),s}var Ie;Ie=de,de={...Ie,get:(e,t,n)=>we(e,t)||Ie.get(e,t,n),has:(e,t)=>!!we(e,t)||Ie.has(e,t)};class be{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Ce="@firebase/app",Te="0.11.5",Ee=new re("@firebase/app"),Se="@firebase/app-compat",ke="@firebase/analytics-compat",Pe="@firebase/analytics",Ne="@firebase/app-check-compat",Re="@firebase/app-check",Ae="@firebase/auth",Oe="@firebase/auth-compat",xe="@firebase/database",De="@firebase/data-connect",Le="@firebase/database-compat",Me="@firebase/functions",Ue="@firebase/functions-compat",Fe="@firebase/installations",je="@firebase/installations-compat",qe="@firebase/messaging",$e="@firebase/messaging-compat",We="@firebase/performance",Ve="@firebase/performance-compat",Be="@firebase/remote-config",He="@firebase/remote-config-compat",ze="@firebase/storage",Ke="@firebase/storage-compat",Ge="@firebase/firestore",Ye="@firebase/vertexai",Je="@firebase/firestore-compat",Qe="firebase",Xe="[DEFAULT]",Ze={[Ce]:"fire-core",[Se]:"fire-core-compat",[Pe]:"fire-analytics",[ke]:"fire-analytics-compat",[Re]:"fire-app-check",[Ne]:"fire-app-check-compat",[Ae]:"fire-auth",[Oe]:"fire-auth-compat",[xe]:"fire-rtdb",[De]:"fire-data-connect",[Le]:"fire-rtdb-compat",[Me]:"fire-fn",[Ue]:"fire-fn-compat",[Fe]:"fire-iid",[je]:"fire-iid-compat",[qe]:"fire-fcm",[$e]:"fire-fcm-compat",[We]:"fire-perf",[Ve]:"fire-perf-compat",[Be]:"fire-rc",[He]:"fire-rc-compat",[ze]:"fire-gcs",[Ke]:"fire-gcs-compat",[Ge]:"fire-fst",[Je]:"fire-fst-compat",[Ye]:"fire-vertex","fire-js":"fire-js",[Qe]:"fire-js-all"},et=new Map,tt=new Map,nt=new Map;function it(e,t){try{e.container.addComponent(t)}catch(n){Ee.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function rt(e){const t=e.name;if(nt.has(t))return Ee.debug(`There were multiple attempts to register component ${t}.`),!1;nt.set(t,e);for(const t of et.values())it(t,e);for(const t of tt.values())it(t,e);return!0}function st(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ot(e){return null!=e&&void 0!==e.settings}const at=new k("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ct{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new G("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw at.create("app-deleted",{appName:this._name})}}const lt="11.6.1";function ht(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:Xe,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw at.create("bad-app-name",{appName:String(r)});if(n||(n=m()),!n)throw at.create("no-options");const s=et.get(r);if(s){if(M(n,s.options)&&M(i,s.config))return s;throw at.create("duplicate-app",{appName:r})}const o=new Q(r);for(const e of nt.values())o.addComponent(e);const a=new ct(n,i,o);return et.set(r,a),a}function ut(e=Xe){const t=et.get(e);if(!t&&e===Xe&&m())return ht();if(!t)throw at.create("no-app",{appName:e});return t}function dt(e,t,n){var i;let r=null!==(i=Ze[e])&&void 0!==i?i:e;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ee.warn(e.join(" "))}rt(new G(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}const pt="firebase-heartbeat-store";let ft=null;function gt(){return ft||(ft=me("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(pt)}catch(e){console.warn(e)}}}).catch((e=>{throw at.create("idb-open",{originalErrorMessage:e.message})}))),ft}async function mt(e,t){try{const n=(await gt()).transaction(pt,"readwrite"),i=n.objectStore(pt);await i.put(t,_t(e)),await n.done}catch(e){if(e instanceof S)Ee.warn(e.message);else{const t=at.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Ee.warn(t.message)}}}function _t(e){return`${e.name}!${e.options.appId}`}class yt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new wt(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=vt();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some((e=>e.date===i)))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ee.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=vt(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),It(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),It(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=l(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Ee.warn(e),""}}}function vt(){return(new Date).toISOString().substring(0,10)}class wt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!T()&&E().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await gt()).transaction(pt),n=await t.objectStore(pt).get(_t(e));return await t.done,n}catch(e){if(e instanceof S)Ee.warn(e.message);else{const t=at.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Ee.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return mt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return mt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function It(e){return l(JSON.stringify({version:2,heartbeats:e})).length}rt(new G("platform-logger",(e=>new be(e)),"PRIVATE")),rt(new G("heartbeat",(e=>new yt(e)),"PRIVATE")),dt(Ce,Te,""),dt(Ce,Te,"esm2017"),dt("fire-js",""),dt("firebase","11.6.1","app");const bt="@firebase/installations",Ct="0.6.13",Tt=`w:${Ct}`,Et="FIS_v2",St=new k("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function kt(e){return e instanceof S&&e.code.includes("request-failed")}function Pt({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function Nt(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Rt(e,t){const n=(await t.json()).error;return St.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function At({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Ot(e){const t=await e();return t.status>=500&&t.status<600?e():t}function xt(e){return new Promise((t=>{setTimeout(t,e)}))}const Dt=/^[cdef][\w-]{21}$/;function Lt(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return Dt.test(t)?t:""}catch(e){return""}}function Mt(e){return`${e.appName}!${e.appId}`}const Ut=new Map;function Ft(e,t){const n=Mt(e);jt(n,t),function(e,t){const n=(!qt&&"BroadcastChannel"in self&&(qt=new BroadcastChannel("[Firebase] FID Change"),qt.onmessage=e=>{jt(e.data.key,e.data.fid)}),qt);n&&n.postMessage({key:e,fid:t}),0===Ut.size&&qt&&(qt.close(),qt=null)}(n,t)}function jt(e,t){const n=Ut.get(e);if(n)for(const e of n)e(t)}let qt=null;const $t="firebase-installations-store";let Wt=null;function Vt(){return Wt||(Wt=me("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore($t)}})),Wt}async function Bt(e,t){const n=Mt(e),i=(await Vt()).transaction($t,"readwrite"),r=i.objectStore($t),s=await r.get(n);return await r.put(t,n),await i.done,s&&s.fid===t.fid||Ft(e,t.fid),t}async function Ht(e){const t=Mt(e),n=(await Vt()).transaction($t,"readwrite");await n.objectStore($t).delete(t),await n.done}async function zt(e,t){const n=Mt(e),i=(await Vt()).transaction($t,"readwrite"),r=i.objectStore($t),s=await r.get(n),o=t(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||Ft(e,o.fid),o}async function Kt(e){let t;const n=await zt(e.appConfig,(n=>{const i=function(e){return Jt(e||{fid:Lt(),registrationStatus:0})}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(St.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=Pt(e),r=At(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={fid:n,authVersion:Et,appId:e.appId,sdkVersion:Tt},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Ot((()=>fetch(i,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:Nt(e.authToken)}}throw await Rt("Create Installation",c)}(e,t);return Bt(e.appConfig,n)}catch(n){throw kt(n)&&409===n.customData.serverCode?await Ht(e.appConfig):await Bt(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Gt(e)}:{installationEntry:t}}(e,i);return t=r.registrationPromise,r.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Gt(e){let t=await Yt(e.appConfig);for(;1===t.registrationStatus;)await xt(100),t=await Yt(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await Kt(e);return n||t}return t}function Yt(e){return zt(e,(e=>{if(!e)throw St.create("installation-not-found");return Jt(e)}))}function Jt(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Qt({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${Pt(e)}/${t}/authTokens:generate`}(e,n),r=function(e,{refreshToken:t}){const n=At(e);return n.append("Authorization",function(e){return`${Et} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={installation:{sdkVersion:Tt,appId:e.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Ot((()=>fetch(i,a)));if(c.ok)return Nt(await c.json());throw await Rt("Generate Auth Token",c)}async function Xt(e,t=!1){let n;const i=await zt(e.appConfig,(i=>{if(!en(i))throw St.create("not-registered");const r=i.authToken;if(!t&&(2===(s=r).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return i;var s;if(1===r.requestStatus)return n=async function(e,t){let n=await Zt(e.appConfig);for(;1===n.authToken.requestStatus;)await xt(100),n=await Zt(e.appConfig);const i=n.authToken;return 0===i.requestStatus?Xt(e,t):i}(e,t),i;{if(!navigator.onLine)throw St.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await Qt(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await Bt(e.appConfig,i),n}catch(n){if(!kt(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Bt(e.appConfig,n)}else await Ht(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function Zt(e){return zt(e,(e=>{if(!en(e))throw St.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function en(e){return void 0!==e&&2===e.registrationStatus}function tn(e){return St.create("missing-app-config-values",{valueName:e})}const nn="installations";rt(new G(nn,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw tn("App Configuration");if(!e.name)throw tn("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw tn(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:st(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),rt(new G("installations-internal",(e=>{const t=st(e.getProvider("app").getImmediate(),nn).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await Kt(t);return i?i.catch(console.error):Xt(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await Kt(e);t&&await t}(n),(await Xt(n,t)).token}(t,e)}}),"PRIVATE")),dt(bt,Ct),dt(bt,Ct,"esm2017");const rn="analytics",sn="https://www.googletagmanager.com/gtag/js",on=new re("@firebase/analytics"),an=new k("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function cn(e){if(!e.startsWith(sn)){const t=an.create("invalid-gtag-resource",{gtagURL:e});return on.warn(t.message),""}return e}function ln(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const hn=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function un(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function dn(e,t=hn,n){const{appId:i,apiKey:r,measurementId:s}=e.options;if(!i)throw an.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw an.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new fn;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),pn({appId:i,apiKey:r,measurementId:s},o,a,t)}async function pn(e,{throttleEndTimeMillis:t,backoffCount:n},i,r=hn){var s;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,i)=>{const r=Math.max(t-Date.now(),0),s=setTimeout(n,r);e.addEventListener((()=>{clearTimeout(s),i(an.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(e){if(a)return on.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,r={method:"GET",headers:un(i)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw an.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return r.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof S&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(r.deleteThrottleMetadata(o),a)return on.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const l=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?z(n,r.intervalMillis,30):z(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return r.setThrottleMetadata(o,h),on.debug(`Calling attemptFetch again in ${l} millis`),pn(e,h,i,r)}}class fn{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let gn,mn;async function _n(e,t,n,i,r,s,o){var a;const c=dn(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&on.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>on.error(e))),t.push(c);const l=async function(){if(!T())return on.warn(an.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await E()}catch(e){return on.warn(an.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[h,u]=await Promise.all([c,l]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(sn)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:cn}),i=document.createElement("script"),r=`${sn}?l=${e}&id=${t}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}(s,h.measurementId),mn&&(r("consent","default",mn),mn=void 0),r("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=u&&(d.firebase_id=u),r("config",h.measurementId,d),gn&&(r("set",gn),gn=void 0),h.measurementId}class yn{constructor(e){this.app=e}_delete(){return delete vn[this.app.options.appId],Promise.resolve()}}let vn={},wn=[];const In={};let bn,Cn,Tn="dataLayer",En=!1;function Sn(e,t,n){!function(){const e=[];if(b()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=an.create("invalid-analytics-context",{errorInfo:t});on.warn(n.message)}}();const i=e.options.appId;if(!i)throw an.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw an.create("no-api-key");on.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=vn[i])throw an.create("already-exists",{id:i});if(!En){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Tn);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,r){let s=function(...e){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(e,t,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(e,t,n,i,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const i=await ln(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),r=e&&t[e.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",i,r||{})}catch(e){on.error(e)}}(e,t,n,i,r)}else if("config"===r){const[r,o]=s;await async function(e,t,n,i,r,s){const o=i[r];try{if(o)await t[o];else{const e=(await ln(n)).find((e=>e.measurementId===r));e&&await t[e.appId]}}catch(e){on.error(e)}e("config",r,s)}(e,t,n,i,r,o)}else if("consent"===r){const[t,n]=s;e("consent",t,n)}else if("get"===r){const[t,n,i]=s;e("get",t,n,i)}else if("set"===r){const[t]=s;e("set",t)}else e(r,...s)}catch(e){on.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[r]}}(vn,wn,In,Tn,"gtag");Cn=e,bn=t,En=!0}return vn[i]=_n(e,wn,In,t,bn,Tn,n),new yn(e)}const kn="@firebase/analytics",Pn="0.10.12";function Nn(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}rt(new G(rn,((e,{options:t})=>Sn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),rt(new G("analytics-internal",(function(e){try{const t=e.getProvider(rn).getImmediate();return{logEvent:(e,n,i)=>function(e,t,n,i){e=K(e),async function(e,t,n,i,r){if(r&&r.global)e("event",n,i);else{const r=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(Cn,vn[e.app.options.appId],t,n,i).catch((e=>on.error(e)))}(t,e,n,i)}}catch(e){throw an.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),dt(kn,Pn),dt(kn,Pn,"esm2017"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Rn=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},An=new k("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),On=new re("@firebase/auth");function xn(e,...t){On.logLevel<=Z.ERROR&&On.error(`Auth (${lt}): ${e}`,...t)}function Dn(e,...t){throw Fn(e,...t)}function Ln(e,...t){return Fn(e,...t)}function Mn(e,t,n){const i=Object.assign(Object.assign({},Rn()),{[t]:n});return new k("auth","Firebase",i).create(t,{appName:e.name})}function Un(e){return Mn(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Fn(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return An.create(e,...t)}function jn(e,t,...n){if(!e)throw Fn(t,...n)}function qn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw xn(t),new Error(t)}function $n(e,t){e||qn(t)}function Wn(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Vn(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Bn{constructor(e,t){this.shortDelay=e,this.longDelay=t,$n(t>e,"Short delay should be less than long delay!"),this.isMobile=I()||C()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Vn()||"https:"===Vn()||b()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Hn(e,t){$n(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class zn{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void qn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void qn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void qn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Kn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Gn=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Yn=new Bn(3e4,6e4);function Jn(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Qn(e,t,n,i,r={}){return Xn(e,r,(async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});const o=F(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},r);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),zn.fetch()(await ei(e,e.config.apiHost,n,o),c)}))}async function Xn(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},Kn),t);try{const t=new ni(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw ii(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ii(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw ii(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw ii(e,"user-disabled",s);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Mn(e,a,o);Dn(e,a)}}catch(t){if(t instanceof S)throw t;Dn(e,"network-request-failed",{message:String(t)})}}async function Zn(e,t,n,i,r={}){const s=await Qn(e,t,n,i,r);return"mfaPendingCredential"in s&&Dn(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function ei(e,t,n,i){const r=`${t}${n}?${i}`,s=e,o=s.config.emulator?Hn(e.config,r):`${e.config.apiScheme}://${r}`;return Gn.includes(n)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(o).toString():o}function ti(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ni{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Ln(this.auth,"network-request-failed"))),Yn.get())}))}}function ii(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=Ln(e,t,i);return r.customData._tokenResponse=n,r}function ri(e){return void 0!==e&&void 0!==e.enterprise}class si{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return ti(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function oi(e,t){return Qn(e,"GET","/v2/recaptchaConfig",Jn(e,t))}async function ai(e,t){return Qn(e,"POST","/v1/accounts:lookup",t)}function ci(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function li(e){return 1e3*Number(e)}function hi(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return xn("JWT malformed, contained fewer than 3 sections"),null;try{const e=h(n);return e?JSON.parse(e):(xn("Failed to decode base64 JWT payload"),null)}catch(e){return xn("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function ui(e){const t=hi(e);return jn(t,"internal-error"),jn(void 0!==t.exp,"internal-error"),jn(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function di(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof S&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class pi{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class fi{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ci(this.lastLoginAt),this.creationTime=ci(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function gi(e){var t;const n=e.auth,i=await e.getIdToken(),r=await di(e,ai(n,{idToken:i}));jn(null==r?void 0:r.users.length,n,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?mi(s.providerUserInfo):[],a=(c=e.providerData,l=o,[...c.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var c,l;const h=e.isAnonymous,u=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!h&&u,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new fi(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,p)}function mi(e){return e.map((e=>{var{providerId:t}=e,n=Nn(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class _i{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){jn(e.idToken,"internal-error"),jn(void 0!==e.idToken,"internal-error"),jn(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):ui(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){jn(0!==e.length,"internal-error");const t=ui(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(jn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(e,t){const n=await Xn(e,{},(async()=>{const n=F({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=await ei(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",zn.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new _i;return n&&(jn("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(jn("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(jn("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new _i,this.toJSON())}_performRefresh(){return qn("not implemented")}}function yi(e,t){jn("string"==typeof e||void 0===e,"internal-error",{appName:t})}class vi{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=Nn(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new pi(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new fi(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await di(this,this.stsTokenManager.getToken(this.auth,e));return jn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=K(e),i=await n.getIdToken(t),r=hi(i);jn(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:ci(li(r.auth_time)),issuedAtTime:ci(li(r.iat)),expirationTime:ci(li(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=K(e);await gi(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(jn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new vi(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){jn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await gi(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ot(this.auth.app))return Promise.reject(Un(this.auth));const e=await this.getIdToken();return await di(this,async function(e,t){return Qn(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,c,l;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,_=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:y,emailVerified:v,isAnonymous:w,providerData:I,stsTokenManager:b}=t;jn(y&&b,e,"internal-error");const C=_i.fromJSON(this.name,b);jn("string"==typeof y,e,"internal-error"),yi(h,e.name),yi(u,e.name),jn("boolean"==typeof v,e,"internal-error"),jn("boolean"==typeof w,e,"internal-error"),yi(d,e.name),yi(p,e.name),yi(f,e.name),yi(g,e.name),yi(m,e.name),yi(_,e.name);const T=new vi({uid:y,auth:e,email:u,emailVerified:v,displayName:h,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:C,createdAt:m,lastLoginAt:_});return I&&Array.isArray(I)&&(T.providerData=I.map((e=>Object.assign({},e)))),g&&(T._redirectEventId=g),T}static async _fromIdTokenResponse(e,t,n=!1){const i=new _i;i.updateFromServerResponse(t);const r=new vi({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await gi(r),r}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];jn(void 0!==i.localId,"internal-error");const r=void 0!==i.providerUserInfo?mi(i.providerUserInfo):[],s=!(i.email&&i.passwordHash||(null==r?void 0:r.length)),o=new _i;o.updateFromIdToken(n);const a=new vi({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new fi(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash||(null==r?void 0:r.length))};return Object.assign(a,c),a}}const wi=new Map;function Ii(e){$n(e instanceof Function,"Expected a class definition");let t=wi.get(e);return t?($n(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,wi.set(e,t),t)}class bi{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}bi.type="NONE";const Ci=bi;function Ti(e,t,n){return`firebase:${e}:${t}:${n}`}class Ei{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=Ti(this.userKey,i.apiKey,r),this.fullPersistenceKey=Ti("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await ai(this.auth,{idToken:e}).catch((()=>{}));return t?vi._fromGetAccountInfoResponse(this.auth,t,e):null}return vi._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Ei(Ii(Ci),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let r=i[0]||Ii(Ci);const s=Ti(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){let i;if("string"==typeof t){const n=await ai(e,{idToken:t}).catch((()=>{}));if(!n)break;i=await vi._fromGetAccountInfoResponse(e,n,t)}else i=vi._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new Ei(r,e,n)):new Ei(r,e,n)}}function Si(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ri(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ki(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Oi(t))return"Blackberry";if(xi(t))return"Webos";if(Pi(t))return"Safari";if((t.includes("chrome/")||Ni(t))&&!t.includes("edge/"))return"Chrome";if(Ai(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function ki(e=w()){return/firefox\//i.test(e)}function Pi(e=w()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Ni(e=w()){return/crios\//i.test(e)}function Ri(e=w()){return/iemobile/i.test(e)}function Ai(e=w()){return/android/i.test(e)}function Oi(e=w()){return/blackberry/i.test(e)}function xi(e=w()){return/webos/i.test(e)}function Di(e=w()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Li(e=w()){return Di(e)||Ai(e)||xi(e)||Oi(e)||/windows phone/i.test(e)||Ri(e)}function Mi(e,t=[]){let n;switch(e){case"Browser":n=Si(w());break;case"Worker":n=`${Si(w())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${lt}/${i}`}class Ui{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Fi{constructor(e){var t,n,i,r;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(r=e.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,r,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(i=a.containsLowercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(r=a.containsUppercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class ji{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new $i(this),this.idTokenSubscription=new $i(this),this.beforeStateQueue=new Ui(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=An,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise((e=>this._resolvePersistenceManagerAvailable=e))}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ii(t)),this._initializationPromise=this.queue((async()=>{var n,i,r;if(!this._deleted&&(this.persistenceManager=await Ei.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(i=this._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await ai(this,{idToken:e}),n=await vi._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ot(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return jn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await gi(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ot(this.app))return Promise.reject(Un(this));const t=e?K(e):null;return t&&jn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&jn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return ot(this.app)?Promise.reject(Un(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ot(this.app)?Promise.reject(Un(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Ii(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Qn(e,"GET","/v2/passwordPolicy",Jn(e,t))}(this),t=new Fi(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new k("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Qn(e,"POST","/v2/accounts:revokeToken",Jn(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ii(e)||this._popupRedirectResolver;jn(t,this,"argument-error"),this.redirectPersistenceManager=await Ei.create(this,[Ii(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(jn(o,this,"internal-error"),o.then((()=>{s||r(this.currentUser)})),"function"==typeof t){const r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return jn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Mi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(ot(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){On.logLevel<=Z.WARN&&On.warn(`Auth (${lt}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function qi(e){return K(e)}class $i{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new W(e,void 0);return t.subscribe.bind(t)}((e=>this.observer=e))}get next(){return jn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Wi={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Vi(e){return Wi.loadJS(e)}function Bi(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Hi{constructor(){this.enterprise=new zi}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class zi{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Ki="NO_RECAPTCHA";class Gi{constructor(e){this.type="recaptcha-enterprise",this.auth=qi(e)}async verify(e="verify",t=!1){function n(t,n,i){const r=window.grecaptcha;ri(r)?r.enterprise.ready((()=>{r.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(Ki)}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new Hi).execute("siteKey",{action:"verify"}):new Promise(((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{oi(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new si(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((r=>{if(!t&&ri(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=Wi.recaptchaEnterpriseScript;0!==t.length&&(t+=r),Vi(t).then((()=>{n(r,e,i)})).catch((e=>{i(e)}))}})).catch((e=>{i(e)}))}))}}async function Yi(e,t,n,i=!1,r=!1){const s=new Gi(e);let o;if(r)o=Ki;else try{o=await s.verify(n)}catch(e){o=await s.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Ji(e,t,n,i,r){var s,o;if("EMAIL_PASSWORD_PROVIDER"===r){if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await Yi(e,t,n,"getOobCode"===n);return i(e,r)}return i(e,t).catch((async r=>{if("auth/missing-recaptcha-token"===r.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const r=await Yi(e,t,n,"getOobCode"===n);return i(e,r)}return Promise.reject(r)}))}if("PHONE_PROVIDER"===r){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const r=await Yi(e,t,n);return i(e,r).catch((async r=>{var s;if("AUDIT"===(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const r=await Yi(e,t,n,!1,!0);return i(e,r)}return Promise.reject(r)}))}{const r=await Yi(e,t,n,!1,!0);return i(e,r)}}return Promise.reject(r+" provider is not supported.")}function Qi(e,t,n){const i=qi(e);jn(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=Xi(t),{host:o,port:a}=function(e){const t=Xi(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:Zi(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Zi(t)}}}(t),c={url:`${s}//${o}${null===a?"":`:${a}`}/`},l=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator)return jn(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),void jn(M(c,i.config.emulator)&&M(l,i.emulatorConfig),i,"emulator-config-failed");i.config.emulator=c,i.emulatorConfig=l,i.settings.appVerificationDisabledForTesting=!0,r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Xi(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Zi(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class er{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return qn("not implemented")}_getIdTokenResponse(e){return qn("not implemented")}_linkToIdToken(e,t){return qn("not implemented")}_getReauthenticationResolver(e){return qn("not implemented")}}async function tr(e,t){return Qn(e,"POST","/v1/accounts:signUp",t)}async function nr(e,t){return Zn(e,"POST","/v1/accounts:signInWithPassword",Jn(e,t))}class ir extends er{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new ir(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ir(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Ji(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nr,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Zn(e,"POST","/v1/accounts:signInWithEmailLink",Jn(e,t))}(e,{email:this._email,oobCode:this._password});default:Dn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Ji(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",tr,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Zn(e,"POST","/v1/accounts:signInWithEmailLink",Jn(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Dn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function rr(e,t){return Zn(e,"POST","/v1/accounts:signInWithIdp",Jn(e,t))}class sr extends er{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new sr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Dn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=Nn(t,["providerId","signInMethod"]);if(!n||!i)return null;const s=new sr(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return rr(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,rr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,rr(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=F(t)}return e}}async function or(e,t){return Qn(e,"POST","/v1/accounts:sendVerificationCode",Jn(e,t))}const ar={USER_NOT_FOUND:"user-not-found"};class cr extends er{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new cr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new cr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Zn(e,"POST","/v1/accounts:signInWithPhoneNumber",Jn(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Zn(e,"POST","/v1/accounts:signInWithPhoneNumber",Jn(e,t));if(n.temporaryProof)throw ii(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Zn(e,"POST","/v1/accounts:signInWithPhoneNumber",Jn(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ar)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new cr({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class lr{constructor(e){var t,n,i,r,s,o;const a=j(q(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);jn(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(r=a.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(s=a.lang)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=j(q(e)).link,n=t?j(q(t)).deep_link_id:null,i=j(q(e)).deep_link_id;return(i?j(q(i)).link:null)||i||n||t||e}(e);try{return new lr(t)}catch(e){return null}}}class hr{constructor(){this.providerId=hr.PROVIDER_ID}static credential(e,t){return ir._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=lr.parseLink(t);return jn(n,"argument-error"),ir._fromEmailAndCode(e,n.code,n.tenantId)}}hr.PROVIDER_ID="password",hr.EMAIL_PASSWORD_SIGN_IN_METHOD="password",hr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ur{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class dr extends ur{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class pr extends dr{constructor(){super("facebook.com")}static credential(e){return sr._fromParams({providerId:pr.PROVIDER_ID,signInMethod:pr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pr.credentialFromTaggedObject(e)}static credentialFromError(e){return pr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return pr.credential(e.oauthAccessToken)}catch(e){return null}}}pr.FACEBOOK_SIGN_IN_METHOD="facebook.com",pr.PROVIDER_ID="facebook.com";class fr extends dr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return sr._fromParams({providerId:fr.PROVIDER_ID,signInMethod:fr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return fr.credentialFromTaggedObject(e)}static credentialFromError(e){return fr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return fr.credential(t,n)}catch(e){return null}}}fr.GOOGLE_SIGN_IN_METHOD="google.com",fr.PROVIDER_ID="google.com";class gr extends dr{constructor(){super("github.com")}static credential(e){return sr._fromParams({providerId:gr.PROVIDER_ID,signInMethod:gr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gr.credentialFromTaggedObject(e)}static credentialFromError(e){return gr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return gr.credential(e.oauthAccessToken)}catch(e){return null}}}gr.GITHUB_SIGN_IN_METHOD="github.com",gr.PROVIDER_ID="github.com";class mr extends dr{constructor(){super("twitter.com")}static credential(e,t){return sr._fromParams({providerId:mr.PROVIDER_ID,signInMethod:mr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return mr.credentialFromTaggedObject(e)}static credentialFromError(e){return mr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return mr.credential(t,n)}catch(e){return null}}}mr.TWITTER_SIGN_IN_METHOD="twitter.com",mr.PROVIDER_ID="twitter.com";class _r{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const r=await vi._fromIdTokenResponse(e,n,i),s=yr(n);return new _r({user:r,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=yr(n);return new _r({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function yr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class vr extends S{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,vr.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new vr(e,t,n,i)}}function wr(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw vr._fromErrorAndOperation(e,n,t,i);throw n}))}function Ir(e,t){return Qn(e,"POST","/v2/accounts/mfaEnrollment:start",Jn(e,t))}new WeakMap;const br="__sak";class Cr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(br,"1"),this.storage.removeItem(br),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Tr extends Cr{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Li(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);!function(){const e=w();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||r===e.newValue||e.newValue===e.oldValue?i():setTimeout(i,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Tr.type="LOCAL";const Er=Tr;class Sr extends Cr{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Sr.type="SESSION";const kr=Sr;class Pr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Pr(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map((async e=>e(t.origin,r))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Nr(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Pr.receivers=[];class Rr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const c=Nr("",20);i.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(l),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Ar(){return window}function Or(){return void 0!==Ar().WorkerGlobalScope&&"function"==typeof Ar().importScripts}const xr="firebaseLocalStorageDb",Dr="firebaseLocalStorage",Lr="fbase_key";class Mr{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Ur(e,t){return e.transaction([Dr],t?"readwrite":"readonly").objectStore(Dr)}function Fr(){const e=indexedDB.open(xr,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Dr,{keyPath:Lr})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Dr)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(xr);return new Mr(e).toPromise()}(),t(await Fr()))}))}))}async function jr(e,t,n){const i=Ur(e,!0).put({[Lr]:t,value:n});return new Mr(i).toPromise()}function qr(e,t){const n=Ur(e,!0).delete(t);return new Mr(n).toPromise()}class $r{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Fr()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Or()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Pr._getInstance(Or()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Rr(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Fr();return await jr(e,br,"1"),await qr(e,br),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>jr(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Ur(e,!1).get(t),i=await new Mr(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>qr(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Ur(e,!1).getAll();return new Mr(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}$r.type="LOCAL";const Wr=$r;function Vr(e,t){return Qn(e,"POST","/v2/accounts/mfaSignIn:start",Jn(e,t))}Bi("rcb"),new Bn(3e4,6e4);const Br="recaptcha";async function Hr(e,t,n){var i;if(!e._getRecaptchaConfig())try{await async function(e){const t=qi(e),n=await oi(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),i=new si(n);null==t.tenantId?t._agentRecaptchaConfig=i:t._tenantRecaptchaConfigs[t.tenantId]=i,i.isAnyProviderEnabled()&&new Gi(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){jn("enroll"===t.type,e,"internal-error");const i=Ji(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",(async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===Ki?(jn((null==n?void 0:n.type)===Br,e,"argument-error"),Ir(e,await zr(e,t,n))):Ir(e,t)),"PHONE_PROVIDER"),s=await i.catch((e=>Promise.reject(e)));return s.phoneSessionInfo.sessionInfo}{jn("signin"===t.type,e,"internal-error");const s=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;jn(s,e,"missing-multi-factor-info");const o=Ji(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",(async(e,t)=>t.phoneSignInInfo.captchaResponse===Ki?(jn((null==n?void 0:n.type)===Br,e,"argument-error"),Vr(e,await zr(e,t,n))):Vr(e,t)),"PHONE_PROVIDER"),a=await o.catch((e=>Promise.reject(e)));return a.phoneResponseInfo.sessionInfo}}{const t=Ji(e,{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",(async(e,t)=>t.captchaResponse===Ki?(jn((null==n?void 0:n.type)===Br,e,"argument-error"),or(e,await zr(e,t,n))):or(e,t)),"PHONE_PROVIDER"),i=await t.catch((e=>Promise.reject(e)));return i.sessionInfo}}finally{null==n||n._reset()}}async function zr(e,t,n){jn(n.type===Br,e,"argument-error");const i=await n.verify();jn("string"==typeof i,e,"argument-error");const r=Object.assign({},t);if("phoneEnrollmentInfo"in r){const e=r.phoneEnrollmentInfo.phoneNumber,t=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,s=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:s}}),r}if("phoneSignInInfo"in r){const e=r.phoneSignInInfo.captchaResponse,t=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),r}return Object.assign(r,{recaptchaToken:i}),r}class Kr{constructor(e){this.providerId=Kr.PROVIDER_ID,this.auth=qi(e)}verifyPhoneNumber(e,t){return Hr(this.auth,e,K(t))}static credential(e,t){return cr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Kr.credentialFromTaggedObject(t)}static credentialFromError(e){return Kr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?cr._fromTokenResponse(t,n):null}}function Gr(e,t){return t?Ii(t):(jn(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Kr.PROVIDER_ID="phone",Kr.PHONE_SIGN_IN_METHOD="phone";class Yr extends er{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return rr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return rr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return rr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Jr(e){return async function(e,t,n=!1){if(ot(e.app))return Promise.reject(Un(e));const i="signIn",r=await wr(e,i,t),s=await _r._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}(e.auth,new Yr(e),e.bypassAuthState)}function Qr(e){const{auth:t,user:n}=e;return jn(n,t,"internal-error"),async function(e,t,n=!1){const{auth:i}=e;if(ot(i.app))return Promise.reject(Un(i));const r="reauthenticate";try{const s=await di(e,wr(i,r,t,e),n);jn(s.idToken,i,"internal-error");const o=hi(s.idToken);jn(o,i,"internal-error");const{sub:a}=o;return jn(e.uid===a,i,"user-mismatch"),_r._forOperation(e,r,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Dn(i,"user-mismatch"),e}}(n,new Yr(e),e.bypassAuthState)}async function Xr(e){const{auth:t,user:n}=e;return jn(n,t,"internal-error"),async function(e,t,n=!1){const i=await di(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return _r._forOperation(e,"link",i)}(n,new Yr(e),e.bypassAuthState)}class Zr{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Jr;case"linkViaPopup":case"linkViaRedirect":return Xr;case"reauthViaPopup":case"reauthViaRedirect":return Qr;default:Dn(this.auth,"internal-error")}}resolve(e){$n(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){$n(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const es=new Bn(2e3,1e4);async function ts(e,t,n){if(ot(e.app))return Promise.reject(Ln(e,"operation-not-supported-in-this-environment"));const i=qi(e);!function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Dn(e,"argument-error"),Mn(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t,ur);const r=Gr(i,n);return new ns(i,"signInViaPopup",t,r).executeNotNull()}class ns extends Zr{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,ns.currentPopupAction&&ns.currentPopupAction.cancel(),ns.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return jn(e,this.auth,"internal-error"),e}async onExecution(){$n(1===this.filter.length,"Popup operations only handle one event");const e=Nr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Ln(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Ln(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ns.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Ln(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,es.get())};e()}}ns.currentPopupAction=null;const is=new Map;class rs extends Zr{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=is.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return Ti("pendingRedirect",e.config.apiKey,e.name)}(t),i=function(e){return Ii(e._redirectPersistence)}(e);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}is.set(this.auth._key(),e)}return this.bypassAuthState||is.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function ss(e,t){is.set(e._key(),t)}async function os(e,t,n=!1){if(ot(e.app))return Promise.reject(Un(e));const i=qi(e),r=Gr(i,t),s=new rs(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class as{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ls(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!ls(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ln(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(cs(e))}saveEventToCache(e){this.cachedEventUids.add(cs(e)),this.lastProcessedEventTime=Date.now()}}function cs(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function ls({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const hs=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,us=/^https?/;function ds(e){const t=Wn(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!us.test(n))return!1;if(hs.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const ps=new Bn(3e4,6e4);function fs(){const e=Ar().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function gs(e){return new Promise(((t,n)=>{var i,r,s;function o(){fs(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{fs(),n(Ln(e,"network-request-failed"))},timeout:ps.get()})}if(null===(r=null===(i=Ar().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Ar().gapi)||void 0===s?void 0:s.load)){const t=Bi("iframefcb");return Ar()[t]=()=>{gapi.load?o():n(Ln(e,"network-request-failed"))},Vi(`${Wi.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw ms=null,e}))}let ms=null;const _s=new Bn(5e3,15e3),ys={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vs=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ws(e){const t=e.config;jn(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Hn(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:lt},r=vs.get(e.config.apiHost);r&&(i.eid=r);const s=e._getFrameworks();return s.length&&(i.fw=s.join(",")),`${n}?${F(i).slice(1)}`}const Is={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class bs{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Cs=encodeURIComponent("fac");async function Ts(e,t,n,i,r,s){jn(e.config.authDomain,e,"auth-domain-config-required"),jn(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:lt,eventId:r};if(t instanceof ur){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",D(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof dr){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),l=c?`#${Cs}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?Hn(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${F(a).slice(1)}${l}`}const Es="webStorageSupport",Ss=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=kr,this._completeRedirectFn=os,this._overrideRedirectResult=ss}async _openPopup(e,t,n,i){var r;return $n(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Is),{width:i.toString(),height:r.toString(),top:s,left:o}),l=w().toLowerCase();n&&(a=Ni(l)?"_blank":n),ki(l)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=w()){var t;return Di(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new bs(null);const u=window.open(t||"",a,h);jn(u,e,"popup-blocked");try{u.focus()}catch(e){}return new bs(u)}(e,await Ts(e,t,n,Wn(),i),Nr())}async _openRedirect(e,t,n,i){return await this._originValidation(e),r=await Ts(e,t,n,Wn(),i),Ar().location.href=r,new Promise((()=>{}));var r}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):($n(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return ms=ms||gs(e),ms}(e),n=Ar().gapi;return jn(n,e,"internal-error"),t.open({where:document.body,url:ws(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ys,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const r=Ln(e,"network-request-failed"),s=Ar().setTimeout((()=>{i(r)}),_s.get());function o(){Ar().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{i(r)}))}))))}(e),n=new as(e);return t.register("authEvent",(t=>(jn(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Es,{type:Es},(n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[Es];void 0!==r&&t(!!r),Dn(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Qn(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(ds(e))return}catch(e){}Dn(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Li()||Pi()||Di()}};var ks="@firebase/auth",Ps="1.10.1";class Ns{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){jn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Rs=_("authIdTokenMaxAge")||300;let As=null;function Os(e=ut()){const t=st(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=st(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(M(n.getOptions(),null!=t?t:{}))return e;Dn(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Ss,persistence:[Wr,Er,kr]}),i=_("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Rs)return;const i=null==t?void 0:t.token;As!==i&&(As=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(e,t,n){K(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e){K(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}}var r;const s=f("auth");return s&&Qi(n,`http://${s}`),n}var xs,Ds;xs={loadJS:e=>new Promise(((t,n)=>{const i=document.createElement("script");var r,s;i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=Ln("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(null!==(s=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==s?s:document).appendChild(i)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Wi=xs,Ds="Browser",rt(new G("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;jn(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Ds,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Mi(Ds)},c=new ji(n,i,r,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Ii);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),rt(new G("auth-internal",(e=>{return t=qi(e.getProvider("auth").getImmediate()),new Ns(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),dt(ks,Ps,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Ds)),dt(ks,Ps,"esm2017");const Ls="@firebase/database",Ms="1.0.14";let Us="";class Fs{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),R(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:N(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class js{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return O(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const qs=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Fs(t)}}catch(e){}return new js},$s=qs("localStorage"),Ws=qs("sessionStorage"),Vs=new re("@firebase/database"),Bs=function(){let e=1;return function(){return e++}}(),Hs=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);if(s>=55296&&s<=56319){const t=s-55296;r++,i(r<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(r)-56320)}s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):s<65536?(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t}(e),n=new $;n.update(t);const r=n.digest();return o.encodeByteArray(r)},zs=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=zs.apply(null,i):t+="object"==typeof i?R(i):i,t+=" "}return t};let Ks=null,Gs=!0;const Ys=function(...e){if(!0===Gs&&(Gs=!1,null===Ks&&!0===Ws.get("logging_enabled")&&(t=!0,i(!n||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Vs.logLevel=Z.VERBOSE,Ks=Vs.log.bind(Vs),n&&Ws.set("logging_enabled",!0)):"function"==typeof t?Ks=t:(Ks=null,Ws.remove("logging_enabled")))),Ks){const t=zs.apply(null,e);Ks(t)}var t,n},Js=function(e){return function(...t){Ys(e,...t)}},Qs=function(...e){const t="FIREBASE INTERNAL ERROR: "+zs(...e);Vs.error(t)},Xs=function(...e){const t=`FIREBASE FATAL ERROR: ${zs(...e)}`;throw Vs.error(t),new Error(t)},Zs=function(...e){const t="FIREBASE WARNING: "+zs(...e);Vs.warn(t)},eo=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},to="[MIN_NAME]",no="[MAX_NAME]",io=function(e,t){if(e===t)return 0;if(e===to||t===no)return-1;if(t===to||e===no)return 1;{const n=uo(e),i=uo(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},ro=function(e,t){return e===t?0:e<t?-1:1},so=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+R(t))},oo=function(e){if("object"!=typeof e||null===e)return R(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=R(t[i]),n+=":",n+=oo(e[t[i]]);return n+="}",n},ao=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function co(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const lo=function(e){i(!eo(e),"Invalid JSON number");let t,n,r,s,o;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=s+1023,r=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},ho=new RegExp("^-?(0*)\\d{1,10}$"),uo=function(e){if(ho.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},po=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw Zs("Exception was thrown by user callback.",t),e}),Math.floor(0))}},fo=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class go{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,ot(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){Zs(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class mo{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(Ys("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Zs(e)}}class _o{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}_o.OWNER="owner";const yo="5",vo=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,wo="ac",Io="websocket",bo="long_polling";class Co{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,c=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=$s.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&$s.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function To(e,t,n){let r;if(i("string"==typeof t,"typeof type must == string"),i("object"==typeof n,"typeof params must == object"),t===Io)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==bo)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const s=[];return co(n,((e,t)=>{s.push(e+"="+t)})),r+s.join("&")}class Eo{constructor(){this.counters_={}}incrementCounter(e,t=1){O(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return u(this.counters_)}}const So={},ko={};function Po(e){const t=e.toString();return So[t]||(So[t]=new Eo),So[t]}class No{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&po((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Ro="start";class Ao{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Js(e),this.stats_=Po(t),this.urlFn=e=>(this.appCheckToken&&(e[wo]=this.appCheckToken),To(t,bo,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new No(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Oo(((...e)=>{const[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Ro)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[Ro]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=yo,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[wo]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&vo.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ao.forceAllow_=!0}static forceDisallow(){Ao.forceDisallow_=!0}static isAvailable(){return!(!Ao.forceAllow_&&(Ao.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=R(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=c(t),i=ao(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=R(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Oo{constructor(e,t,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Bs(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Oo.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){Ys("frame writing exception"),e.stack&&Ys(e.stack),Ys(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ys("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{Ys("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let xo=null;"undefined"!=typeof MozWebSocket?xo=MozWebSocket:"undefined"!=typeof WebSocket&&(xo=WebSocket);class Do{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Js(this.connId),this.stats_=Po(t),this.connURL=Do.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){const s={};return s.v=yo,"undefined"!=typeof location&&location.hostname&&vo.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s[wo]=i),r&&(s.p=r),To(e,Io,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,$s.set("previous_websocket_failure",!0);try{let e;0,this.mySock=new xo(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Do.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==xo&&!Do.forceDisallow_}static previouslyFailed(){return $s.isInMemoryStorage||!0===$s.get("previous_websocket_failure")}markConnectionHealthy(){$s.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=N(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(i(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=R(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=ao(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Do.responsesRequiredToBeHealthy=2,Do.healthyTimeout=3e4;class Lo{static get ALL_TRANSPORTS(){return[Ao,Do]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Do&&Do.isAvailable();let n=t&&!Do.previouslyFailed();if(e.webSocketOnly&&(t||Zs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Do];else{const e=this.transports_=[];for(const t of Lo.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);Lo.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Lo.globalTransportInitialized_=!1;class Mo{constructor(e,t,n,i,r,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Js("c:"+this.id+":"),this.transportManager_=new Lo(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=fo((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=so("t",e),n=so("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=so("t",e),n=so("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=so("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Qs("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Qs("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),yo!==n&&Zs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),fo((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):fo((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&($s.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Uo{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Fo{constructor(e){this.allowedEvents_=e,this.listeners_={},i(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){i(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class jo extends Fo{static getInstance(){return new jo}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||I()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}getInitialEvent(e){return i("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class qo{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function $o(){return new qo("")}function Wo(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Vo(e){return e.pieces_.length-e.pieceNum_}function Bo(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new qo(e.pieces_,t)}function Ho(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function zo(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Ko(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new qo(t,0)}function Go(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof qo)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new qo(n,0)}function Yo(e){return e.pieceNum_>=e.pieces_.length}function Jo(e,t){const n=Wo(e),i=Wo(t);if(null===n)return t;if(n===i)return Jo(Bo(e),Bo(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Qo(e,t){if(Vo(e)!==Vo(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function Xo(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(Vo(e)>Vo(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class Zo{constructor(e,t){this.errorPrefix_=t,this.parts_=zo(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=H(this.parts_[e]);ea(this)}}function ea(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+ta(e))}function ta(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class na extends Fo{static getInstance(){return new na}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}getInitialEvent(e){return i("visible"===e,"Unknown event type: "+e),[this.visible_]}}const ia=1e3;class ra extends Uo{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=ra.nextPersistentConnectionId_++,this.log_=Js("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ia,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");na.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&jo.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,s={r,a:e,b:t};this.log_(R(s)),i(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new y,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),i(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),i(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,(r=>{const s=r.d,o=r.s;ra.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&O(e,"w")){const n=x(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();Zs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=A(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=A(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),i(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();const s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+R(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Qs("Unrecognized action received from server: "+R(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){i(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ia,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ia,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=ia),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+ra.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,n())},l=function(e){i(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[i,c]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Ys("getToken() completed but was canceled"):(Ys("getToken() completed. Creating connection."),this.authToken_=i&&i.accessToken,this.appCheckToken_=c&&c.token,a=new Mo(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{Zs(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&Zs(e),c())}}}interrupt(e){Ys("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ys("Resuming connection for reason: "+e),delete this.interruptReasons_[e],D(this.interruptReasons_)&&(this.reconnectDelay_=ia,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>oo(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new qo(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){Ys("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Ys("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Us.replace(/\./g,"-")]=1,I()?e["framework.cordova"]=1:C()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=jo.getInstance().currentlyOnline();return D(this.interruptReasons_)&&e}}ra.nextPersistentConnectionId_=0,ra.nextConnectionId_=0;class sa{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new sa(e,t)}}class oa{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new sa(to,e),i=new sa(to,t);return 0!==this.compare(n,i)}minPost(){return sa.MIN}}let aa;class ca extends oa{static get __EMPTY_NODE(){return aa}static set __EMPTY_NODE(e){aa=e}compare(e,t){return io(e.name,t.name)}isDefinedOn(e){throw r("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return sa.MIN}maxPost(){return new sa(no,aa)}makePost(e,t){return i("string"==typeof e,"KeyIndex indexValue must always be a string."),new sa(e,aa)}toString(){return".key"}}const la=new ca;class ha{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class ua{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:ua.RED,this.left=null!=i?i:da.EMPTY_NODE,this.right=null!=r?r:da.EMPTY_NODE}copy(e,t,n,i,r){return new ua(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return da.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return da.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,ua.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,ua.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}ua.RED=!0,ua.BLACK=!1;class da{constructor(e,t=da.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new da(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ua.BLACK,null,null))}remove(e){return new da(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ua.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ha(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ha(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ha(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ha(this.root_,null,this.comparator_,!0,e)}}function pa(e,t){return io(e.name,t.name)}function fa(e,t){return io(e,t)}let ga;da.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new ua(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const ma=function(e){return"number"==typeof e?"number:"+lo(e):"string:"+e},_a=function(e){if(e.isLeafNode()){const t=e.val();i("string"==typeof t||"number"==typeof t||"object"==typeof t&&O(t,".sv"),"Priority must be a string or number.")}else i(e===ga||e.isEmpty(),"priority of unexpected type.");i(e===ga||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let ya,va,wa;class Ia{static set __childrenNodeConstructor(e){ya=e}static get __childrenNodeConstructor(){return ya}constructor(e,t=Ia.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,i(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),_a(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ia(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Ia.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Yo(e)?this:".priority"===Wo(e)?this.priorityNode_:Ia.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Ia.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=Wo(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(i(".priority"!==n||1===Vo(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Ia.__childrenNodeConstructor.EMPTY_NODE.updateChild(Bo(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+ma(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?lo(this.value_):this.value_,this.lazyHash_=Hs(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ia.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ia.__childrenNodeConstructor?-1:(i(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=Ia.VALUE_TYPE_ORDER.indexOf(t),s=Ia.VALUE_TYPE_ORDER.indexOf(n);return i(r>=0,"Unknown leaf type: "+t),i(s>=0,"Unknown leaf type: "+n),r===s?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Ia.VALUE_TYPE_ORDER=["object","boolean","number","string"];const ba=new class extends oa{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?io(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return sa.MIN}maxPost(){return new sa(no,new Ia("[PRIORITY-POST]",wa))}makePost(e,t){const n=va(e);return new sa(t,new Ia("[PRIORITY-POST]",n))}toString(){return".priority"}},Ca=Math.log(2);class Ta{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ca,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ea=function(e,t,n,i){e.sort(t);const r=function(t,i){const s=i-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new ua(a,o.node,ua.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=r(t,c),h=r(c+1,i);return o=e[c],a=n?n(o):o,new ua(a,o.node,ua.BLACK,l,h)}},s=function(t){let i=null,s=null,o=e.length;const a=function(t,i){const s=o-t,a=o;o-=t;const l=r(s+1,a),h=e[s],u=n?n(h):h;c(new ua(u,h.node,i,null,l))},c=function(e){i?(i.left=e,i=e):(s=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,ua.BLACK):(a(i,ua.BLACK),a(i,ua.RED))}return s}(new Ta(e.length));return new da(i||t,s)};let Sa;const ka={};class Pa{static get Default(){return i(ka&&ba,"ChildrenNode.ts has not been loaded"),Sa=Sa||new Pa({".priority":ka},{".priority":ba}),Sa}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=x(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof da?t:null}hasIndex(e){return O(this.indexSet_,e.toString())}addIndex(e,t){i(e!==la,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const s=t.getIterator(sa.Wrap);let o,a=s.getNext();for(;a;)r=r||e.isDefinedOn(a.node),n.push(a),a=s.getNext();o=r?Ea(n,e.getCompare()):ka;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const h=Object.assign({},this.indexes_);return h[c]=o,new Pa(h,l)}addToIndexes(e,t){const n=L(this.indexes_,((n,r)=>{const s=x(this.indexSet_,r);if(i(s,"Missing index implementation for "+r),n===ka){if(s.isDefinedOn(e.node)){const n=[],i=t.getIterator(sa.Wrap);let r=i.getNext();for(;r;)r.name!==e.name&&n.push(r),r=i.getNext();return n.push(e),Ea(n,s.getCompare())}return ka}{const i=t.get(e.name);let r=n;return i&&(r=r.remove(new sa(e.name,i))),r.insert(e,e.node)}}));return new Pa(n,this.indexSet_)}removeFromIndexes(e,t){const n=L(this.indexes_,(n=>{if(n===ka)return n;{const i=t.get(e.name);return i?n.remove(new sa(e.name,i)):n}}));return new Pa(n,this.indexSet_)}}let Na;class Ra{static get EMPTY_NODE(){return Na||(Na=new Ra(new da(fa),null,Pa.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&_a(this.priorityNode_),this.children_.isEmpty()&&i(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Na}updatePriority(e){return this.children_.isEmpty()?this:new Ra(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Na:t}}getChild(e){const t=Wo(e);return null===t?this:this.getImmediateChild(t).getChild(Bo(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(i(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new sa(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const s=i.isEmpty()?Na:this.priorityNode_;return new Ra(i,s,r)}}updateChild(e,t){const n=Wo(e);if(null===n)return t;{i(".priority"!==Wo(e)||1===Vo(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(Bo(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,r=!0;if(this.forEachChild(ba,((s,o)=>{t[s]=o.val(e),n++,r&&Ra.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1})),!e&&r&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+ma(this.getPriority().val())+":"),this.forEachChild(ba,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":Hs(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new sa(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new sa(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new sa(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,sa.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,sa.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Aa?-1:0}withIndex(e){if(e===la||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Ra(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===la||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(ba),n=t.getIterator(ba);let i=e.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=e.getNext(),r=n.getNext()}return null===i&&null===r}return!1}return!1}}resolveIndex_(e){return e===la?null:this.indexMap_.get(e.toString())}}Ra.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Aa=new class extends Ra{constructor(){super(new da(fa),Ra.EMPTY_NODE,Pa.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ra.EMPTY_NODE}isEmpty(){return!1}};function Oa(e,t=null){if(null===e)return Ra.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),i(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Ia(e,Oa(t));if(e instanceof Array){let n=Ra.EMPTY_NODE;return co(e,((t,i)=>{if(O(e,t)&&"."!==t.substring(0,1)){const e=Oa(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(Oa(t))}{const n=[];let i=!1;if(co(e,((e,t)=>{if("."!==e.substring(0,1)){const r=Oa(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new sa(e,r)))}})),0===n.length)return Ra.EMPTY_NODE;const r=Ea(n,pa,(e=>e.name),fa);if(i){const e=Ea(n,ba.getCompare());return new Ra(r,Oa(t),new Pa({".priority":e},{".priority":ba}))}return new Ra(r,Oa(t),Pa.Default)}}Object.defineProperties(sa,{MIN:{value:new sa(to,Ra.EMPTY_NODE)},MAX:{value:new sa(no,Aa)}}),ca.__EMPTY_NODE=Ra.EMPTY_NODE,Ia.__childrenNodeConstructor=Ra,ga=Aa,wa=Aa,function(e){va=e}(Oa);class xa extends oa{constructor(e){super(),this.indexPath_=e,i(!Yo(e)&&".priority"!==Wo(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?io(e.name,t.name):r}makePost(e,t){const n=Oa(e),i=Ra.EMPTY_NODE.updateChild(this.indexPath_,n);return new sa(t,i)}maxPost(){const e=Ra.EMPTY_NODE.updateChild(this.indexPath_,Aa);return new sa(no,e)}toString(){return zo(this.indexPath_,0).join("/")}}const Da=new class extends oa{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?io(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return sa.MIN}maxPost(){return sa.MAX}makePost(e,t){const n=Oa(e);return new sa(t,n)}toString(){return".value"}};function La(e){return{type:"value",snapshotNode:e}}function Ma(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Ua(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Fa(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ja{constructor(e){this.index_=e}updateChild(e,t,n,r,s,o){i(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Ua(t,a)):i(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ma(t,n)):o.trackChildChange(Fa(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(ba,((e,i)=>{t.hasChild(e)||n.trackChildChange(Ua(e,i))})),t.isLeafNode()||t.forEachChild(ba,((t,i)=>{if(e.hasChild(t)){const r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(Fa(t,i,r))}else n.trackChildChange(Ma(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Ra.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class qa{constructor(e){this.indexedFilter_=new ja(e.getIndex()),this.index_=e.getIndex(),this.startPost_=qa.getStartPost_(e),this.endPost_=qa.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new sa(t,n))||(n=Ra.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Ra.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(Ra.EMPTY_NODE);const r=this;return t.forEachChild(ba,((e,t)=>{r.matches(new sa(e,t))||(i=i.updateImmediateChild(e,Ra.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class $a{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new qa(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return this.rangedFilter_.matches(new sa(t,n))||(n=Ra.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=Ra.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=Ra.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(Ra.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,Ra.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,s){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;i(a.numChildren()===this.limit_,"");const c=new sa(t,n),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){const e=a.getImmediateChild(t);let i=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=i&&(i.name===t||a.hasChild(i.name));)i=r.getChildAfterChild(this.index_,i,this.reverse_);const u=null==i?1:o(i,c);if(h&&!n.isEmpty()&&u>=0)return null!=s&&s.trackChildChange(Fa(t,n,e)),a.updateImmediateChild(t,n);{null!=s&&s.trackChildChange(Ua(t,e));const n=a.updateImmediateChild(t,Ra.EMPTY_NODE);return null!=i&&this.rangedFilter_.matches(i)?(null!=s&&s.trackChildChange(Ma(i.name,i.node)),n.updateImmediateChild(i.name,i.node)):n}}return n.isEmpty()?e:h&&o(l,c)>=0?(null!=s&&(s.trackChildChange(Ua(l.name,l.node)),s.trackChildChange(Ma(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(l.name,Ra.EMPTY_NODE)):e}}class Wa{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ba}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return i(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return i(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:to}hasEnd(){return this.endSet_}getIndexEndValue(){return i(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return i(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:no}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return i(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ba}copy(){const e=new Wa;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Va(e){const t={};if(e.isDefault())return t;let n;if(e.index_===ba?n="$priority":e.index_===Da?n="$value":e.index_===la?n="$key":(i(e.index_ instanceof xa,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=R(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=R(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+R(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=R(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+R(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Ba(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==ba&&(t.i=e.index_.toString()),t}class Ha extends Uo{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(i(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=Js("p:rest:"),this.listens_={}}listen(e,t,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const s=Ha.getListenId_(e,n),o={};this.listens_[s]=o;const a=Va(e._queryParams);this.restRequest_(r+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),x(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=Ha.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Va(e._queryParams),n=e._path.toString(),i=new y;return this.restRequest_(n+".json",t,((e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+F(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=N(o.responseText)}catch(e){Zs("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&Zs("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()}))}}class za{constructor(){this.rootNode_=Ra.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Ka(){return{value:null,children:new Map}}function Ga(e,t,n){if(Yo(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=Wo(t);e.children.has(i)||e.children.set(i,Ka()),Ga(e.children.get(i),t=Bo(t),n)}}function Ya(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{Ya(i,new qo(t.toString()+"/"+e),n)}))}class Ja{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&co(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Qa{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ja(e);const n=1e4+2e4*Math.random();fo(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;co(e,((e,i)=>{i>0&&O(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),fo(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Xa,Za;function ec(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(Za=Xa||(Xa={}))[Za.OVERWRITE=0]="OVERWRITE",Za[Za.MERGE=1]="MERGE",Za[Za.ACK_USER_WRITE=2]="ACK_USER_WRITE",Za[Za.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class tc{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Xa.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Yo(this.path)){if(null!=this.affectedTree.value)return i(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new qo(e));return new tc($o(),t,this.revert)}}return i(Wo(this.path)===e,"operationForChild called for unrelated child."),new tc(Bo(this.path),this.affectedTree,this.revert)}}class nc{constructor(e,t){this.source=e,this.path=t,this.type=Xa.LISTEN_COMPLETE}operationForChild(e){return Yo(this.path)?new nc(this.source,$o()):new nc(this.source,Bo(this.path))}}class ic{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Xa.OVERWRITE}operationForChild(e){return Yo(this.path)?new ic(this.source,$o(),this.snap.getImmediateChild(e)):new ic(this.source,Bo(this.path),this.snap)}}class rc{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Xa.MERGE}operationForChild(e){if(Yo(this.path)){const t=this.children.subtree(new qo(e));return t.isEmpty()?null:t.value?new ic(this.source,$o(),t.value):new rc(this.source,$o(),t)}return i(Wo(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new rc(this.source,Bo(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class sc{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Yo(e))return this.isFullyInitialized()&&!this.filtered_;const t=Wo(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class oc{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function ac(e,t,n,i,s,o){const a=i.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw r("Should only compare child_ events.");const i=new sa(t.childName,t.snapshotNode),s=new sa(n.childName,n.snapshotNode);return e.index_.compare(i,s)}(e,t,n))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);s.forEach((r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))}))}))}function cc(e,t){return{eventCache:e,serverCache:t}}function lc(e,t,n,i){return cc(new sc(t,n,i),e.serverCache)}function hc(e,t,n,i){return cc(e.eventCache,new sc(t,n,i))}function uc(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function dc(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let pc;class fc{static fromObject(e){let t=new fc(null);return co(e,((e,n)=>{t=t.set(new qo(e),n)})),t}constructor(e,t=(()=>(pc||(pc=new da(ro)),pc))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:$o(),value:this.value};if(Yo(e))return null;{const n=Wo(e),i=this.children.get(n);if(null!==i){const r=i.findRootMostMatchingPathAndValue(Bo(e),t);return null!=r?{path:Go(new qo(n),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Yo(e))return this;{const t=Wo(e),n=this.children.get(t);return null!==n?n.subtree(Bo(e)):new fc(null)}}set(e,t){if(Yo(e))return new fc(t,this.children);{const n=Wo(e),i=(this.children.get(n)||new fc(null)).set(Bo(e),t),r=this.children.insert(n,i);return new fc(this.value,r)}}remove(e){if(Yo(e))return this.children.isEmpty()?new fc(null):new fc(null,this.children);{const t=Wo(e),n=this.children.get(t);if(n){const i=n.remove(Bo(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new fc(null):new fc(this.value,r)}return this}}get(e){if(Yo(e))return this.value;{const t=Wo(e),n=this.children.get(t);return n?n.get(Bo(e)):null}}setTree(e,t){if(Yo(e))return t;{const n=Wo(e),i=(this.children.get(n)||new fc(null)).setTree(Bo(e),t);let r;return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new fc(this.value,r)}}fold(e){return this.fold_($o(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,r)=>{n[i]=r.fold_(Go(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,$o(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(Yo(e))return null;{const i=Wo(e),r=this.children.get(i);return r?r.findOnPath_(Bo(e),Go(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,$o(),t)}foreachOnPath_(e,t,n){if(Yo(e))return this;{this.value&&n(t,this.value);const i=Wo(e),r=this.children.get(i);return r?r.foreachOnPath_(Bo(e),Go(t,i),n):new fc(null)}}foreach(e){this.foreach_($o(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(Go(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class gc{constructor(e){this.writeTree_=e}static empty(){return new gc(new fc(null))}}function mc(e,t,n){if(Yo(t))return new gc(new fc(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const r=i.path;let s=i.value;const o=Jo(r,t);return s=s.updateChild(o,n),new gc(e.writeTree_.set(r,s))}{const i=new fc(n),r=e.writeTree_.setTree(t,i);return new gc(r)}}}function _c(e,t,n){let i=e;return co(n,((e,n)=>{i=mc(i,Go(t,e),n)})),i}function yc(e,t){if(Yo(t))return gc.empty();{const n=e.writeTree_.setTree(t,new fc(null));return new gc(n)}}function vc(e,t){return null!=wc(e,t)}function wc(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Jo(n.path,t)):null}function Ic(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(ba,((e,n)=>{t.push(new sa(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new sa(e,n.value))})),t}function bc(e,t){if(Yo(t))return e;{const n=wc(e,t);return new gc(null!=n?new fc(n):e.writeTree_.subtree(t))}}function Cc(e){return e.writeTree_.isEmpty()}function Tc(e,t){return Ec($o(),e.writeTree_,t)}function Ec(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,s)=>{".priority"===t?(i(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):n=Ec(Go(e,t),s,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Go(e,".priority"),r)),n}}function Sc(e,t){return Uc(t,e)}function kc(e,t){if(e.snap)return Xo(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Xo(Go(e.path,n),t))return!0;return!1}function Pc(e){return e.visible}function Nc(e,t,n){let i=gc.empty();for(let s=0;s<e.length;++s){const o=e[s];if(t(o)){const e=o.path;let t;if(o.snap)Xo(n,e)?(t=Jo(n,e),i=mc(i,t,o.snap)):Xo(e,n)&&(t=Jo(e,n),i=mc(i,$o(),o.snap.getChild(t)));else{if(!o.children)throw r("WriteRecord should have .snap or .children");if(Xo(n,e))t=Jo(n,e),i=_c(i,t,o.children);else if(Xo(e,n))if(t=Jo(e,n),Yo(t))i=_c(i,$o(),o.children);else{const e=x(o.children,Wo(t));if(e){const n=e.getChild(Bo(t));i=mc(i,$o(),n)}}}}}return i}function Rc(e,t,n,i,r){if(i||r){const s=bc(e.visibleWrites,t);if(!r&&Cc(s))return n;if(r||null!=n||vc(s,$o())){const s=function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(Xo(e.path,t)||Xo(t,e.path))};return Tc(Nc(e.allWrites,s,t),n||Ra.EMPTY_NODE)}return null}{const i=wc(e.visibleWrites,t);if(null!=i)return i;{const i=bc(e.visibleWrites,t);return Cc(i)?n:null!=n||vc(i,$o())?Tc(i,n||Ra.EMPTY_NODE):null}}}function Ac(e,t,n,i){return Rc(e.writeTree,e.treePath,t,n,i)}function Oc(e,t){return function(e,t,n){let i=Ra.EMPTY_NODE;const r=wc(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(ba,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const r=bc(e.visibleWrites,t);return n.forEachChild(ba,((e,t)=>{const n=Tc(bc(r,new qo(e)),t);i=i.updateImmediateChild(e,n)})),Ic(r).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return Ic(bc(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function xc(e,t,n,r){return function(e,t,n,r,s){i(r||s,"Either existingEventSnap or existingServerSnap must exist");const o=Go(t,n);if(vc(e.visibleWrites,o))return null;{const t=bc(e.visibleWrites,o);return Cc(t)?s.getChild(n):Tc(t,s.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function Dc(e,t){return function(e,t){return wc(e.visibleWrites,t)}(e.writeTree,Go(e.treePath,t))}function Lc(e,t,n){return function(e,t,n,i){const r=Go(t,n),s=wc(e.visibleWrites,r);return null!=s?s:i.isCompleteForChild(n)?Tc(bc(e.visibleWrites,r),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Mc(e,t){return Uc(Go(e.treePath,t),e.writeTree)}function Uc(e,t){return{treePath:e,writeTree:t}}class Fc{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;i("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),i(".priority"!==n,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(n);if(s){const i=s.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Fa(n,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Ua(n,s.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Ma(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw r("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(n,Fa(n,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const jc=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class qc{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new sc(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Lc(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:dc(this.viewCache_),r=function(e,t,n,i,r,s){return function(e,t,n,i,r,s,o){let a;const c=bc(e.visibleWrites,t),l=wc(c,$o());if(null!=l)a=l;else{if(null==n)return[];a=Tc(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<r;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,r,s)}(this.writes_,i,t,1,n,e);return 0===r.length?null:r[0]}}function $c(e,t,n,r,s,o){const a=t.eventCache;if(null!=Dc(r,n))return t;{let c,l;if(Yo(n))if(i(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=dc(t),i=Oc(r,n instanceof Ra?n:Ra.EMPTY_NODE);c=e.filter.updateFullNode(t.eventCache.getNode(),i,o)}else{const n=Ac(r,dc(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const h=Wo(n);if(".priority"===h){i(1===Vo(n),"Can't have a priority with additional path components");const s=a.getNode();l=t.serverCache.getNode();const o=xc(r,n,s,l);c=null!=o?e.filter.updatePriority(s,o):a.getNode()}else{const i=Bo(n);let u;if(a.isCompleteForChild(h)){l=t.serverCache.getNode();const e=xc(r,n,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(i,e):a.getNode().getImmediateChild(h)}else u=Lc(r,h,t.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),h,u,i,s,o):a.getNode()}}return lc(t,c,a.isFullyInitialized()||Yo(n),e.filter.filtersNodes())}}function Wc(e,t,n,i,r,s,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(Yo(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),e,null)}else{const e=Wo(n);if(!c.isCompleteForPath(n)&&Vo(n)>1)return t;const r=Bo(n),s=c.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?h.updatePriority(c.getNode(),s):h.updateChild(c.getNode(),e,s,r,jc,null)}const u=hc(t,l,c.isFullyInitialized()||Yo(n),h.filtersNodes());return $c(e,u,n,r,new qc(r,u,s),a)}function Vc(e,t,n,i,r,s,o){const a=t.eventCache;let c,l;const h=new qc(r,t,s);if(Yo(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=lc(t,l,!0,e.filter.filtersNodes());else{const r=Wo(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),c=lc(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=Bo(n),l=a.getNode().getImmediateChild(r);let u;if(Yo(s))u=i;else{const e=h.getCompleteChild(r);u=null!=e?".priority"===Ho(s)&&e.getChild(Ko(s)).isEmpty()?e:e.updateChild(s,i):Ra.EMPTY_NODE}c=l.equals(u)?t:lc(t,e.filter.updateChild(a.getNode(),r,u,s,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function Bc(e,t){return e.eventCache.isCompleteForChild(t)}function Hc(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function zc(e,t,n,i,r,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=Yo(n)?i:new fc(null).setTree(n,i);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const c=Hc(0,t.serverCache.getNode().getImmediateChild(n),i);l=Wc(e,l,new qo(n),c,r,s,o,a)}})),c.children.inorderTraversal(((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!c){const c=Hc(0,t.serverCache.getNode().getImmediateChild(n),i);l=Wc(e,l,new qo(n),c,r,s,o,a)}})),l}class Kc{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new ja(n.getIndex()),r=(s=n).loadsAllData()?new ja(s.getIndex()):s.hasLimit()?new $a(s):new qa(s);var s;this.processor_=function(e){return{filter:e}}(r);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(Ra.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(Ra.EMPTY_NODE,a.getNode(),null),h=new sc(c,o.isFullyInitialized(),i.filtersNodes()),u=new sc(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=cc(u,h),this.eventGenerator_=new oc(this.query_)}get query(){return this.query_}}function Gc(e,t){const n=dc(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Yo(t)&&!n.getImmediateChild(Wo(t)).isEmpty())?n.getChild(t):null}function Yc(e){return 0===e.eventRegistrations_.length}function Jc(e,t,n){const r=[];if(n){i(null==t,"A cancel should cancel all event registrations.");const s=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,s);t&&r.push(t)}))}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function Qc(e,t,n,s){t.type===Xa.MERGE&&null!==t.source.queryId&&(i(dc(e.viewCache_),"We should always have a full cache before handling merges"),i(uc(e.viewCache_),"Missing event cache, even though we have a server cache"));const o=e.viewCache_,a=function(e,t,n,s,o){const a=new Fc;let c,l;if(n.type===Xa.OVERWRITE){const r=n;r.source.fromUser?c=Vc(e,t,r.path,r.snap,s,o,a):(i(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered()&&!Yo(r.path),c=Wc(e,t,r.path,r.snap,s,o,l,a))}else if(n.type===Xa.MERGE){const r=n;r.source.fromUser?c=function(e,t,n,i,r,s,o){let a=t;return i.foreach(((i,c)=>{const l=Go(n,i);Bc(t,Wo(l))&&(a=Vc(e,a,l,c,r,s,o))})),i.foreach(((i,c)=>{const l=Go(n,i);Bc(t,Wo(l))||(a=Vc(e,a,l,c,r,s,o))})),a}(e,t,r.path,r.children,s,o,a):(i(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered(),c=zc(e,t,r.path,r.children,s,o,l,a))}else if(n.type===Xa.ACK_USER_WRITE){const r=n;c=r.revert?function(e,t,n,r,s,o){let a;if(null!=Dc(r,n))return t;{const c=new qc(r,t,s),l=t.eventCache.getNode();let h;if(Yo(n)||".priority"===Wo(n)){let n;if(t.serverCache.isFullyInitialized())n=Ac(r,dc(t));else{const e=t.serverCache.getNode();i(e instanceof Ra,"serverChildren would be complete if leaf node"),n=Oc(r,e)}h=e.filter.updateFullNode(l,n,o)}else{const i=Wo(n);let s=Lc(r,i,t.serverCache);null==s&&t.serverCache.isCompleteForChild(i)&&(s=l.getImmediateChild(i)),h=null!=s?e.filter.updateChild(l,i,s,Bo(n),c,o):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,Ra.EMPTY_NODE,Bo(n),c,o):l,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=Ac(r,dc(t)),a.isLeafNode()&&(h=e.filter.updateFullNode(h,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=Dc(r,$o()),lc(t,h,a,e.filter.filtersNodes())}}(e,t,r.path,s,o,a):function(e,t,n,i,r,s,o){if(null!=Dc(r,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(Yo(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Wc(e,t,n,c.getNode().getChild(n),r,s,a,o);if(Yo(n)){let i=new fc(null);return c.getNode().forEachChild(la,((e,t)=>{i=i.set(new qo(e),t)})),zc(e,t,n,i,r,s,a,o)}return t}{let l=new fc(null);return i.foreach(((e,t)=>{const i=Go(n,e);c.isCompleteForPath(i)&&(l=l.set(e,c.getNode().getChild(i)))})),zc(e,t,n,l,r,s,a,o)}}(e,t,r.path,r.affectedTree,s,o,a)}else{if(n.type!==Xa.LISTEN_COMPLETE)throw r("Unknown operation type: "+n.type);c=function(e,t,n,i,r){const s=t.serverCache;return $c(e,hc(t,s.getNode(),s.isFullyInitialized()||Yo(n),s.isFiltered()),n,i,jc,r)}(e,t,n.path,s,a)}const h=a.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=uc(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(La(uc(t)))}}(t,c,h),{viewCache:c,changes:h}}(e.processor_,o,t,n,s);var c,l;return c=e.processor_,l=a.viewCache,i(l.eventCache.getNode().isIndexed(c.filter.getIndex()),"Event snap not indexed"),i(l.serverCache.getNode().isIndexed(c.filter.getIndex()),"Server snap not indexed"),i(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,Xc(e,a.changes,a.viewCache.eventCache.getNode(),null)}function Xc(e,t,n,i){const r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const r=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),ac(e,r,"child_removed",t,i,n),ac(e,r,"child_added",t,i,n),ac(e,r,"child_moved",s,i,n),ac(e,r,"child_changed",t,i,n),ac(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}let Zc,el;class tl{constructor(){this.views=new Map}}function nl(e,t,n,r){const s=t.source.queryId;if(null!==s){const o=e.views.get(s);return i(null!=o,"SyncTree gave us an op for an invalid query."),Qc(o,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(Qc(s,t,n,r));return i}}function il(e,t,n,i,r,s){const o=function(e,t,n,i,r){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=Ac(n,r?i:null),s=!1;e?s=!0:i instanceof Ra?(e=Oc(n,i),s=!1):(e=Ra.EMPTY_NODE,s=!1);const o=cc(new sc(e,s,!1),new sc(i,r,!1));return new Kc(t,o)}return o}(e,t,i,r,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(ba,((e,t)=>{i.push(Ma(e,t))})),n.isFullyInitialized()&&i.push(La(n.getNode())),Xc(e,i,n.getNode(),t)}(o,n)}function rl(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function sl(e,t){let n=null;for(const i of e.views.values())n=n||Gc(i,t);return n}function ol(e,t){if(t._queryParams.loadsAllData())return ll(e);{const n=t._queryIdentifier;return e.views.get(n)}}function al(e,t){return null!=ol(e,t)}function cl(e){return null!=ll(e)}function ll(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let hl=1;class ul{constructor(e){this.listenProvider_=e,this.syncPointTree_=new fc(null),this.pendingWriteTree_={visibleWrites:gc.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function dl(e,t,n,r,s){return function(e,t,n,r,s){i(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:s}),s&&(e.visibleWrites=mc(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,s),s?yl(e,new ic({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function pl(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));i(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=n&&kc(t,r.path)?s=!1:Xo(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?(function(e){e.visibleWrites=Nc(e.allWrites,Pc,$o()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(r.snap?e.visibleWrites=yc(e.visibleWrites,r.path):co(r.children,(t=>{e.visibleWrites=yc(e.visibleWrites,Go(r.path,t))})),!0))}(e.pendingWriteTree_,t)){let t=new fc(null);return null!=r.snap?t=t.set($o(),!0):co(r.children,(e=>{t=t.set(new qo(e),!0)})),yl(e,new tc(r.path,t,n))}return[]}function fl(e,t,n){return yl(e,new ic({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function gl(e,t,n,r,s=!1){const o=t._path,a=e.syncPointTree_.get(o);let c=[];if(a&&("default"===t._queryIdentifier||al(a,t))){const l=function(e,t,n,r){const s=t._queryIdentifier,o=[];let a=[];const c=cl(e);if("default"===s)for(const[t,i]of e.views.entries())a=a.concat(Jc(i,n,r)),Yc(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||o.push(i.query));else{const t=e.views.get(s);t&&(a=a.concat(Jc(t,n,r)),Yc(t)&&(e.views.delete(s),t.query._queryParams.loadsAllData()||o.push(t.query)))}return c&&!cl(e)&&o.push(new(i(Zc,"Reference.ts has not been loaded"),Zc)(t._repo,t._path)),{removed:o,events:a}}(a,t,n,r);0===a.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(o));const h=l.removed;if(c=l.events,!s){const n=-1!==h.findIndex((e=>e._queryParams.loadsAllData())),i=e.syncPointTree_.findOnPath(o,((e,t)=>cl(t)));if(n&&!i){const t=e.syncPointTree_.subtree(o);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&cl(t))return[ll(t)];{let e=[];return t&&(e=rl(t)),co(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],r=i.query,s=Il(e,i);e.listenProvider_.startListening(kl(r),bl(e,r),s.hashFn,s.onComplete)}}}if(!i&&h.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(kl(t),n)}else h.forEach((t=>{const n=e.queryToTagMap.get(Cl(t));e.listenProvider_.stopListening(kl(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=Cl(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,h)}return c}function ml(e,t,n,r=!1){const s=t._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(s,((e,t)=>{const n=Jo(e,s);o=o||sl(t,n),a=a||cl(t)}));let c,l=e.syncPointTree_.get(s);l?(a=a||cl(l),o=o||sl(l,$o())):(l=new tl,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=o?c=!0:(c=!1,o=Ra.EMPTY_NODE,e.syncPointTree_.subtree(s).foreachChild(((e,t)=>{const n=sl(t,$o());n&&(o=o.updateImmediateChild(e,n))})));const h=al(l,t);if(!h&&!t._queryParams.loadsAllData()){const n=Cl(t);i(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=hl++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let u=il(l,t,n,Sc(e.pendingWriteTree_,s),o,c);if(!h&&!a&&!r){const n=ol(l,t);u=u.concat(function(e,t,n){const r=t._path,s=bl(e,t),o=Il(e,n),a=e.listenProvider_.startListening(kl(t),s,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(r);if(s)i(!cl(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!Yo(e)&&t&&cl(t))return[ll(t).query];{let e=[];return t&&(e=e.concat(rl(t).map((e=>e.query)))),co(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(kl(i),bl(e,i))}}return a}(e,t,n))}return u}function _l(e,t,n){const i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=sl(n,Jo(e,t));if(i)return i}));return Rc(i,t,r,n,!0)}function yl(e,t){return vl(t,e.syncPointTree_,null,Sc(e.pendingWriteTree_,$o()))}function vl(e,t,n,i){if(Yo(e.path))return wl(e,t,n,i);{const r=t.get($o());null==n&&null!=r&&(n=sl(r,$o()));let s=[];const o=Wo(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Mc(i,o);s=s.concat(vl(a,c,e,t))}return r&&(s=s.concat(nl(r,e,i,n))),s}}function wl(e,t,n,i){const r=t.get($o());null==n&&null!=r&&(n=sl(r,$o()));let s=[];return t.children.inorderTraversal(((t,r)=>{const o=n?n.getImmediateChild(t):null,a=Mc(i,t),c=e.operationForChild(t);c&&(s=s.concat(wl(c,r,o,a)))})),r&&(s=s.concat(nl(r,e,i,n))),s}function Il(e,t){const n=t.query,i=bl(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Ra.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=Tl(e,n);if(i){const n=El(i),r=n.path,s=n.queryId,o=Jo(r,t);return Sl(e,r,new nc(ec(s),o))}return[]}(e,n._path,i):function(e,t){return yl(e,new nc({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return gl(e,n,null,i)}}}}function bl(e,t){const n=Cl(t);return e.queryToTagMap.get(n)}function Cl(e){return e._path.toString()+"$"+e._queryIdentifier}function Tl(e,t){return e.tagToQueryMap.get(t)}function El(e){const t=e.indexOf("$");return i(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new qo(e.substr(0,t))}}function Sl(e,t,n){const r=e.syncPointTree_.get(t);return i(r,"Missing sync point for query tag that we're tracking"),nl(r,n,Sc(e.pendingWriteTree_,t),null)}function kl(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(i(el,"Reference.ts has not been loaded"),el)(e._repo,e._path):e}class Pl{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Pl(t)}node(){return this.node_}}class Nl{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Go(this.path_,e);return new Nl(this.syncTree_,t)}node(){return _l(this.syncTree_,this.path_)}}const Rl=function(e,t,n){return e&&"object"==typeof e?(i(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Al(e[".sv"],t,n):"object"==typeof e[".sv"]?Ol(e[".sv"],t):void i(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Al=function(e,t,n){if("timestamp"===e)return n.timestamp;i(!1,"Unexpected server value: "+e)},Ol=function(e,t,n){e.hasOwnProperty("increment")||i(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&i(!1,"Unexpected increment value: "+r);const s=t.node();if(i(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return"number"!=typeof o?r:o+r},xl=function(e,t,n){return Dl(e,new Pl(t),n)};function Dl(e,t,n){const i=e.getPriority().val(),r=Rl(i,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const i=e,s=Rl(i.getValue(),t,n);return s!==i.getValue()||r!==i.getPriority().val()?new Ia(s,Oa(r)):e}{const i=e;return s=i,r!==i.getPriority().val()&&(s=s.updatePriority(new Ia(r))),i.forEachChild(ba,((e,i)=>{const r=Dl(i,t.getImmediateChild(e),n);r!==i&&(s=s.updateImmediateChild(e,r))})),s}}class Ll{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Ml(e,t){let n=t instanceof qo?t:new qo(t),i=e,r=Wo(n);for(;null!==r;){const e=x(i.node.children,r)||{children:{},childCount:0};i=new Ll(r,i,e),n=Bo(n),r=Wo(n)}return i}function Ul(e){return e.node.value}function Fl(e,t){e.node.value=t,Vl(e)}function jl(e){return e.node.childCount>0}function ql(e,t){co(e.node.children,((n,i)=>{t(new Ll(n,e,i))}))}function $l(e,t,n,i){n&&!i&&t(e),ql(e,(e=>{$l(e,t,!0,i)})),n&&i&&t(e)}function Wl(e){return new qo(null===e.parent?e.name:Wl(e.parent)+"/"+e.name)}function Vl(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===Ul(e)&&!jl(e)}(n),r=O(e.node.children,t);i&&r?(delete e.node.children[t],e.node.childCount--,Vl(e)):i||r||(e.node.children[t]=n.node,e.node.childCount++,Vl(e))}(e.parent,e.name,e)}const Bl=/[\[\].#$\/\u0000-\u001F\u007F]/,Hl=/[\[\].#$\u0000-\u001F\u007F]/,zl=10485760,Kl=function(e){return"string"==typeof e&&0!==e.length&&!Bl.test(e)},Gl=function(e){return"string"==typeof e&&0!==e.length&&!Hl.test(e)},Yl=function(e,t,n){const i=n instanceof qo?new Zo(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+ta(i));if("function"==typeof t)throw new Error(e+"contains a function "+ta(i)+" with contents = "+t.toString());if(eo(t))throw new Error(e+"contains "+t.toString()+" "+ta(i));if("string"==typeof t&&t.length>zl/3&&H(t)>zl)throw new Error(e+"contains a string greater than "+zl+" utf8 bytes "+ta(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(co(t,((t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!Kl(t)))throw new Error(e+" contains an invalid key ("+t+") "+ta(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=H(t),ea(e)}(i,t),Yl(e,s,i),function(e){const t=e.parts_.pop();e.byteLength_-=H(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&r)throw new Error(e+' contains ".value" child '+ta(i)+" in addition to actual children.")}},Jl=function(e,t,n,i){if(!(i&&void 0===n||Gl(n)))throw new Error(B(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')};class Ql{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Xl(e,t){let n=null;for(let i=0;i<t.length;i++){const r=t[i],s=r.getPath();null===n||Qo(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function Zl(e,t,n){Xl(e,n),th(e,(e=>Qo(e,t)))}function eh(e,t,n){Xl(e,n),th(e,(e=>Xo(e,t)||Xo(t,e)))}function th(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];r&&(t(r.path)?(nh(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}function nh(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();Ks&&Ys("event: "+n.toString()),po(i)}}}class ih{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ql,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ka(),this.transactionQueueTree_=new Ll,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function rh(e,t,n){if(e.stats_=Po(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Ha(e.repoInfo_,((t,n,i,r)=>{ah(e,t,n,i,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>ch(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{R(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new ra(e.repoInfo_,t,((t,n,i,r)=>{ah(e,t,n,i,r)}),(t=>{ch(e,t)}),(t=>{!function(e,t){co(t,((t,n)=>{lh(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(t){const n=t.toString();return ko[n]||(ko[n]=new Qa(e.stats_,e.server_)),ko[n]}(e.repoInfo_),e.infoData_=new za,e.infoSyncTree_=new ul({startListening:(t,n,i,r)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=fl(e.infoSyncTree_,t._path,o),setTimeout((()=>{r("ok")}),0)),s},stopListening:()=>{}}),lh(e,"connected",!1),e.serverSyncTree_=new ul({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,((n,i)=>{const s=r(n,i);eh(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function sh(e){const t=e.infoData_.getNode(new qo(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function oh(e){return(t=(t={timestamp:sh(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function ah(e,t,n,i,r){e.dataUpdateCount++;const s=new qo(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){const t=L(n,(e=>Oa(e)));o=function(e,t,n,i){const r=Tl(e,i);if(r){const i=El(r),s=i.path,o=i.queryId,a=Jo(s,t),c=fc.fromObject(n);return Sl(e,s,new rc(ec(o),a,c))}return[]}(e.serverSyncTree_,s,t,r)}else{const t=Oa(n);o=function(e,t,n,i){const r=Tl(e,i);if(null!=r){const i=El(r),s=i.path,o=i.queryId,a=Jo(s,t);return Sl(e,s,new ic(ec(o),a,n))}return[]}(e.serverSyncTree_,s,t,r)}else if(i){const t=L(n,(e=>Oa(e)));o=function(e,t,n){const i=fc.fromObject(n);return yl(e,new rc({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,s,t)}else{const t=Oa(n);o=fl(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=mh(e,s)),eh(e.eventQueue_,a,o)}function ch(e,t){lh(e,"connected",t),!1===t&&function(e){ph(e,"onDisconnectEvents");const t=oh(e),n=Ka();Ya(e.onDisconnect_,$o(),((i,r)=>{const s=function(e,t,n,i){return Dl(t,new Nl(n,e),i)}(i,r,e.serverSyncTree_,t);Ga(n,i,s)}));let i=[];Ya(n,$o(),((t,n)=>{i=i.concat(fl(e.serverSyncTree_,t,n));const r=Ih(e,t);mh(e,r)})),e.onDisconnect_=Ka(),eh(e.eventQueue_,$o(),i)}(e)}function lh(e,t,n){const i=new qo("/.info/"+t),r=Oa(n);e.infoData_.updateSnapshot(i,r);const s=fl(e.infoSyncTree_,i,r);eh(e.eventQueue_,i,s)}function hh(e){return e.nextWriteId_++}function uh(e,t,n,i,r){ph(e,"set",{path:t.toString(),value:n,priority:i});const s=oh(e),o=Oa(n,i),a=_l(e.serverSyncTree_,t),c=xl(o,a,s),l=hh(e),h=dl(e.serverSyncTree_,t,c,l,!0);Xl(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),((n,i)=>{const s="ok"===n;s||Zs("set at "+t+" failed: "+n);const o=pl(e.serverSyncTree_,l,!s);eh(e.eventQueue_,t,o),function(e,t,n,i){t&&po((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let r=e;i&&(r+=": "+i);const s=new Error(r);s.code=e,t(s)}}))}(0,r,n,i)}));const u=Ih(e,t);mh(e,u),eh(e.eventQueue_,u,[])}function dh(e,t,n){let i;i=".info"===Wo(t._path)?gl(e.infoSyncTree_,t,n):gl(e.serverSyncTree_,t,n),Zl(e.eventQueue_,t._path,i)}function ph(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),Ys(n,...t)}function fh(e,t,n){return _l(e.serverSyncTree_,t,n)||Ra.EMPTY_NODE}function gh(e,t=e.transactionQueueTree_){if(t||wh(e,t),Ul(t)){const n=yh(e,t);i(n.length>0,"Sending zero length transaction queue"),n.every((e=>0===e.status))&&function(e,t,n){const r=n.map((e=>e.currentWriteId)),s=fh(e,t,r);let o=s;const a=s.hash();for(let e=0;e<n.length;e++){const r=n[e];i(0===r.status,"tryToSendTransactionQueue_: items in queue should all be run."),r.status=1,r.retryCount++;const s=Jo(t,r.path);o=o.updateChild(s,r.currentOutputSnapshotRaw)}const c=o.val(!0),l=t;e.server_.put(l.toString(),c,(i=>{ph(e,"transaction put response",{path:l.toString(),status:i});let r=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(pl(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();wh(e,Ml(e.transactionQueueTree_,t)),gh(e,e.transactionQueueTree_),eh(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)po(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{Zs("transaction at "+l.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}mh(e,t)}}),a)}(e,Wl(t),n)}else jl(t)&&ql(t,(t=>{gh(e,t)}))}function mh(e,t){const n=_h(e,t),r=Wl(n);return function(e,t,n){if(0===t.length)return;const r=[];let s=[];const o=t.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let c=0;c<t.length;c++){const l=t[c],h=Jo(n,l.path);let u,d=!1;if(i(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,s=s.concat(pl(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)d=!0,u="maxretry",s=s.concat(pl(e.serverSyncTree_,l.currentWriteId,!0));else{const n=fh(e,l.path,o);l.currentInputSnapshot=n;const i=t[c].update(n.val());if(void 0!==i){Yl("transaction failed: Data returned ",i,l.path);let t=Oa(i);"object"==typeof i&&null!=i&&O(i,".priority")||(t=t.updatePriority(n.getPriority()));const r=l.currentWriteId,a=oh(e),c=xl(t,n,a);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=c,l.currentWriteId=hh(e),o.splice(o.indexOf(r),1),s=s.concat(dl(e.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),s=s.concat(pl(e.serverSyncTree_,r,!0))}else d=!0,u="nodata",s=s.concat(pl(e.serverSyncTree_,l.currentWriteId,!0))}eh(e.eventQueue_,n,s),s=[],d&&(t[c].status=2,a=t[c].unwatcher,setTimeout(a,Math.floor(0)),t[c].onComplete&&("nodata"===u?r.push((()=>t[c].onComplete(null,!1,t[c].currentInputSnapshot))):r.push((()=>t[c].onComplete(new Error(u),!1,null)))))}var a;wh(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)po(r[e]);gh(e,e.transactionQueueTree_)}(e,yh(e,n),r),r}function _h(e,t){let n,i=e.transactionQueueTree_;for(n=Wo(t);null!==n&&void 0===Ul(i);)i=Ml(i,n),n=Wo(t=Bo(t));return i}function yh(e,t){const n=[];return vh(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function vh(e,t,n){const i=Ul(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);ql(t,(t=>{vh(e,t,n)}))}function wh(e,t){const n=Ul(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Fl(t,n.length>0?n:void 0)}ql(t,(t=>{wh(e,t)}))}function Ih(e,t){const n=Wl(_h(e,t)),i=Ml(e.transactionQueueTree_,t);return function(e,t){let n=e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(i,(t=>{bh(e,t)})),bh(e,i),$l(i,(t=>{bh(e,t)})),n}function bh(e,t){const n=Ul(t);if(n){const r=[];let s=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(i(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(i(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),s=s.concat(pl(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Fl(t,void 0):n.length=o+1,eh(e.eventQueue_,Wl(t),s);for(let e=0;e<r.length;e++)po(r[e])}}const Ch=function(e,t){const n=Th(e),i=n.namespace;"firebase.com"===n.domain&&Xs(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||Xs("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Zs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Co(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new qo(n.pathString)}},Th=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(r=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Zs(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class Eh{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+R(this.snapshot.exportVal())}}class Sh{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class kh{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return i(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Ph{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return Yo(this._path)?null:Ho(this._path)}get ref(){return new Nh(this._repo,this._path)}get _queryIdentifier(){const e=Ba(this._queryParams),t=oo(e);return"{}"===t?"default":t}get _queryObject(){return Ba(this._queryParams)}isEqual(e){if(!((e=K(e))instanceof Ph))return!1;const t=this._repo===e._repo,n=Qo(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Nh extends Ph{constructor(e,t){super(e,t,new Wa,!1)}get parent(){const e=Ko(this._path);return null===e?null:new Nh(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Rh{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new qo(e),n=Oh(this.ref,e);return new Rh(this._node.getChild(t),n,ba)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,((t,n)=>e(new Rh(n,Oh(this.ref,t),ba))))}hasChild(e){const t=new qo(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ah(e,t){return(e=K(e))._checkNotDeleted("ref"),void 0!==t?Oh(e._root,t):e._root}function Oh(e,t){var n;return null===Wo((e=K(e))._path)?((n=t)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Jl("child","path",n,false)):Jl("child","path",t,!1),new Nh(e._repo,Go(e._path,t))}function xh(e,t){(function(e,t){if(".info"===Wo(t))throw new Error(e+" failed = Can't modify data under /.info/")})("set",(e=K(e))._path),function(e,t,n,i){i&&void 0===t||Yl(B(e,"value"),t,n)}("set",t,e._path,!1);const n=new y;return uh(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}class Dh{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Eh("value",this,new Rh(e.snapshotNode,new Nh(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Sh(this,e,t):null}matches(e){return e instanceof Dh&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Lh{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Sh(this,e,t):null}createEvent(e,t){i(null!=e.childName,"Child events should have a childName.");const n=Oh(new Nh(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Eh(e.type,this,new Rh(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Lh&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function Mh(e,t,n,i){return function(e,t,n,i,r){let s;if("object"==typeof i&&(s=void 0,r=i),"function"==typeof i&&(s=i),r&&r.onlyOnce){const t=n,i=(n,i)=>{dh(e._repo,e,a),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}const o=new kh(n,s||void 0),a="value"===t?new Dh(o):new Lh(t,o);return function(e,t,n){let i;i=".info"===Wo(t._path)?ml(e.infoSyncTree_,t,n):ml(e.serverSyncTree_,t,n),Zl(e.eventQueue_,t._path,i)}(e._repo,e,a),()=>dh(e._repo,e,a)}(e,"value",t,n,i)}!function(e){i(!Zc,"__referenceConstructor has already been defined"),Zc=e}(Nh),function(e){i(!el,"__referenceConstructor has already been defined"),el=e}(Nh);const Uh={};function Fh(e,t,n,i,r){let s=i||e.options.databaseURL;void 0===s&&(e.options.projectId||Xs("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ys("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=Ch(s,r),l=c.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${l.namespace}`,c=Ch(s,r),l=c.repoInfo):o=!c.repoInfo.secure;const h=r&&o?new _o(_o.OWNER):new mo(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Kl(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Gl(e)}(n))throw new Error(B(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",c),Yo(c.path)||Xs("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,i){let r=Uh[t.name];r||(r={},Uh[t.name]=r);let s=r[e.toURLString()];return s&&Xs("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new ih(e,false,n,i),r[e.toURLString()]=s,s}(l,e,h,new go(e,n));return new jh(u,e)}class jh{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(rh(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Nh(this._repo,$o())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=Uh[t];n&&n[e.key]===e||Xs(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Xs("Cannot call "+e+" on a deleted database.")}}function qh(e,t,n,i={}){(e=K(e))._checkNotDeleted("useEmulator");const r=`${t}:${n}`,s=e._repoInternal;if(e._instanceStarted){if(r===e._repoInternal.repoInfo_.host&&M(i,s.repoInfo_.emulatorOptions))return;Xs("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&Xs('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new _o(_o.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:v(i.mockUserToken,e.app.options.projectId);o=new _o(t)}!function(e,t,n,i){e.repoInfo_=new Co(t,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(e.authTokenProvider_=i)}(s,r,i,o)}const $h={".sv":"timestamp"};function Wh(){return $h}ra.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},ra.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Us=lt,rt(new G("database",((e,{instanceIdentifier:t})=>Fh(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),dt(Ls,Ms,void 0),dt(Ls,Ms,"esm2017");const Vh="functions";class Bh{constructor(e,t,n,i){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,ot(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then((e=>this.auth=e),(()=>{})),this.messaging||n.get().then((e=>this.messaging=e),(()=>{})),this.appCheck||null==i||i.get().then((e=>this.appCheck=e),(()=>{}))}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const Hh="us-central1";class zh{constructor(e,t,n,i,r=Hh,s=(...e)=>fetch(...e)){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new Bh(e,t,n,i),this.cancelAllRequests=new Promise((e=>{this.deleteService=()=>Promise.resolve(e())}));try{const e=new URL(r);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=Hh}catch(e){this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}const Kh="@firebase/functions",Gh="0.12.3";function Yh(e,t,n){!function(e,t,n){e.emulatorOrigin=`http://${t}:${n}`}(K(e),t,n)}rt(new G(Vh,((e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new zh(n,i,r,s,t)}),"PUBLIC").setMultipleInstances(!0)),dt(Kh,Gh,void 0),dt(Kh,Gh,"esm2017");const Jh="firebasestorage.googleapis.com";class Qh extends S{constructor(e,t,n=0){super(eu(e),`Firebase Storage: ${t} (${eu(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Qh.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return eu(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Xh,Zh;function eu(e){return"storage/"+e}function tu(e){return new Qh(Xh.INVALID_ARGUMENT,e)}function nu(){return new Qh(Xh.APP_DELETED,"The Firebase app was deleted.")}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Xh||(Xh={}));class iu{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=iu.makeFromUrl(e,t)}catch(t){return new iu(e,"")}if(""===n.path)return n;throw i=e,new Qh(Xh.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+i+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Jh?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<a.length;t++){const i=a[t],r=i.regex.exec(e);if(r){const e=r[i.indices.bucket];let t=r[i.indices.path];t||(t=""),n=new iu(e,t),i.postModify(n);break}}if(null==n)throw function(e){return new Qh(Xh.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class ru{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function su(e,t,n,i){if(i<t)throw tu(`Invalid value for '${e}'. Expected ${t} or greater.`);if(i>n)throw tu(`Invalid value for '${e}'. Expected ${n} or less.`)}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Zh||(Zh={}));class ou{constructor(e,t,n,i,r,s,o,a,c,l,h,u=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.retry=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,i=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(e){i(e)}else if(null!==r){const e=new Qh(Xh.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=r.getErrorText(),this.errorCallback_?i(this.errorCallback_(r,e)):i(e)}else t.canceled?i(this.appDelete_?nu():new Qh(Xh.CANCELED,"User canceled the upload/download.")):i(new Qh(Xh.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new au(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,r=null,s=null,o=!1,a=0;function c(){return 2===a}let l=!1;function h(...e){l||(l=!0,t.apply(null,e))}function u(t){r=setTimeout((()=>{r=null,e(p,c())}),t)}function d(){s&&clearTimeout(s)}function p(e,...t){if(l)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;i<64&&(i*=2),1===a?(a=2,n=0):n=1e3*(i+Math.random()),u(n)}let f=!1;function g(e){f||(f=!0,d(),l||(null!==r?(e||(a=2),clearTimeout(r),u(0)):e||(a=1)))}return u(0),s=setTimeout((()=>{o=!0,g(!0)}),n),g}(((e,t)=>{if(t)return void e(!1,new au(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===Zh.NO_ERROR,r=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,i=-1!==[408,429].indexOf(e),r=-1!==t.indexOf(e);return n||i||r}(r,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Zh.ABORT;return void e(!1,new au(!1,null,t))}const s=-1!==this.successCodes_.indexOf(r);e(!0,new au(s,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class au{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}class cu{constructor(e,t){this._service=e,this._location=t instanceof iu?t:iu.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new cu(e,t)}get root(){const e=new iu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new iu(this._location.bucket,e);return new cu(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Qh(Xh.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function lu(e,t){const n=null==t?void 0:t.storageBucket;return null==n?null:iu.makeFromBucketSpec(n,e)}class hu{constructor(e,t,n,i,r){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=r,this._bucket=null,this._host=Jh,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?iu.makeFromBucketSpec(i,this._host):lu(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=iu.makeFromBucketSpec(this._url,e):this._bucket=lu(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){su("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){su("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(ot(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new cu(this,e)}_makeRequest(e,t,n,i,r=!0){if(this._deleted)return new ru(nu());{const s=function(e,t,n,i,r,s,o=!0){const a=function(e){const t=encodeURIComponent;let n="?";for(const i in e)e.hasOwnProperty(i)&&(n=n+(t(i)+"=")+t(e[i])+"&");return n=n.slice(0,-1),n}(e.urlParams),c=e.url+a,l=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(l,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(l,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(l,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(l,i),new ou(c,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r,o)}(e,this._appId,n,i,t,this._firebaseVersion,r);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const uu="@firebase/storage",du="0.13.7",pu="storage";function fu(e,t,n,i={}){!function(e,t,n,i={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:r}=i;r&&(e._overrideAuthToken="string"==typeof r?r:v(r,e.app.options.projectId))}(e,t,n,i)}rt(new G(pu,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return new hu(n,i,r,t,lt)}),"PUBLIC").setMultipleInstances(!0)),dt(uu,du,""),dt(uu,du,"esm2017");const gu="https://meet.google.com",mu={apiKey:"AIzaSyAr5BXnNexqOGuVoXikWZS4hSUKFh8cmDA",authDomain:"interview-proctor.firebaseapp.com",databaseURL:"https://interview-proctor-default-rtdb.firebaseio.com",projectId:"interview-proctor",storageBucket:"interview-proctor.firebasestorage.app",messagingSenderId:"124879970402",appId:"1:124879970402:web:80ce4ae7b862d6be7db13b",measurementId:"G-1SCPSVG9F2"};document.addEventListener("DOMContentLoaded",(()=>{console.log("DOM Loaded. Initializing Addon with Role Selection and Timeline.");const e=document.getElementById("status"),t=document.getElementById("error-message"),i=document.getElementById("collect-data-button"),r=document.body,s=document.getElementById("role-selection"),o=document.getElementById("host-button"),a=document.getElementById("login-section"),c=document.getElementById("login-google"),l=document.getElementById("login-facebook"),h=(document.getElementById("login-microsoft"),document.getElementById("login-error-message")),u=document.getElementById("guest-button"),d=document.getElementById("guest-connection-status"),p=document.getElementById("extension-link"),f=document.getElementById("daemon-link"),m=document.getElementById("host-guest-name"),_=document.getElementById("host-overall-status-icon"),y=document.getElementById("host-last-update"),v=document.getElementById("host-processes-section"),w=document.getElementById("host-processes-status"),I=document.getElementById("host-processes-list"),b=document.getElementById("host-tabs-section"),C=document.getElementById("host-tabs-status"),T=document.getElementById("host-tabs-list"),E=document.getElementById("host-screenshot-section"),S=document.getElementById("host-screenshot-status"),k=document.getElementById("host-screenshot-details"),P=document.getElementById("host-timeline-section"),N=document.getElementById("host-timeline-list");let R=!1,A=!1,O=null,x=null,D=null,L=null,U=null,F=null;const j=ht(mu),q=(function(e=ut()){const t=st(e=K(e),rn);t.isInitialized()?t.getImmediate():function(e,t={}){const n=st(e,rn);if(n.isInitialized()){const e=n.getImmediate();if(M(t,n.getOptions()))return e;throw an.create("already-initialized")}n.initialize({options:t})}(e)}(j),Os(j)),$=function(e=ut(),t){const n=st(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=g("database");e&&qh(n,...e)}return n}(j),W=function(e=ut(),t=Hh){const n=st(K(e),Vh).getImmediate({identifier:t}),i=g("functions");return i&&Yh(n,...i),n}(j),V=function(e=ut(),t){const n=st(e=K(e),pu).getImmediate({identifier:t}),i=g("storage");return i&&fu(n,...i),n}(j),B=new fr,H=new pr;async function z(){null==O&&(O=await n.addon.createAddonSession({cloudProjectNumber:"331777483172"})),null==x&&(x=await O.createSidePanelClient(),D=await x.getMeetingInfo(),console.log("Meeting ID:",D.meetingId),console.log("Meeting Code:",D.meetingCode))}function G(t){e.textContent=`Status: ${t}`}function Y(e){e?(t.textContent=e,t.style.display="block"):(t.textContent="",t.style.display="none")}function J(e){const t=document.createElement("li");return t.textContent=e,t}function Q(){if(!R||!A)return;if(!L)return m.textContent="Guest: ---",_.textContent="⚪",_.className="status-icon unknown",y.textContent="Last Update: Waiting for guest...",w.textContent="---",w.className="status-text unknown",I.innerHTML="",C.textContent="---",C.className="status-text unknown",T.innerHTML="",S.textContent="---",S.className="status-text unknown",k.textContent="",N.innerHTML="<li><i>Waiting for guest data...</i></li>",v.style.display="none",b.style.display="none",E.style.display="none",void(P.style.display="none");m.textContent=`Guest: ${L.userName||"Unknown"}`,y.textContent=`Last Update: ${L.collectionTime?new Date(L.collectionTime).toLocaleString():"N/A"}`;let e="ok",t="🟢",n="ok";L.error?(e="alert",Y(`Guest Daemon Error: ${L.error}`)):L.status&&"ok"!==L.status&&"success"!==L.status?(e="warning",Y(null)):Y(null);const i=L.flaggedProcesses||[];I.innerHTML="",i.length>0?(w.textContent="FLAGGED",w.className="status-text warning",i.forEach((e=>{const t=`${e.processName} (PID: ${e.pid||"N/A"})${e.title?` - ${e.title}`:""}`;I.appendChild(J(t))})),v.style.display="block","ok"===e&&(e="warning")):(w.textContent="OK",w.className="status-text ok",I.innerHTML="<li><i>No flagged processes.</i></li>",v.style.display="block");const r=L.flaggedTabs||[];T.innerHTML="",r.length>0?(C.textContent="FLAGGED",C.className="status-text warning",r.forEach((e=>{const t=`${e.title||"Untitled Tab"} - ${e.url||"N/A"}`;T.appendChild(J(t))})),b.style.display="block","ok"===e&&(e="warning")):(C.textContent="OK",C.className="status-text ok",T.innerHTML="<li><i>No restricted tabs detected.</i></li>",b.style.display="block");const s=L.screenshot||[];k.textContent="",s.length>0?(S.textContent="CAPTURED",S.className="status-text ok",s.forEach((e=>{const t=`Display ${e.displayId||"N/A"}: ${e.imageSize||e.originalSize||"Size unknown"} (${e.format||"format unknown"})`,n=document.createElement("p");n.textContent=t,k.appendChild(n)})),E.style.display="block"):(S.textContent="N/A",S.className="status-text unknown",k.textContent="No screenshots received in this update.",E.style.display="block"),N.innerHTML="";const o=L.collectionTime?new Date(L.collectionTime).toLocaleTimeString():"No timestamp";let a=`Update received. Status: ${L.status||"N/A"}.`;if(L.error)a+=` Error: ${L.error}`;else{const e=[];i.length>0&&e.push(`${i.length} flagged process(es)`),r.length>0&&e.push(`${r.length} flagged tab(s)`),e.length>0?a+=` Issues: ${e.join(", ")}.`:a+=" No issues detected."}const c=document.createElement("li"),l=document.createElement("span"),h=document.createElement("span");l.className="timestamp",l.textContent=`[${o}]`,h.className="description",h.textContent=a,c.appendChild(l),c.appendChild(h),N.appendChild(c),P.style.display="block","alert"===e?(t="🔴",n="alert"):"warning"===e?(t="🟡",n="warning"):(t="🟢",n="ok"),_.textContent=t,_.className=`status-icon ${n}`}console.log("Connecting to Firebase Emulators..."),Qi(q,"http://localhost:9099"),qh($,"localhost",9e3),Yh(W,"localhost",5001),fu(V,"localhost",9199);let X=null;async function Z(e){if(A)console.warn("Role already selected; no need to run this again.");else{if(A=!0,R=e,console.log("Role selected: "+(R?"Host":"Guest")),Y(null),s.style.display="none",r.classList.add("role-selected"),R){r.classList.add("host-mode"),r.classList.remove("guest-mode");const e=q.currentUser;if(e&&D){const t=e.uid,n=e.displayName||"Unknown Host";U="ee1e9e3d-b56f-47d1-81e6-37c1e5a69703";const i=Wh();xh(Ah($,`users/${t}/sessions/${U}`),{startTime:i,meetingId:D.meetingId,meetingCode:D.meetingCode,role:"interviewer"}).catch((e=>console.error("Firebase: Error writing user session data:",e))),xh(Ah($,`sessions/${U}/interviewers/${t}`),{name:n,joinTime:i}).catch((e=>console.error("Firebase: Error writing interviewer data:",e))),console.log(`Firebase: Host data written for session ${U}`)}else console.warn("Firebase: User not logged in or meetingInfo not available, skipping host data write.");i&&(i.style.display="block")}else r.classList.add("guest-mode"),r.classList.remove("host-mode");D?console.log("meetingId: ",D.meetingId," meetingCode: ",D.meetingCode):console.log("meetingInfo is still null"),G("Initializing codoing session...");try{if(console.log("Make sure the sidePanelClient has initialized..."),x||(console.log("The addon session and side panel has not been initialed. doing now..."),await z()),console.log("The side panel has started/joined."),R)x.startActivity({sidePanelUrl:"https://binp.github.io/addon/src/SidePanel.html",additionalData:JSON.stringify({sessionID:U})}),G("Host mode active. Fetching initial data..."),Q(),function(){if(!R||!A||!U)return void console.warn("Host subscribe skipped: Conditions not met (isHost, roleSelected, sessionID).");console.log(`Host subscribing to candidate updates for session: ${U}`),G("Host mode subscribing to candidate updates...");const e=Ah($,`sessions/${U}/candidates`);X&&(X(),console.log("Firebase: Detached previous host candidates listener."),X=null),X=Mh(e,(e=>{console.log("Firebase: Received candidate updates:",e.val());const t=e.val();t?Object.keys(t).forEach((e=>{const n=t[e];if(n&&n.updates){const t=Object.keys(n.updates).sort();if(t.length>0){const i=t[t.length-1];L=n.updates[i],console.log(`Latest update for ${e}:`,L),Q()}}})):(L=null,Q())}),(e=>{console.error("Firebase: Error listening for candidate updates:",e),Y(`Error listening for candidate updates: ${e.message}`)}))}();else if(console.log("Guest sending 'addonOpened' message to target:",gu),window.top.postMessage({type:"addonOpened"},gu),d.textContent="Status: Waiting for connection from extension...",G("Guest mode active."),p.href="https://binp.github.io",f.href="https://binp.github.io",U="ee1e9e3d-b56f-47d1-81e6-37c1e5a69703",U){console.log(`Firebase: Setting up listener for session commands in session: ${U}`);const e=Ah($,`sessions/${U}/commands`);F=Mh(e,(e=>{if(e.exists()){const t=e.val().command;console.log(`Firebase: Received command: ${t}`),"collect"===t&&(console.log("Firebase: Sending 'collectData' message to the extension."),window.top.postMessage({type:"collectNow"},gu))}else console.log(`Firebase: No data at /sessions/${U}/commands`)}),(e=>{console.error("Firebase: Error listening for commands:",e),Y(`Error listening for commands: ${e.message}`)}))}else console.warn("Firebase: sessionID is not available. Cannot set up the listener for commands.");G(R?"Host mode listening. Fetching initial data...":"Guest mode waiting for command...")}catch(e){console.error("Error starting collaboration:",e),Y(`Collaboration failed: ${e.message||e}`),G("Collaboration Error"),A=!1,r.className=""}}}function ee(e){if("https://meet.google.com"!==e.origin)return;const t=e.data;if(console.log("Addon received message from parent window:",t),!R&&A&&"proctorUpdate"===t?.type){console.log("Guest received process update from extension:",t.payload),d.textContent=`Status: Connected (Last update: ${(new Date).toLocaleTimeString()})`,G(`Process info received (${t.payload?.length||0}). Sending to server...`);const e=t.payload.candidateInfo,n=q.currentUser;n&&D?(e.userId="99kknnViFDPkjMuW68JmSqPbLa99",e.userName=n.displayName||"Unknown Guest",e.sessionId=U,e.meetingId=D.meetingId,e.meetingCode=D.meetingCode):(console.warn("Guest: User not logged in or meetingInfo not available for enriching candidateInfo."),e.userId="guest_fallback_uid",e.userName="Unknown Guest",e.sessionId="ee1e9e3d-b56f-47d1-81e6-37c1e5a69703",e.meetingId=D?.meetingId||"unknown_meeting_id",e.meetingCode=D?.meetingCode||"unknown_meeting_code"),console.log("Send the payload to the backend server: ",e),fetch(`http://localhost:5001/${mu.projectId}/us-central1/process_guest_info`,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{e.success?(console.log("Successfully POSTed data to server:",e),G("Guest info sent."),d.textContent="Guest info sent. Waiting for next update..."):(console.error("Server returned error:",e.error),d.textContent=`Status: Error sending data! ${e.error}`,G("Server Error (POST)"))})).catch((e=>{console.error("Error POSTing data to server:",e),G("Network Error (POST)"),d.textContent="Error sending process info."}))}else R||!A||"daemonError"!==t?.type&&"daemonDisconnected"!==t?.type||(console.warn("Received daemon status from extension:",t.type,t.data),G("Extension Error"),d.textContent=`Extension reported an error: ${t.type}.`)}function te(e){e?(h.textContent=e,h.style.display="block"):(h.textContent="",h.style.display="none")}!function(e){K(e).onAuthStateChanged((async e=>{e?(console.log("User is signed in:",e),te(null),r.classList.add("logged-in"),a.style.display="none",s.style.display="flex",await z(),G("Please select your role above.")):(console.log("User is signed out"),r.classList.remove("logged-in"),r.classList.remove("role-selected","host-mode","guest-mode"),a.style.display="flex",s.style.display="none",G("Please log in to continue."))}),void 0,void 0)}(q),c.addEventListener("click",(()=>{ts(q,B).then((e=>{const t=e.user;console.log("Google sign-in successful:",t)})).catch((e=>{console.error("Google sign-in error:",e),te("Google login failed. "+e.message)}))})),l.addEventListener("click",(()=>{ts(q,H).then((e=>{const t=e.user;console.log("Facebook sign-in successful:",t)})).catch((e=>{console.error("Facebook sign-in error:",e),te("Facebook login failed. "+e.message)}))})),o.addEventListener("click",(()=>Z(!0))),u.addEventListener("click",(()=>Z(!1))),window.addEventListener("message",ee),z(),i&&i.addEventListener("click",(()=>async function(e){if(!q.currentUser||!U)return void console.warn("sendCommandToSession: User not logged in or session not initialized.");const t=Wh(),n=Ah($,`sessions/${U}/commands`);try{await xh(n,{command:e,time:t}),console.log(`sendCommandToSession: Sent '${e}' command to session ${U}`)}catch(e){console.error("sendCommandToSession: Error sending command:",e)}}("collect"))),window.addEventListener("unload",(()=>{if(window.removeEventListener("message",ee),F)try{F(),console.log("Firebase: Removed command listener for session."),F=null}catch(e){console.error("Firebase: Error removing command listener:",e)}if(X)try{X(),console.log("Firebase: Removed host candidates listener."),X=null}catch(e){console.error("Firebase: Error removing host candidates listener:",e)}j&&async function(e){let t=!1;const n=e.name;et.has(n)?(t=!0,et.delete(n)):tt.has(n)&&e.decRefCount()<=0&&(tt.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}(j).then((()=>{console.log("App deleted")}))}))})),helloWorld={}})();