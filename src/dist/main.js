/*! For license information please see main.js.LICENSE.txt */
var helloWorld;(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(){var e=Object.defineProperty,t=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(n,i){if(i)e:{var r=t;n=n.split(".");for(var s=0;s<n.length-1;s++){var o=n[s];if(!(o in r))break e;r=r[o]}(i=i(s=r[n=n[n.length-1]]))!=s&&null!=i&&e(r,n,{configurable:!0,writable:!0,value:i})}}("Symbol.dispose",(function(e){return e||Symbol("Symbol.dispose")}));var n,i,r=this||self;function s(e,t){function n(){}n.prototype=t.prototype,e.qa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.oa=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function o(e,t){if(Error.captureStackTrace)Error.captureStackTrace(this,o);else{const e=Error().stack;e&&(this.stack=e)}e&&(this.message=String(e)),void 0!==t&&(this.cause=t)}function a(e){r.setTimeout((()=>{throw e}),0)}s(o,Error),o.prototype.name="CustomError";e:{for(var c=["CLOSURE_FLAGS"],l=r,h=0;h<c.length;h++)if(null==(l=l[c[h]])){i=null;break e}i=l}var u,d=i&&i[610401301];n=null!=d&&d;const p=r.navigator;function f(e){return!!n&&!!u&&u.brands.some((({brand:t})=>t&&-1!=t.indexOf(e)))}function g(e){var t;return(t=r.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}function m(){return!!n&&!!u&&u.brands.length>0}function _(){return m()?f("Chromium"):(g("Chrome")||g("CriOS"))&&!(!m()&&g("Edge"))||g("Silk")}function y(e,t){(t=Array.prototype.indexOf.call(e,t,void 0))>=0&&Array.prototype.splice.call(e,t,1)}function v(e){let t="",n=0;const i=e.length-10240;for(;n<i;)t+=String.fromCharCode.apply(null,e.subarray(n,n+=10240));return t+=String.fromCharCode.apply(null,n?e.subarray(n):e),btoa(t)}u=p&&p.userAgentData||null,!g("Android")||_(),_(),g("Safari")&&(_()||!m()&&g("Coast")||!m()&&g("Opera")||!m()&&g("Edge")||(m()?f("Microsoft Edge"):g("Edg/"))||m()&&f("Opera"));const w=/[-_.]/g,I={"-":"+",_:"/",".":"="};function b(e){return I[e]||""}function T(e){return null!=e&&e instanceof Uint8Array}var C={};function E(){return k||(k=new S(null,C))}var S=class{constructor(e,t){if(N(t),this.g=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}};let k,P;function N(e){if(e!==C)throw Error("illegal external caller")}function R(e,t){e.__closure__error__context__984382||(e.__closure__error__context__984382={}),e.__closure__error__context__984382.severity=t}function A(){const e=Error();R(e,"incident"),a(e)}function O(e){return R(e=Error(e),"warning"),e}function D(){return"function"==typeof BigInt}function x(e){return Array.prototype.slice.call(e)}function L(e,t){return t&&Symbol.for&&e?Symbol.for(e):null!=e?Symbol(e):Symbol()}var M=L("jas",!0);L();var U=L(),F=L();function j(e,t){t[M]=-30975&e}function W(e,t){t[M]=-30941&e|34}L(),L();var $,H={},B={};function V(e){return!(!e||"object"!=typeof e||e.g!==B)}function q(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)&&e.constructor===Object}function z(e,t){if(null!=e)if("string"==typeof e)e=e?new S(e,C):E();else if(e.constructor!==S)if(T(e))e=e.length?new S(new Uint8Array(e),C):E();else{if(!t)throw Error();e=void 0}return e}function K(e){return!(!Array.isArray(e)||e.length||!(1&e[M]))}const G=[];function J(e){if(2&e)throw Error()}G[M]=55,$=Object.freeze(G);var Y=Object.freeze({});function Q(e){return e.pa=!0,e}var X=Q((e=>"number"==typeof e)),Z=Q((e=>"string"==typeof e)),ee=Q((e=>"boolean"==typeof e)),te="function"==typeof r.BigInt&&"bigint"==typeof r.BigInt(0),ne=Q((e=>te?e>=re&&e<=oe:"-"===e[0]?ae(e,ie):ae(e,se)));const ie=Number.MIN_SAFE_INTEGER.toString(),re=te?BigInt(Number.MIN_SAFE_INTEGER):void 0,se=Number.MAX_SAFE_INTEGER.toString(),oe=te?BigInt(Number.MAX_SAFE_INTEGER):void 0;function ae(e,t){if(e.length>t.length)return!1;if(e.length<t.length||e===t)return!0;for(let n=0;n<e.length;n++){const i=e[n],r=t[n];if(i>r)return!1;if(i<r)return!0}}let ce=0,le=0;function he(e){const t=e>>>0;ce=t,le=(e-t)/4294967296>>>0}function ue(e){if(e<0){he(-e);const[t,n]=fe(ce,le);ce=t>>>0,le=n>>>0}else he(e)}function de(e,t){if(e>>>=0,(t>>>=0)<=2097151)var n=""+(4294967296*t+e);else D()?n=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(e=(16777215&e)+6777216*(n=16777215&(e>>>24|t<<8))+6710656*(t=t>>16&65535),n+=8147497*t,t*=2,e>=1e7&&(n+=e/1e7>>>0,e%=1e7),n>=1e7&&(t+=n/1e7>>>0,n%=1e7),n=t+pe(n)+pe(e));return n}function pe(e){return e=String(e),"0000000".slice(e.length)+e}function fe(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function ge(e){return null==e||"boolean"==typeof e?e:"number"==typeof e?!!e:void 0}const me=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function _e(e){const t=typeof e;switch(t){case"bigint":return!0;case"number":return Number.isFinite(e)}return"string"===t&&me.test(e)}function ye(e){if(null!=e){if(!Number.isFinite(e))throw O("enum");e|=0}return e}function ve(e){if(null!=e){if("string"==typeof e){if(!e)return;e=+e}"number"==typeof e&&Number.isFinite(e)}}function we(e){if(null!=e)e:{if(!_e(e))throw O("int64");switch(typeof e){case"string":e=be(e);break e;case"bigint":var t=e=BigInt.asIntN(64,e);if(Z(t)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(t))throw Error(String(t))}else if(X(t)&&!Number.isSafeInteger(t))throw Error(String(t));e=te?BigInt(e):ee(e)?e?"1":"0":Z(e)?e.trim()||"0":String(e);break e;default:e=Ie(e)}}return e}function Ie(e){if(e=Math.trunc(e),!Number.isSafeInteger(e)){ue(e);var t=ce,n=le;(e=2147483648&n)&&(n=~n>>>0,0==(t=1+~t>>>0)&&(n=n+1>>>0));const i=4294967296*n+(t>>>0);e="number"==typeof(t=Number.isSafeInteger(i)?i:de(t,n))?e?-t:t:e?"-"+t:t}return e}function be(e){var t=Math.trunc(Number(e));if(Number.isSafeInteger(t))return String(t);if(-1!==(t=e.indexOf("."))&&(e=e.substring(0,t)),!("-"===e[0]?e.length<20||20===e.length&&Number(e.substring(0,7))>-922337:e.length<19||19===e.length&&Number(e.substring(0,6))<922337)){if(e.length<16)ue(Number(e));else if(D())e=BigInt(e),ce=Number(e&BigInt(4294967295))>>>0,le=Number(e>>BigInt(32)&BigInt(4294967295));else{t=+("-"===e[0]),le=ce=0;const n=e.length;for(let i=t,r=(n-t)%6+t;r<=n;i=r,r+=6){const t=Number(e.slice(i,r));le*=1e6,ce=1e6*ce+t,ce>=4294967296&&(le+=Math.trunc(ce/4294967296),le>>>=0,ce>>>=0)}if(t){const[e,t]=fe(ce,le);ce=e,le=t}}if(e=ce,2147483648&(t=le))if(D())e=""+(BigInt(0|t)<<BigInt(32)|BigInt(e>>>0));else{const[n,i]=fe(e,t);e="-"+de(n,i)}else e=de(e,t)}return e}function Te(e){if(null!=e&&"string"!=typeof e)throw Error();return e}function Ce(e,t,n){if(null!=e&&"object"==typeof e&&e.H===H)return e;if(Array.isArray(e)){var i=0|e[M],r=i;return 0===r&&(r|=32&n),(r|=2&n)!==i&&(e[M]=r),new t(e)}}let Ee,Se,ke,Pe,Ne,Re;function Ae(e){let t;return null==(t=Ee)?void 0:t.get(e)}function Oe(e){try{return-1!==e.toString().indexOf("[native code]")?e:null}catch{return null}}function De(e,t){return xe(t)}function xe(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return ne(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(K(e))return}else{if(T(e))return v(e);if(e instanceof S){const t=e.g;return null==t?"":"string"==typeof t?t:e.g=v(t)}}}return e}function Le(e,t,n,i,r){if(null!=e){if(Array.isArray(e))e=K(e)?void 0:r&&2&e[M]?e:Me(e,t,n,void 0!==i,r);else if(q(e)){const s={};for(let o in e)s[o]=Le(e[o],t,n,i,r);e=s}else e=t(e,i);return e}}function Me(e,t,n,i,r){const s=i||n?0|e[M]:0;i=i?!!(32&s):void 0,e=x(e);for(let s=0;s<e.length;s++)e[s]=Le(e[s],t,n,i,r);return n&&n(s,e),e}function Ue(e){return e.H===H?e.toJSON():xe(e)}function Fe(e,t,n=W){if(null!=e){if(e instanceof Uint8Array)return t?e:new Uint8Array(e);if(Array.isArray(e)){var i=0|e[M];return 2&i?e:(t&&(t=0===i||!!(32&i)&&!(64&i||!(16&i))),t?(e[M]=-12293&i|34,e):Me(e,Fe,4&i?W:n,!0,!0))}return e.H===H&&(e=2&(i=(n=e.m)[M])?e:new e.constructor(je(n,i,!0))),e}}function je(e,t,n){const i=n||2&t?W:j,r=!!(32&t);return e=function(e,t,n){var i=(e=x(e)).length;const r=256&t?e[i-1]:void 0;for(i+=r?-1:0,t=512&t?1:0;t<i;t++)e[t]=n(e[t]);if(r){t=e[t]={};for(const e in r)t[e]=n(r[e])}return e}(e,t,(e=>Fe(e,r,i))),e[M]=32|e[M]|(n?2:0),e}function We(e){const t=e.m,n=t[M];return 2&n?new e.constructor(je(t,n,!1)):e}function $e(e,t){return Be(e=e.m,e[M],t)}function He(e,t,n,i){if(!((t=i+(+!!(512&t)-1))<0||t>=e.length||t>=n))return e[t]}function Be(e,t,n,i){if(-1===n)return null;const r=t>>15&1023||536870912;if(!(n>=r)){var s,o=e.length;return i&&256&t&&null!=(i=e[o-1][n])?(He(e,t,r,n)&&null!=U&&(e=null!=(s=P)?s:P={},(s=e[U]||0)>=4||(e[U]=s+1,A())),i):He(e,t,r,n)}return 256&t?e[e.length-1][n]:void 0}function Ve(e,t,n){const i=e.m;let r=i[M];return J(r),qe(i,r,t,n),e}function qe(e,t,n,i){const r=t>>15&1023||536870912;if(n>=r){let s,o=t;if(256&t)s=e[e.length-1];else{if(null==i)return o;s=e[r+(+!!(512&t)-1)]={},o|=256}return s[n]=i,n<r&&(e[n+(+!!(512&t)-1)]=void 0),o!==t&&(e[M]=o),o}return e[n+(+!!(512&t)-1)]=i,256&t&&n in(e=e[e.length-1])&&delete e[n],t}function ze(e,t,n,i){return void 0!==Xe(e,t,n=Je(e,i)===n?n:-1)}function Ke(e){return!!(2&e)&&!!(4&e)||!!(2048&e)}function Ge(e,t,n,i){const r=e.m;let s=r[M];return J(s),qe(r,s,t,("0"===i?0===Number(n):n===i)?void 0:n),e}function Je(e,t){return Qe(Ye(e=e.m),e,e[M],t)}function Ye(e){let t;return null!=(t=e[F])?t:e[F]=new Map}function Qe(e,t,n,i){let r=e.get(i);if(null!=r)return r;r=0;for(let e=0;e<i.length;e++){const s=i[e];null!=Be(t,n,s)&&(0!==r&&(n=qe(t,n,r)),r=s)}return e.set(i,r),r}function Xe(e,t,n,i){let r=(e=e.m)[M];return(t=Ce(i=Be(e,r,n,i),t,r))!==i&&null!=t&&qe(e,r,n,t),t}function Ze(e,t,n){if(null==(t=Xe(e,t,n,!1)))return t;let i=(e=e.m)[M];if(!(2&i)){const r=We(t);r!==t&&qe(e,i,n,t=r)}return t}function et(e,t,n){return null==n&&(n=void 0),Ve(e,t,n)}function tt(e,t,n,i){null==i&&(i=void 0);e:{const o=e.m;var r=o[M];if(J(r),null==i){var s=Ye(o);if(Qe(s,o,r,n)!==t)break e;s.set(n,0)}else{const e=Ye(s=o),i=Qe(e,s,r,n);i!==t&&(i&&(r=qe(s,r,i)),e.set(n,t))}qe(o,r,t,i)}return e}function nt(e,t){const n=e.m;let i=n[M];if(J(i),null==t)return qe(n,i,1),e;var r,s=t;t=(null==(r=Se)?void 0:r.get(s))||s,r=s=0|t[M];const o=Ke(s),a=o||Object.isFrozen(t);let c=!0,l=!0;for(let e=0;e<t.length;e++){var h=t[e];o||(h=!!(2&h.m[M]),c&&(c=!h),l&&(l=h))}return o||(s=c?13:5,s=l?16|s:-17&s),a&&s===r||(t=x(t),r=0,s=rt(s=it(s,i),i,!0)),s!==r&&(t[M]=s),qe(n,i,1,t),e}function it(e,t){return-2049&(2&t?2|e:-3&e)|32}function rt(e,t,n){return 32&t&&n||(e&=-33),e}function st(e,t){return null!=e?e:t}function ot(e){return null!=(e=$e(e,1))&&("bigint"==typeof e?ne(e)?e=Number(e):(e=BigInt.asIntN(64,e),e=ne(e)?Number(e):String(e)):e=_e(e)?"number"==typeof e?Ie(e):be(e):void 0),st(e,0)}function at(e,t){return st(null==(e=$e(e,t))||"string"==typeof e?e:void 0,"")}function ct(e,t){return st(e=null==(e=$e(e,t))?e:Number.isFinite(e)?0|e:void 0,0)}function lt(e,t,n,i){return Ze(e,t,n=Je(e,i)===n?n:-1)}function ht(e){try{return Re=!0,JSON.stringify(dt(e),De)}finally{Re=!1}}var ut=class{constructor(e){e:{var t=null!=t?t:0;if(null==e){var n=96;e=[]}else{if(!Array.isArray(e))throw Error("narr");if(2048&(n=0|e[M]))throw Error("farr");if(64&n)break e;1===t||2===t||(n|=64);var i=(t=e).length;if(i&&q(t[--i])){if((t=i-(+!!(512&(n|=256))-1))>=1024)throw Error("pvtlmt");n=-33521665&n|(1023&t)<<15}}e[M]=n}this.m=e}toJSON(){return dt(this)}};function dt(e){e=e.m,e=Re?e:Me(e,Ue,void 0,void 0,!1);{var t=!Re;let l=e.length;if(l){var n=e[l-1],i=q(n);i?l--:n=void 0;var r=e;if(i){e:{var s,o=n,a=!1;if(o)for(let e in o)if(isNaN(+e)){let t;(null!=(t=s)?t:s={})[e]=o[e]}else if(i=o[e],Array.isArray(i)&&(K(i)||V(i)&&0===i.size)&&(i=null),null==i&&(a=!0),null!=i){let t;(null!=(t=s)?t:s={})[e]=i}if(a||(s=o),s)for(let e in s){a=s;break e}a=null}o=null==a?null!=n:a!==n}for(;l>0&&(null==(s=r[l-1])||K(s)||V(s)&&0===s.size);l--)var c=!0;(r!==e||o||c)&&(t?(c||o||a)&&(r.length=l):r=Array.prototype.slice.call(r,0,l),a&&r.push(a)),c=r}else c=e}return c}function pt(e){return t=>{if(null==t||""==t)t=new e;else{if(t=JSON.parse(t),!Array.isArray(t))throw Error("dnarr");t[M]|=32,t=new e(t)}return t}}ut.prototype.H=H,ut.prototype.toString=function(){try{return Re=!0,dt(this).toString()}finally{Re=!1}};var ft,gt=(ft=class extends ut{},e=>{if(e=JSON.parse(e),!Array.isArray(e)){var t=typeof e;throw Error("Expected jspb data to be an array, got "+("object"!=t?t:e?Array.isArray(e)?"array":t:"null")+": "+e)}return e[M]|=34,new ft(e)}),mt=class extends ut{};function _t(e){return yt(e,e.index)>=e.g&&(e.h[e.index]=Date.now(),e.index=(e.index+1)%1,!0)}function yt(e,t){let n;return Date.now()-(null!=(n=e.h[t])?n:-1*e.g)}var vt=class{constructor(e){this.g=e,this.h=[],this.index=0}},wt=class extends ut{},It=[2,3],bt=class extends ut{},Tt=class extends Error{constructor({errorType:e,message:t,i:n}){super(`Meet Add-on SDK error: ${t}${n?` - ${n}`:""}`),this.errorType=e}},Ct={errorType:"InternalError",message:"An unexpected error has occurred.",i:"No further information is available."},Et={errorType:"MissingUrlParameter",message:"Missing required Meet SDK URL parameter",i:"This parameter is automatically appended by Meet to the iframe URL. Ensure that your infrastructure does not strip URL parameters (e.g. as part of a redirect)."},St={errorType:"NeedsMainStageContext",message:"This method can only be invoked if the addon is running in the main stage.",i:"Use getFrameType to check whether the addon is running in the main stage before invoking this method."},kt={errorType:"NeedsSidePanelContext",message:"This method can only be invoked if the addon is running in the side panel.",i:"Use getFrameType to check whether the addon is running in the side panel before invoking this method."},Pt={errorType:"NotSupportedInStandalone",message:"This method is not supported in standalone mode.",i:"Do not call this method in standalone mode."},Nt={errorType:"InternalError",message:"The frame type URL parameter is set to an unexpected value.",i:"This parameter is automatically appended by Meet to the iframe URL. Ensure that your infrastructure does not modify URL parameters (e.g. as part of a redirect)."},Rt={errorType:"InvalidCloudProjectNumber",message:"Cloud Project Number provided by meet does not match the one passed in by the SDK. Ensure that the correct Cloud Project Number is passed to the SDK as a string.",i:"This parameter is automatically appended by Meet to the iframe URL. Ensure that your infrastructure does not modify URL parameters (e.g. as part of a redirect) and ensure that the correct Cloud Project Number was passed into the SDK as a string."},At={errorType:"DestinationNotReady",message:"The recipient frame is not connected via the addon SDK and cannot receive the notification.",i:"Make sure the destination frame has connected before sending messages to it."},Ot={errorType:"InvalidActivityStartingState",message:"Origin of the ActivityStartingState iframeURLs does not match the origin of the URLs provided in the Add-on manifest.",i:"Ensure that the ActivityStartingState iframeURL origins match the origins of the URLs provided in the Add-on manifest."},Dt={errorType:"ActivityStartingStateMissingAttributes",message:"The supplied ActivityStartingState object does not contain any recognized attributes.",i:"Ensure that the ActivityStartingState object contains at least one of the following attributes: mainStageUrl, sidePanelUrl, additionalData."},xt={errorType:"ActivityStartingStateUnrecognizedAttributes",message:"The supplied ActivityStartingState object contains attributes that are not recognized.",i:"Ensure that the ActivityStartingState object has only the following attributes: mainStageUrl, sidePanelUrl, additionalData."},Lt={errorType:"AddonStartingStateMissingAttributes",message:"The supplied AddonStartingState object does not contain any recognized attributes.",i:"Ensure that the AddonStartingState object contains at least one of the following attributes: sidePanelUrl, additionalData."},Mt={errorType:"AddonStartingStateUnrecognizedAttributes",message:"The supplied AddonStartingState object contains attributes that are not recognized.",i:"Ensure that the AddonStartingState object has only the following attributes: sidePanelUrl, additionalData."},Ut=e=>({errorType:"ArgumentNullError",message:`The argument supplied for '${e}' was 'null' but a value was expected.`,i:"Ensure you are passing a value of the expected type for the argument."}),Ft=(e,t,n)=>({errorType:"ArgumentTypeError",message:`The type '${t}' of argument supplied for '${e}' did not match the expected type '${n}'.`,i:"Ensure the type of the argument provided matches the expected type."}),jt={errorType:"ActivityIsOngoing",message:"Operation cannot be performed while an activity is ongoing.",i:"Ensure that no activity is ongoing."},Wt={errorType:"InternalError",message:"Frame message missing required Meet SDK command.",i:"Send one of the available commands in the frame message."},$t={errorType:"NoActivityFound",message:"No activity found.",i:"Ensure that the activity is started before performing this operation."},Ht={errorType:"RequiresEapEnrollment",message:"This feature is only available to early access partners.",i:"Meet add-on early access enrollment is currently closed."},Bt={errorType:"UserNotInitiator",message:"Operation cannot be performed because the user is not the initiator of the current activity.",i:"Ensure that the user is the initiator of the current activity or that the activity has ended."},Vt={errorType:"SizeLimitExceededActivityStartingState",message:"The size of the activityStartingState URLs and/or its data exceed the limits allowed.",i:"Ensure that the activityStartingState URL size is less than 512 characters and the additional data size is less than 4096 characters."},qt={errorType:"SizeLimitExceededFrameToFrameMessage",message:"The size of the frame to frame message exceeds the limits allowed.",i:"Ensure that the frame to frame message size is less than 1,000,000 characters."},zt={errorType:"AddonSessionAlreadyCreated",message:"The addon session has already been created.",i:"Only instantiate the AddonSession once."},Kt={errorType:"UserCancelled",message:"The user cancelled starting an activity.",i:"The user needs to click continue to start the activity."},Gt={errorType:"NotSupportedInMeetCall",message:"This method is not supported during a Meet call.",i:"Do not call this method during a Meet call."},Jt={errorType:"InvalidAddonStartingState",message:"Origin of the AddonStartingState iframeURLs does not match the origin of the URLs provided in the Add-on manifest.",i:"Ensure that the AddonStartingState iframeURL origins match the origins of the URLs provided in the Add-on manifest."},Yt={errorType:"SizeLimitExceededAddonStartingState",message:"The size of the AddonStartingState URLs and/or its data exceed the limits allowed.",i:"Ensure that the AddonStartingState URL size is less than 512 characters and the additional data size is less than 4096 characters."},Qt={errorType:"MeetingPolicyPreventsStartingActivity",message:"A meeting policy (such as using host control settings) prevents the user from starting the activity.",i:"Have a meeting host or administrator modify the necessary settings to allow the current user to start the activity."};function Xt({errorType:e,message:t,i:n},i=""){throw new Tt({errorType:e,message:i?`${t} ${i}`:t,i:n})}function Zt(e,t){Xt({...Et,message:`${Et.message}: ${e}. In URL ${t}`})}function en(e){return Ge(new rn,1,ye(e),0)}function tn(e,t){return Ge(e,2,Te(t),"")}function nn(e,t){return Ge(e,3,Te(t),"")}var rn=class extends ut{getFrameType(){return ct(this,1)}};function sn(e){var t;t=void 0===Y?2:4;var n=e.m[M],i=n,r=!(2&n),s=rn;t=(n=!!(2&i))?1:t,r&&(r=!n),n=Be(e=e.m,i,1);var o=0|(n=Array.isArray(n)?n:$)[M],a=!!(4&o);if(!a){var c=o;0===c&&(c=it(c,i)),o=n;var l=i;const e=!!(2&(c|=1));e&&(l|=2);let t=!e,r=!0,a=0,h=0;for(;a<o.length;a++){const n=Ce(o[a],s,l);if(n instanceof s){if(!e){const e=!!(2&n.m[M]);t&&(t=!e),r&&(r=e)}o[h++]=n}}h<a&&(o.length=h),c|=4,c=r?16|c:-17&c,c=t?8|c:-9&c,o[M]=c,e&&Object.freeze(o),o=c}if(r&&!(8&o||!n.length&&(1===t||4===t&&32&o))){for(Ke(o)&&(n=x(n),o=it(o,i),i=qe(e,i,1,n)),r=n,s=o,o=0;o<r.length;o++)(c=r[o])!==(l=We(c))&&(r[o]=l);s|=8,s=r.length?-17&s:16|s,o=r[M]=s}let h;if(1===t||4===t&&32&o){if(!Ke(o)){i=o;var u=!!(32&o);(o|=!n.length||16&o&&(!a||u)?2:2048)!==i&&(n[M]=o),Object.freeze(n)}}else a=5===t&&(!!(32&o)||Ke(o)||!!Ae(n)),(2===t||a)&&Ke(o)&&(n=x(n),o=rt(o=it(o,i),i,!1),n[M]=o,i=qe(e,i,1,n)),Ke(o)||(e=o,(o=rt(o,i,!1))!==e&&(n[M]=o)),a?h=function(e){var t;return void 0===ke&&(ke="function"==typeof Proxy?Oe(Proxy):null),(t=!ke)||(void 0===Pe&&(Pe="function"==typeof WeakMap?Oe(WeakMap):null),t=!Pe),t?e:(t=Ae(e))?t:Math.random()>.01?e:(function(e){if(void 0===Ne){const e=new ke([],{});Ne=1===Array.prototype.concat.call([],e).length}Ne&&"function"==typeof Symbol&&Symbol.isConcatSpreadable&&(e[Symbol.isConcatSpreadable]=!0)}(e),function(e,t){(Ee||(Ee=new Pe)).set(e,t),(Se||(Se=new Pe)).set(t,e)}(e,t=new ke(e,{set:(e,t,n)=>(A(),e[t]=n,!0)})),t)}(n):2===t&&(null==(u=Ee)||u.delete(n));return h||n}function on(e){return nt(new an,e)}var an=class extends ut{},cn=class extends ut{};function ln(e){return Ge(new hn,1,ye(e),0)}var hn=class extends ut{},un=class extends ut{},dn=class extends ut{},pn=class extends ut{},fn=class extends ut{getMeetingInfo(){return lt(this,pn,3,gn)}getMeetPlatformInfo(){return lt(this,dn,4,gn)}},gn=[2,3,4,5],mn=class extends ut{},_n=[1,4,5,6,7,8,9,10,11,12,13,14,15,16,17],yn=class extends ut{},vn=class extends ut{},wn=new Map([[2,"MAIN_STAGE"],[1,"SIDE_PANEL"]]),In=new Map([[0,"UNKNOWN"],[1,"OPEN_ADDON"],[2,"START_ACTIVITY"],[3,"JOIN_ACTIVITY"]]);function bn(e){e&&"function"==typeof e.dispose&&e.dispose()}function Tn(){this.s=this.s,this.g=this.g}function Cn(e,t){e.s?t():(e.g||(e.g=[]),e.g.push(t))}function En({J:e,R:t}){if(null===e)throw new Tt(Ut("activityStartingState"));if(t||void 0!==e){if("object"!=typeof e)throw new Tt(Ft("activityStartingState",typeof e,"object"+(t?"":" | undefined")));if(void 0!==e.mainStageUrl&&"string"!=typeof e.mainStageUrl)throw new Tt(Ft("mainStageUrl",typeof e.mainStageUrl,"string | undefined"));if(void 0!==e.sidePanelUrl&&"string"!=typeof e.sidePanelUrl)throw new Tt(Ft("sidePanelUrl",typeof e.sidePanelUrl,"string | undefined"));if(void 0!==e.additionalData&&"string"!=typeof e.additionalData)throw new Tt(Ft("additionalData",typeof e.additionalData,"string | undefined"));if(Object.keys(e).length!==+!!e.mainStageUrl+ +!!e.sidePanelUrl+ +!!e.additionalData)throw new Tt(xt);if(0===Object.keys(e).length)throw new Tt(Dt)}}function Sn(e){const t=[];return t.push(nn(tn(en(2),e.mainStageUrl),e.additionalData)),t.push(nn(tn(en(1),e.sidePanelUrl),e.additionalData)),t}Tn.prototype.s=!1,Tn.prototype.dispose=function(){this.s||(this.s=!0,this.G())},Tn.prototype[Symbol.dispose]=function(){this.dispose()},Tn.prototype.G=function(){if(this.g)for(;this.g.length;)this.g.shift()()};var kn=class extends Tn{constructor(e){super(),this.context=e,this.h={},Ai(this.context.g.U,(e=>{if(7===Je(e.content,_n)){const n=this.h.frameToFrameMessage;if(e=lt(e.content,un,7,_n),n&&e){var t=ct(e,1);if(void 0===(t=wn.get(t)))throw Error("Unknown frame type.");n({originator:t,payload:at(e,2)})}}}))}async getMeetingInfo(){const e=await Ji(this.context.g,ln(2));return{meetingId:at(e.getMeetingInfo(),1),meetingCode:at(e.getMeetingInfo(),2)}}async getFrameOpenReason(){let e;const t=null!=(e=this.context.h.ca)?e:0;let n;return null!=(n=In.get(t))?n:"UNKNOWN"}async getActivityStartingState(){var e=lt(await Ji(this.context.g,ln(1)),an,2,gn);const t=null==e?void 0:sn(e).find((e=>2===e.getFrameType()));return e=null==e?void 0:sn(e).find((e=>1===e.getFrameType())),{mainStageUrl:(null==t?void 0:at(t,2))||void 0,sidePanelUrl:(null==e?void 0:at(e,2))||void 0,additionalData:(null==e?void 0:at(e,3))||void 0}}async setActivityStartingState(e){En({J:e,R:!0});var t=Sn(e);e=Yi;var n=this.context.g,i=new yn;i=et(i,1,t=on(t)),await e(n,i)}on(e,t){this.h[e]=t}async getMeetPlatformInfo(){return{isMeetHardware:st(ge($e((await Ji(this.context.g,ln(3))).getMeetPlatformInfo(),1)),!1)}}async closeAddon(){await async function(e){var t=Xi,n=new $n,i=new Rn;n=tt(n,11,Hn,i),await t(e,Fi(n))}(this.context.g)}async startActivity(e){En({J:e,R:!1});const t=new vn;e&&et(t,1,e=on(e=Sn(e))),await async function(e,t){var n=Xi;t=tt(new $n,14,Hn,t),await n(e,Fi(t))}(this.context.g,t)}async endActivity(e){var t=Qi,n=this.context.g;e=Ge(new cn,1,ye("aab61ee0-51b4-475d-aa4d-849f2498640d"===e?999:0),0),await t(n,e)}},Pn=pt(class extends ut{getFrameOpenReason(){return ct(this,5)}});function Nn(){var e=window.location.href,t=window.location.href,n=new URL(t).searchParams.get("meet_sdk");if(n?t=Pn(atob(n)):(Zt("meet_sdk",t),t=void 0),(n=at(t,1))||Zt("meet_addon_frame_type",e),2!==(n=Number(n))&&1!==n)throw new Tt(Nt);const i=at(t,2);i||Zt("meet_control_channel_name",e);const r=at(t,4);var s;return r||Zt("addon_cloud_project_number",e),{ca:e=null!=(s=t.getFrameOpenReason())?s:0,frameType:n,ba:i,cloudProjectNumber:r,S:s=at(t,3)||"https://meet.google.com"}}var Rn=class extends ut{},An=class extends ut{},On=class extends ut{},Dn=[1,2],xn=class extends ut{},Ln=class extends ut{},Mn=class extends ut{},Un=class extends ut{},Fn=class extends ut{},jn=class extends ut{setAddonStartingState(e){return et(this,1,e)}},Wn=class extends ut{},$n=class extends ut{},Hn=[1,2,5,6,7,8,9,10,11,13,14,15,16],Bn=class extends ut{},Vn=pt(Bn),qn=[1,2];class zn{constructor(e,t){this.data=e,this.channel=t}}var Kn=Promise;function Gn(e){const t=new MessageChannel;return Qn(t.port1,e),t}function Jn(e,t){return Qn(e,t),new Yn(e)}class Yn{constructor(e){this.g=e}send(e,t,n=[]){t=Gn(t),this.g.postMessage(e,[t.port2].concat(n))}C(e,t){return new Kn((n=>{this.send(e,n,t)}))}}function Qn(e,t){t&&(e.onmessage=e=>{var n=e.data;e=Jn(e.ports[0]),t(new zn(n,e))})}var Xn="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function Zn(e,t){e.l(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}class ei{constructor(e,t){this.j=e,this.l=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.j(),e}}function ti(){var e=oi;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var ni=new ei((()=>new ii),(e=>e.reset()));class ii{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let ri,si=!1,oi=new class{constructor(){this.h=this.g=null}add(e,t){const n=ni.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},ai=(e,t)=>{ri||ci(),si||(ri(),si=!0),oi.add(e,t)},ci=()=>{const e=Promise.resolve(void 0);ri=()=>{e.then(li)}};function li(){let e;for(;e=ti();){try{e.h.call(e.g)}catch(e){a(e)}Zn(ni,e)}si=!1}function hi(){}function ui(e){if(this.g=0,this.T=void 0,this.l=this.h=this.j=null,this.v=this.B=!1,e!=hi)try{const t=this;e.call(void 0,(function(e){yi(t,2,e)}),(function(e){yi(t,3,e)}))}catch(e){yi(this,3,e)}}function di(){this.next=this.context=this.h=this.l=this.g=null,this.j=!1}di.prototype.reset=function(){this.context=this.h=this.l=this.g=null,this.j=!1};var pi=new ei((function(){return new di}),(function(e){e.reset()}));function fi(e,t,n){const i=pi.get();return i.l=e,i.h=t,i.context=n,i}function gi(e,t){(t=fi(t=Xn(t),t)).j=!0,_i(e,t)}function mi(e,t){if(0==e.g)if(e.j){var n=e.j;if(n.h){var i=0,r=null,s=null;for(let t=n.h;t&&(t.j||(i++,t.g==e&&(r=t),!(r&&i>1)));t=t.next)r||(s=t);r&&(0==n.g&&1==i?mi(n,t):(s?((i=s).next==n.l&&(n.l=i),i.next=i.next.next):wi(n),Ii(n,r,3,t)))}e.j=null}else yi(e,3,t)}function _i(e,t){e.h||2!=e.g&&3!=e.g||vi(e),e.l?e.l.next=t:e.h=t,e.l=t}function yi(e,t,n){if(0==e.g){e===n&&(t=3,n=new TypeError("Promise cannot resolve to itself")),e.g=1;e:{var i=n,r=e.ma,s=e.na;if(i instanceof ui){_i(i,fi(r||hi,s||null,e));var o=!0}else{if(i)try{var a=!!i.$goog_Thenable}catch(e){a=!1}else a=!1;if(a)i.then(r,s,e),o=!0;else{if("object"==(a=typeof i)&&null!=i||"function"==a)try{const t=i.then;if("function"==typeof t){!function(e,t,n,i,r){function s(e){o||(o=!0,i.call(r,e))}let o=!1;try{t.call(e,(function(e){o||(o=!0,n.call(r,e))}),s)}catch(e){s(e)}}(i,t,r,s,e),o=!0;break e}}catch(t){s.call(e,t),o=!0;break e}o=!1}}}o||(e.T=n,e.g=t,e.j=null,vi(e),3!=t||n instanceof Ci||function(e,t){e.v=!0,ai((function(){e.v&&Ti.call(null,t)}))}(e,n))}}function vi(e){e.B||(e.B=!0,ai(e.la,e))}function wi(e){let t=null;return e.h&&(t=e.h,e.h=t.next,t.next=null),e.h||(e.l=null),t}function Ii(e,t,n,i){if(3==n&&t.h&&!t.j)for(;e&&e.v;e=e.j)e.v=!1;if(t.g)t.g.j=null,bi(t,n,i);else try{t.j?t.l.call(t.context):bi(t,n,i)}catch(e){Ti.call(null,e)}Zn(pi,t)}function bi(e,t,n){2==t?e.l.call(e.context,n):e.h&&e.h.call(e.context,n)}ui.prototype.then=function(e,t,n){return function(e,t,n,i){const r=fi(null,null,null);return r.g=new ui((function(e,s){r.l=t?function(n){try{const r=t.call(i,n);e(r)}catch(e){s(e)}}:e,r.h=n?function(t){try{const r=n.call(i,t);void 0===r&&t instanceof Ci?s(t):e(r)}catch(e){s(e)}}:s})),r.g.j=e,_i(e,r),r.g}(this,Xn("function"==typeof e?e:null),Xn("function"==typeof t?t:null),n)},ui.prototype.$goog_Thenable=!0,ui.prototype.cancel=function(e){if(0==this.g){const t=new Ci(e);ai((function(){mi(this,t)}),this)}},ui.prototype.ma=function(e){this.g=0,yi(this,2,e)},ui.prototype.na=function(e){this.g=0,yi(this,3,e)},ui.prototype.la=function(){let e;for(;e=wi(this);)Ii(this,e,this.g,this.T);this.B=!1};var Ti=a;function Ci(e){o.call(this,e)}function Ei(e,t,n){this.promise=e,this.resolve=t,this.reject=n}s(Ci,o),Ci.prototype.name="cancel";let Si=1,ki=new WeakMap;function Pi(e,t,n){var i=Ri;e.h.has(t),i(t,n)}var Ni=class extends Tn{constructor(){super(),this.h=new Set}signal(){const e=new Oi;return this.h.add(e),Cn(this,function(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}(bn,e)),e}};function Ri(e,t){return new Promise((n=>{Li((()=>{e.L&&(e.ea=t,e.P=!0);for(const{I:n,slot:i}of e.o.values())try{i(t,{signal:e,I:n})}catch(e){a(e)}for(const n of e.A)n.resolve(t);e.A.clear(),n()}))}))}function Ai(e,t,n){const i=Si++;return Li((()=>{!function(e,t,n,i){if(!e.s)if(i){if(!i.s){const r=()=>{Li((()=>{e.o.delete(t);const n=ki.get(i);n&&y(n,r)}))};e.o.set(t,{I:t,slot:n,F:r}),Ui(i,r)}}else e.o.set(t,{I:t,slot:n,F:()=>e.o.delete(t)})}(e,i,t,n)})),i}var Oi=class extends Tn{constructor(){super(),this.L=!1,this.o=new Map,this.A=new Set,this.P=!1}detach(e){Li((()=>{const t=this.o.get(e);t&&t.F()}))}value(e){return this.promise(!0,e)}next(e){return this.promise(!1,e)}promise(e,t){const n=function(){let e,t;return new Ei(new ui((function(n,i){e=n,t=i})),e,t)}();return Li((()=>{if(this.s)n.reject(new Ci("Signal initially disposed"));else if(t&&t.s)n.reject(new Ci("Owner initially disposed"));else if(e&&this.L&&this.P)n.resolve(this.ea);else if(this.A.add(n),gi(n.promise,(()=>{this.A.delete(n)})),t){const e=()=>{n.reject(new Ci("Owner asynchronously disposed"))};gi(n.promise,(()=>{const n=ki.get(t);n&&y(n,e)})),Ui(t,e)}})),n.promise}G(){super.G(),Li((()=>{for(const{F:e}of this.o.values())e();this.o.clear();for(const e of this.A)e.reject(new Ci("Signal asynchronously disposed"));this.A.clear()}))}};const Di=[];let xi=!1;function Li(e){Di.push(e),async function(){if(!xi)try{xi=!0;let e=Mi(0);for(;e<Di.length;)await Promise.resolve(),e=Mi(e)}catch(e){a(e)}finally{Di.length=0,xi=!1}}()}function Mi(e){const t=e+100;for(;e<t&&e<Di.length;)try{Di[e++]()}catch(e){a(e)}return e}function Ui(e,t){if(e.s)t();else{var n=ki.get(e);if(n)n.push(t);else{const n=[t];ki.set(e,n),Cn(e,(()=>{for(const e of[...n])e();ki.delete(e)}))}}}function Fi(e){return{content:ht(e=tt(new Bn,1,qn,e))}}const ji=new Ni;function Wi(e,t){const n=ji.signal();return{channel:Jn(e,(e=>{const i=t(e.data);Pi(ji,n,{content:i,ka:e})})),signal:n}}let $i;var Hi=class extends ut{},Bi=class extends ut{},Vi=class extends ut{h(){return lt(this,Hi,2,qi)}g(){return ze(this,Hi,2,qi)}j(){return lt(this,Bi,3,qi)}l(){return ze(this,Bi,3,qi)}},qi=[2,3],zi=pt(class extends ut{}),Ki=pt(class extends ut{}),Gi=[1,2];async function Ji(e,t){var n=Xi;let i;return t=tt(new $n,9,Hn,t),e=await n(e,Fi(t)),null==(i=lt(Vn(e.data.content),mn,2,qn))?void 0:lt(i,fn,9,_n)}async function Yi(e,t){var n=Xi;t=tt(new $n,8,Hn,t),await n(e,Fi(t))}async function Qi(e,t){var n=Xi;t=tt(new $n,15,Hn,t),await n(e,Fi(t))}async function Xi(e,t){let n;(e=await e.channel.C(t))||Xt(Ct,`Falsy response received from the message channel. ${JSON.stringify(e)}`),(t=e.data)||Xt(Ct,`Data field in the response from the message channel is falsy. ${JSON.stringify(t)}`),(t=t.content)||Xt(Ct,`Content field in the response from the message channel is falsy. ${JSON.stringify(t)}`);try{n=Vn(t)}catch(e){Xt(Ct,`The ControlMessage can't be deserialized. ${JSON.stringify(t)}. ${JSON.stringify(e)}`)}if((t=lt(n,mn,2,qn))||Xt(Ct,`MeetToAddonMessage field on ControlMessage is falsy. ${JSON.stringify(t)}`),void 0!==(null==(t=null==t?void 0:lt(t,bt,10,_n))?void 0:ct(t,1)))throw new Tt(function(e){switch(e){case 0:default:return Ct;case 1:return At;case 2:return Ot;case 3:return jt;case 4:return Wt;case 5:return Ht;case 6:return Pt;case 7:return Bt;case 8:return Vt;case 9:return qt;case 10:return Kt;case 11:return Gt;case 12:return Jt;case 13:return Yt;case 14:return $t;case 15:return Qt}}(ct(t,1)));return e}async function Zi(e){const t=function(){var e=new On,t=new An;return tt(e,1,Dn,t)}(),{channel:n,response:i}=await async function(e,t){var n,i=Xi;return t=tt(new $n,1,Hn,t),e=(i=await i(e,Fi(t))).data.messagePort,n=null!=(i=null==(n=lt(Vn(i.data.content),mn,2,qn))?void 0:lt(n,wt,1,_n))?i:Ge(n=new wt,1,ye(0),0),{channel:e?Wi(e,(e=>Ki(e))):void 0,response:n}}(e,t);if(!n)throw new Tt(function(e){let t;var n=null!=(t=ct(e,1))?t:0;switch(e=function(e){switch(e){case 2:return"co";case 3:return"gd";default:return"unknown"}}(Je(e,It)),n){case 1:return{errorType:"InternalError",message:`Could not connect to ${e} channel. Meet did not respond with a MessagePort.`,i:"No further information is available."};case 2:return{errorType:"InternalError",message:`Could not connect to ${e}. A conflicting ${e} exists.`,i:"No further information is available."};case 3:return{errorType:"InternalError",message:`Could not connect to ${e} channel. The addon does not have permission to open a ${e}.`,i:"This method might require EAP enrollment."};case 4:return{errorType:"InternalError",message:`Could not connect to ${e} channel. The addon is not authorized for this ${e}.`,i:"No further information is available."};case 0:default:return(e=>({errorType:"InternalError",message:`Could not connect to ${e} channel. Unknown error`,i:"No further information is available."}))(e);case 5:return"co"===e?{errorType:"InternalError",message:`Could not connect to ${e} channel. The coActivity was not found.`,i:`Consider starting the ${e} only after after the startActivity promise returns.`}:{errorType:"InternalError",message:`Could not connect to ${e} channel.`,i:"No further information is available."}}}(i));return n}async function er(e,t,n){var i=Xi,r=new $n;t=Ge(new Mn,1,ye(t),0),n=Ge(t,2,Te(n),""),r=tt(r,7,Hn,n),await i(e,Fi(r))}class tr extends Tn{constructor(e,t,n){super(),this.U=e,this.channel=t,this.h=function(e){var t=new vt(100),n=Promise.resolve();return(...i)=>_t(t)?e(...i):n}((async()=>{var e=this.channel,t=e.C,n=new $n,i=new Un;n=tt(n,13,Hn,i),await t.call(e,Fi(n))})),e=function(){var e=$i||($i=gt("[1,2,0]"));const t=(e=Ve(e=We(e),4,Te("dev-706864954"))).m,n=t[M];return 2&n?e:new e.constructor(je(t,n,!0))}(),at(e,4),ve($e(e,1)),ve($e(e,2)),ve($e(e,3)),n=function(e,t){return tt(e,2,Hn,t)}(new $n,function(e,t){return Ge(e,3,Te(t),"")}(function(e){return et(new xn,2,e)}(e),n)),this.channel.send(Fi(n)),Ai(this.U,(async e=>{16===Je(e.content,_n)&&await async function(e){await e.h()}(this)}))}}let nr;var ir=class{constructor(e){var t=nr;this.h=e,this.g=t}delete(){throw Error("Not implemented.")}},rr=class extends ut{h(){return lt(this,Hi,2,sr)}g(){return ze(this,Hi,2,sr)}j(){return lt(this,Bi,3,sr)}l(){return ze(this,Bi,3,sr)}},sr=[2,3],or=class extends ut{},ar=class extends ut{},cr=class extends ut{},lr=class extends ut{h(){return lt(this,Hi,2,hr)}g(){return ze(this,Hi,2,hr)}j(){return lt(this,Bi,3,hr)}l(){return ze(this,Bi,3,hr)}},hr=[2,3],ur=[5,6],dr=class extends ut{},pr=class extends ut{},fr=[1,2,3],gr=class extends Error{constructor(){super("Failed to create CoActivity: Connection refused - Meet refused to begin Live Sharing")}},mr=class{constructor(e){this.config=e}start(){return null!=this.g||(this.g=setInterval((()=>{this.config.ha()}),this.config.da)),this}shutdown(){clearInterval(this.g)}};function _r(){const e=new Map,t={set:(n,i)=>(e.set(n,i),t),D:()=>e};return t}function yr(e){if(e.g()){var t=(e=e.h().m)[M],n=Be(e,t,1),i=z(n,!0);if(null!=i&&i!==n&&qe(e,t,1,i),t=null==(e=i)?E():e,e=Uint8Array,N(C),null!=(n=t.g)&&!T(n))if("string"==typeof n){w.test(n)&&(n=n.replace(w,b)),n=atob(n),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);n=i}else n=null;return{bytes:new e((t=null==n?n:t.g=n)||0)}}}function vr(e,t){return t=Ir(t),tt(e,2,hr,t),e}function wr(e,t){return t=Ir(t),tt(e,2,sr,t),e}function Ir(e){return Ge(new Hi,1,z(e.bytes,!1),E())}function br(e){if(e.l()){var t,n,i=at(e=e.j(),1),r=null!=(n=null==(t=Ze(e,mt,2))?void 0:ot(t))?n:0;let s=(n=e.m)[M];const o=Be(n,s,4);return null!=(t=null==o||"number"==typeof o?o:"NaN"===o||"Infinity"===o||"-Infinity"===o?Number(o):void 0)&&t!==o&&qe(n,s,4,t),{mediaId:i,mediaPlayoutPosition:r,mediaPlayoutRate:st(t,0),playbackState:Er.get(ct(e,3))}}}function Tr(e,t){return t=kr(t),tt(e,3,hr,t),e}function Cr(e,t){return t=kr(t),tt(e,3,sr,t),e}const Er=_r().set(0,"INVALID").set(1,"BUFFERING").set(2,"PLAY").set(3,"PAUSE").set(4,"ENDED").D(),Sr=_r().set("INVALID",0).set("BUFFERING",1).set("PLAY",2).set("PAUSE",3).set("ENDED",4).D();function kr(e){var t=new Bi;t=Ge(t,1,Te(e.mediaId),"");var n=e.mediaPlayoutRate;if(null!=n&&"number"!=typeof n)throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);return t=Ge(t,4,n,0),n=Ge(n=new mt,1,we(e.mediaPlayoutPosition),"0"),Ge(t=et(t,2,n),3,ye(e=Sr.get(e.playbackState)),0)}function Pr(e,t){return t=Ge(new ar,1,ye(t.u),0),tt(e,6,ur,t),e}function Nr(e){var t=new or;return tt(e,5,ur,t),e}const Rr=_r().set("co-doing",1).set("co-watching",2).D();async function Ar(e,t,n){var i=t.C,r=new pr,s=new dr;let o;if(s=Ge(s,1,Te(e.activityTitle),""),s=Ge(s,2,ye(Rr.get(e.K)),0),r=tt(r,3,fr,s),null!=(o=st(ge($e(i=await i.call(t,r,zi),1)),!1))&&o)return new xr(e,t,n,Ze(i,Vi,2));throw new gr}function Or(e,t){const n=e.config.N(t);n&&!e.config.M(e.g,n)&&(e.g=n,e.j=ot(t),e.v(e.g))}function Dr(e,t){const{state:n,fa:i,context:r}=t(e.g);e.g=n,e.notify(e.g,r,i)}class xr{constructor(e,t,n,i){this.l=e,this.h=t,this.config=n,this.v=function(e){var t=new vt(500);let n,i=0;return(...r)=>{_t(t)?e(...r):(n=()=>{e(...r)},i||(i=setTimeout((()=>{let e;i=0,null==(e=n)||e()}),function(e){const t=e.g;return(e=yt(e,e.index))>=t?0:t-e}(t))))}}((e=>{this.l.O(e)})),function(e,t){const n=Ai(e.signal,(e=>{t(e)}));e.o.push(n)}(this.h,(e=>{const t=Je(e,Gi);switch(t){case 1:Or(this,lt(e,Vi,1,Gi));break;case 2:case 0:console.warn(`IllegalMessage: ${t} - Unhandled message - Please raise a bug with the MeetJS team`)}})),this.B=new mr({da:1e3,ha:()=>{var e,t,n=null==(t=(e=this.l).ja)?void 0:t.call(e);if(null!==this.g){this.g={...this.g,...n},e=new pr,n=(t=this.config).W;var i=new rr;i=Ge(i,1,we(this.j),"0"),t=n.call(t,i,this.g),e=tt(e,1,fr,t),this.h.send(e)}}}).start(),this.g=null,this.j=0,i&&Or(this,i)}disconnect(){this.h.shutdown(),this.B.shutdown()}notify(e,t,n){var i=n?function({activityTitle:e}){return Ve(new cr,4,Te(e))}(n):void 0,r=(n=this.config).X,s=new lr;i=et(s=Ge(s,1,we(this.j),"0"),4,i),e=r.call(n,i,e),e=this.config.V(e,t),n=(t=this.h).send,e=tt(r=new pr,2,fr,e),n.call(t,e)}}var Lr=class{constructor(e){this.g=e}broadcastStateUpdate(e){Dr(this.g,(()=>({state:e,context:{}})))}disconnect(){this.g.disconnect()}};function Mr(e,t){return null!=e&&null!=t&&e.bytes.length===t.bytes.length&&e.bytes.every(((e,n)=>e===t.bytes[n]))}var Ur=class{constructor(e){this.g=e}notifySwitchedToMedia(e,t,n){Dr(this.g,(()=>({state:{mediaId:t,mediaPlayoutRate:1,mediaPlayoutPosition:n,playbackState:"PLAY"},fa:{activityTitle:e},context:{u:1}})))}notifyPauseState(e,t){Dr(this.g,(n=>{if(null==n)throw Error("Invalid before coWatchingState");return{state:{...n,playbackState:e?"PAUSE":"PLAY",mediaPlayoutPosition:t},context:{u:3}}}))}notifySeekToTimestamp(e){Dr(this.g,(t=>{if(null==t)throw Error("Invalid before coWatchingState");return{state:{...t,mediaPlayoutPosition:e},context:{u:2}}}))}notifyPlayoutRate(e){Dr(this.g,(t=>{if(null==t)throw Error("Invalid before coWatchingState");return{state:{...t,mediaPlayoutRate:e},context:{u:4}}}))}notifyBuffering(e){Dr(this.g,(t=>{if(null==t)throw Error("Invalid before coWatchingState");return{state:{...t,mediaPlayoutPosition:e,playbackState:"BUFFERING"},context:{u:3}}}))}notifyReady(e){Dr(this.g,(t=>{if(null==t)throw Error("Invalid before coWatchingState");return{state:{...t,mediaPlayoutPosition:e},context:{u:3}}}))}disconnect(){this.g.disconnect()}};function Fr(e,t){if(null==e||null==t)return!1;const n="PLAY"===e.playbackState?3*Math.max(e.mediaPlayoutRate,1):0,i=Math.abs(e.mediaPlayoutPosition-t.mediaPlayoutPosition);return e.mediaId===t.mediaId&&e.mediaPlayoutRate===t.mediaPlayoutRate&&i<=n&&e.playbackState===t.playbackState}var jr=class{constructor(e,t){this.channel=e,this.signal=t,this.o=[]}send(e){this.channel.send(ht(e))}async C(e,t){return t((e=await this.channel.C(ht(e))).data)}shutdown(){this.o.forEach((e=>{this.signal.detach(e)}))}};async function Wr(e){const t=new Ni,n=t.signal();!function(e,t,n,i=e=>e){Ai(n,(n=>{Pi(e,t,i(n))}),e)}(t,n,(e=await e).signal,(e=>e.content));const{ia:i,ga:r}=function(e,t){var n=$r;const i=e.signal(),r=e.signal();return Ai(t,(t=>{const s=n(t)?i:r;Pi(e,s,t)}),e),{ia:i,ga:r}}(t,n);return{Z:new jr(e.channel,i),aa:new jr(e.channel,r)}}function $r(e){if(1!==Je(e,Gi))throw Error("CA Message arrived with no known content message set");return(e=lt(e,Vi,1,Gi)).g()}var Hr=class extends kn{async notifySidePanel(e){await er(this.context.g,1,e)}async unloadSidePanel(){await async function(e){var t=Xi,n=new $n,i=new Wn;n=tt(n,5,Hn,i),await t(e,Fi(n))}(this.context.g)}async loadSidePanel(){await async function(e){var t=Xi,n=new $n,i=new Ln;n=tt(n,6,Hn,i),await t(e,Fi(n))}(this.context.g)}},Br=class extends kn{async setAddonStartingState(e){if(null===e)throw new Tt(Ut("addonStartingState"));if("object"!=typeof e)throw new Tt(Ft("addonStartingState",typeof e,"object | undefined"));if(void 0!==e.sidePanelUrl&&"string"!=typeof e.sidePanelUrl)throw new Tt(Ft("sidePanelUrl",typeof e.sidePanelUrl,"string | undefined"));if(void 0!==e.additionalData&&"string"!=typeof e.additionalData)throw new Tt(Ft("additionalData",typeof e.additionalData,"string | undefined"));if(Object.keys(e).length!==+!!e.sidePanelUrl+ +!!e.additionalData)throw new Tt(Mt);if(0===Object.keys(e).length)throw new Tt(Lt);var t=[];t.push(nn(tn(en(1),e.sidePanelUrl),e.additionalData)),e=this.context.g;var n=new jn,i=n.setAddonStartingState;t=nt(new Fn,t),await async function(e,t){var n=Xi;t=tt(new $n,16,Hn,t),await n(e,Fi(t))}(e,i.call(n,t))}},Vr=class extends kn{async notifyMainStage(e){await er(this.context.g,2,e)}},qr=class{constructor(e){e=e.cloudProjectNumber;const t=Nn();if(t.cloudProjectNumber!==e)throw new Tt(Rt);const n=t.S,i=t.ba;let r;nr=null!=(r=nr)?r:function(e,t,n){const i=new Ni,r=i.signal();return e=(({destination:e,origin:t,ra:n,Y:i="ZNWN1d",onMessage:r})=>{if("*"===t)throw Error("Sending to wildcard origin not allowed.");const s=Gn(r);return e.postMessage(n?{n:i,t:n}:i,t,[s.port2]),Jn(s.port1,r)})({destination:window.parent,origin:t,Y:e,onMessage:e=>{const t=Vn(e.data.content);2===Je(t,qn)&&Pi(i,r,{content:lt(t,mn,2,qn),ka:e,messagePort:e.data.messagePort})}}),new tr(r,e,n)}(i,n,e),this.g=new ir(t)}async createMainStageClient(){var e=this.g;if(2!==e.h.frameType)throw new Tt(St);return await Promise.resolve(new Hr(e))}async createSidePanelClient(){var e=this.g;if(1!==e.h.frameType)throw new Tt(kt);return await Promise.resolve(new Vr(e))}async createCoWatchingClient(e){return await async function(e,t){if(({aa:e}=await Wr(Zi(e.g))),t=await async function(e,t){if(t)return e=await Ar({activityTitle:t.activityTitle,K:"co-watching",ja:()=>t.onCoWatchingStateQuery(),O:e=>{t.onCoWatchingStateChanged(e)}},e,{X:Tr,W:Cr,V:Pr,N:br,M:Fr}),new Ur(e)}(e,t),!t)throw Error("Failed to create co-watching session");return t}(this.g,e)}async createCoDoingClient(e){return await async function(e,t){if(({Z:e}=await Wr(Zi(e.g))),t=await async function(e,t){if(t)return e=await Ar({activityTitle:t.activityTitle,K:"co-doing",O:e=>{t.onCoDoingStateChanged(e)}},e,{X:vr,W:wr,V:Nr,N:yr,M:Mr}),new Lr(e)}(e,t),!t)throw Error("Failed to create co-doing session");return t}(this.g,e)}async createRoomsStandaloneClient(){var e=this.g;if(2!==e.h.frameType)throw new Tt(St);return await Promise.resolve(new Br(e))}};let zr=null;var Kr,Gr={addon:{getFrameType:function(){e:{var e=Nn().frameType;switch(e){case 2:e="MAIN_STAGE";break e;case 1:e="SIDE_PANEL";break e;default:throw Error(`Unknown frame type: ${e}`)}}return e},createAddonSession:async function(e){if(null===e)throw new Tt(Ut("config"));if("object"!=typeof e)throw new Tt(Ft("config",typeof e,"object"));if("string"!=typeof e.cloudProjectNumber)throw new Tt(Ft("cloudProjectNumber",typeof e.cloudProjectNumber,"string"));if(zr&&"integration.test.google.com"!==Nn().S)throw new Tt(zt);return zr=new qr(e)}}},Jr=["meet"],Yr=r;Jr[0]in Yr||void 0===Yr.execScript||Yr.execScript("var "+Jr[0]);for(;Jr.length&&(Kr=Jr.shift());)Jr.length||void 0===Gr?Yr=Yr[Kr]&&Yr[Kr]!==Object.prototype[Kr]?Yr[Kr]:Yr[Kr]={}:Yr[Kr]=Gr}).apply(t);const n=t.meet,i=function(e,t){if(!e)throw r(t)},r=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},s=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=r>>2,h=(3&r)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(u=64)),i.push(n[l],n[h],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==c)throw new a;const l=r<<2|s>>4;if(i.push(l),64!==o){const e=s<<4&240|o>>2;if(i.push(e),64!==c){const e=o<<6&192|c;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class a extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const c=function(e){const t=s(e);return o.encodeByteArray(t,!0)},l=function(e){return c(e).replace(/\./g,"")},h=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e){return d(void 0,e)}function d(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=d(e[n],t[n]));return e}const p=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&h(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},f=e=>{var t,n;return null===(n=null===(t=p())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},g=()=>{var e;return null===(e=p())||void 0===e?void 0:e.config},m=e=>{var t;return null===(t=p())||void 0===t?void 0:t[`_${e}`]};class _{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function y(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function v(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(y())}function w(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function I(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function b(){try{return"object"==typeof indexedDB}catch(e){return!1}}function T(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class C extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,C.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,E.prototype.create)}}class E{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(S,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new C(i,o,n)}}const S=/\{\$([^}]+)}/g;function k(e){return JSON.parse(e)}function P(e){return JSON.stringify(e)}const N=function(e){let t={},n={},i={},r="";try{const s=e.split(".");t=k(h(s[0])||""),n=k(h(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}};function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function O(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function D(e,t,n){const i={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function x(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(L(n)&&L(s)){if(!x(n,s))return!1}else if(n!==s)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function L(e){return null!==e&&"object"==typeof e}function M(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function U(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function F(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class j{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,r,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=c^o&(a^c),r=1518500249):(i=o^a^c,r=1859775393):e<60?(i=o&a|c&(o|a),r=2400959708):(i=o^a^c,r=3395469782);const t=(s<<5|s>>>27)+i+l+r+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const r=this.buf_;let s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class W{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=$),void 0===i.error&&(i.error=$),void 0===i.complete&&(i.complete=$);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function $(){}function H(e,t){return`${e} failed: ${t} argument `}const B=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function V(e,t=1e3,n=2){const i=t*Math.pow(n,e),r=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+r)}function q(e){return e&&e._delegate?e._delegate:e}class z{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const K="[DEFAULT]";class G{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new _;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:K})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=K){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=K){return this.instances.has(e)}getOptions(e=K){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===K?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=K){return this.component?this.component.multipleInstances?e:K:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class J{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new G(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Y=[];var Q;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Q||(Q={}));const X={debug:Q.DEBUG,verbose:Q.VERBOSE,info:Q.INFO,warn:Q.WARN,error:Q.ERROR,silent:Q.SILENT},Z=Q.INFO,ee={[Q.DEBUG]:"log",[Q.VERBOSE]:"log",[Q.INFO]:"info",[Q.WARN]:"warn",[Q.ERROR]:"error"},te=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=ee[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class ne{constructor(e){this.name=e,this._logLevel=Z,this._logHandler=te,this._userLogHandler=null,Y.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?X[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Q.DEBUG,...e),this._logHandler(this,Q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Q.VERBOSE,...e),this._logHandler(this,Q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Q.INFO,...e),this._logHandler(this,Q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Q.WARN,...e),this._logHandler(this,Q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Q.ERROR,...e),this._logHandler(this,Q.ERROR,...e)}}let ie,re;const se=new WeakMap,oe=new WeakMap,ae=new WeakMap,ce=new WeakMap,le=new WeakMap;let he={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return oe.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ae.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return de(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ue(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(re||(re=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(pe(this),e),de(se.get(this))}:function(...e){return de(t.apply(pe(this),e))}:function(e,...n){const i=t.call(pe(this),e,...n);return ae.set(i,e.sort?e.sort():[e]),de(i)}:(e instanceof IDBTransaction&&function(e){if(oe.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));oe.set(e,t)}(e),n=e,(ie||(ie=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,he):e);var t,n}function de(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(de(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&se.set(t,e)})).catch((()=>{})),le.set(t,e),t}(e);if(ce.has(e))return ce.get(e);const t=ue(e);return t!==e&&(ce.set(e,t),le.set(t,e)),t}const pe=e=>le.get(e);function fe(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=de(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(de(o.result),e.oldVersion,e.newVersion,de(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}const ge=["get","getKey","getAll","getAllKeys","count"],me=["put","add","delete","clear"],_e=new Map;function ye(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(_e.get(t))return _e.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=me.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!ge.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return _e.set(t,s),s}var ve;ve=he,he={...ve,get:(e,t,n)=>ye(e,t)||ve.get(e,t,n),has:(e,t)=>!!ye(e,t)||ve.has(e,t)};class we{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Ie="@firebase/app",be="0.11.5",Te=new ne("@firebase/app"),Ce="@firebase/app-compat",Ee="@firebase/analytics-compat",Se="@firebase/analytics",ke="@firebase/app-check-compat",Pe="@firebase/app-check",Ne="@firebase/auth",Re="@firebase/auth-compat",Ae="@firebase/database",Oe="@firebase/data-connect",De="@firebase/database-compat",xe="@firebase/functions",Le="@firebase/functions-compat",Me="@firebase/installations",Ue="@firebase/installations-compat",Fe="@firebase/messaging",je="@firebase/messaging-compat",We="@firebase/performance",$e="@firebase/performance-compat",He="@firebase/remote-config",Be="@firebase/remote-config-compat",Ve="@firebase/storage",qe="@firebase/storage-compat",ze="@firebase/firestore",Ke="@firebase/vertexai",Ge="@firebase/firestore-compat",Je="firebase",Ye="[DEFAULT]",Qe={[Ie]:"fire-core",[Ce]:"fire-core-compat",[Se]:"fire-analytics",[Ee]:"fire-analytics-compat",[Pe]:"fire-app-check",[ke]:"fire-app-check-compat",[Ne]:"fire-auth",[Re]:"fire-auth-compat",[Ae]:"fire-rtdb",[Oe]:"fire-data-connect",[De]:"fire-rtdb-compat",[xe]:"fire-fn",[Le]:"fire-fn-compat",[Me]:"fire-iid",[Ue]:"fire-iid-compat",[Fe]:"fire-fcm",[je]:"fire-fcm-compat",[We]:"fire-perf",[$e]:"fire-perf-compat",[He]:"fire-rc",[Be]:"fire-rc-compat",[Ve]:"fire-gcs",[qe]:"fire-gcs-compat",[ze]:"fire-fst",[Ge]:"fire-fst-compat",[Ke]:"fire-vertex","fire-js":"fire-js",[Je]:"fire-js-all"},Xe=new Map,Ze=new Map,et=new Map;function tt(e,t){try{e.container.addComponent(t)}catch(n){Te.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function nt(e){const t=e.name;if(et.has(t))return Te.debug(`There were multiple attempts to register component ${t}.`),!1;et.set(t,e);for(const t of Xe.values())tt(t,e);for(const t of Ze.values())tt(t,e);return!0}function it(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function rt(e){return null!=e&&void 0!==e.settings}const st=new E("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ot{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new z("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw st.create("app-deleted",{appName:this._name})}}const at="11.6.1";function ct(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:Ye,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw st.create("bad-app-name",{appName:String(r)});if(n||(n=g()),!n)throw st.create("no-options");const s=Xe.get(r);if(s){if(x(n,s.options)&&x(i,s.config))return s;throw st.create("duplicate-app",{appName:r})}const o=new J(r);for(const e of et.values())o.addComponent(e);const a=new ot(n,i,o);return Xe.set(r,a),a}function lt(e=Ye){const t=Xe.get(e);if(!t&&e===Ye&&g())return ct();if(!t)throw st.create("no-app",{appName:e});return t}function ht(e,t,n){var i;let r=null!==(i=Qe[e])&&void 0!==i?i:e;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Te.warn(e.join(" "))}nt(new z(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}const ut="firebase-heartbeat-store";let dt=null;function pt(){return dt||(dt=fe("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ut)}catch(e){console.warn(e)}}}).catch((e=>{throw st.create("idb-open",{originalErrorMessage:e.message})}))),dt}async function ft(e,t){try{const n=(await pt()).transaction(ut,"readwrite"),i=n.objectStore(ut);await i.put(t,gt(e)),await n.done}catch(e){if(e instanceof C)Te.warn(e.message);else{const t=st.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Te.warn(t.message)}}}function gt(e){return`${e.name}!${e.options.appId}`}class mt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new yt(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=_t();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some((e=>e.date===i)))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Te.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=_t(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),vt(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),vt(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=l(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Te.warn(e),""}}}function _t(){return(new Date).toISOString().substring(0,10)}class yt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!b()&&T().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await pt()).transaction(ut),n=await t.objectStore(ut).get(gt(e));return await t.done,n}catch(e){if(e instanceof C)Te.warn(e.message);else{const t=st.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Te.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ft(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ft(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function vt(e){return l(JSON.stringify({version:2,heartbeats:e})).length}nt(new z("platform-logger",(e=>new we(e)),"PRIVATE")),nt(new z("heartbeat",(e=>new mt(e)),"PRIVATE")),ht(Ie,be,""),ht(Ie,be,"esm2017"),ht("fire-js",""),ht("firebase","11.6.1","app");const wt="@firebase/installations",It="0.6.13",bt=`w:${It}`,Tt="FIS_v2",Ct=new E("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Et(e){return e instanceof C&&e.code.includes("request-failed")}function St({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function kt(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Pt(e,t){const n=(await t.json()).error;return Ct.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Nt({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Rt(e){const t=await e();return t.status>=500&&t.status<600?e():t}function At(e){return new Promise((t=>{setTimeout(t,e)}))}const Ot=/^[cdef][\w-]{21}$/;function Dt(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return Ot.test(t)?t:""}catch(e){return""}}function xt(e){return`${e.appName}!${e.appId}`}const Lt=new Map;function Mt(e,t){const n=xt(e);Ut(n,t),function(e,t){const n=(!Ft&&"BroadcastChannel"in self&&(Ft=new BroadcastChannel("[Firebase] FID Change"),Ft.onmessage=e=>{Ut(e.data.key,e.data.fid)}),Ft);n&&n.postMessage({key:e,fid:t}),0===Lt.size&&Ft&&(Ft.close(),Ft=null)}(n,t)}function Ut(e,t){const n=Lt.get(e);if(n)for(const e of n)e(t)}let Ft=null;const jt="firebase-installations-store";let Wt=null;function $t(){return Wt||(Wt=fe("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(jt)}})),Wt}async function Ht(e,t){const n=xt(e),i=(await $t()).transaction(jt,"readwrite"),r=i.objectStore(jt),s=await r.get(n);return await r.put(t,n),await i.done,s&&s.fid===t.fid||Mt(e,t.fid),t}async function Bt(e){const t=xt(e),n=(await $t()).transaction(jt,"readwrite");await n.objectStore(jt).delete(t),await n.done}async function Vt(e,t){const n=xt(e),i=(await $t()).transaction(jt,"readwrite"),r=i.objectStore(jt),s=await r.get(n),o=t(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||Mt(e,o.fid),o}async function qt(e){let t;const n=await Vt(e.appConfig,(n=>{const i=function(e){return Gt(e||{fid:Dt(),registrationStatus:0})}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Ct.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=St(e),r=Nt(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={fid:n,authVersion:Tt,appId:e.appId,sdkVersion:bt},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Rt((()=>fetch(i,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:kt(e.authToken)}}throw await Pt("Create Installation",c)}(e,t);return Ht(e.appConfig,n)}catch(n){throw Et(n)&&409===n.customData.serverCode?await Bt(e.appConfig):await Ht(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:zt(e)}:{installationEntry:t}}(e,i);return t=r.registrationPromise,r.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function zt(e){let t=await Kt(e.appConfig);for(;1===t.registrationStatus;)await At(100),t=await Kt(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await qt(e);return n||t}return t}function Kt(e){return Vt(e,(e=>{if(!e)throw Ct.create("installation-not-found");return Gt(e)}))}function Gt(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Jt({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${St(e)}/${t}/authTokens:generate`}(e,n),r=function(e,{refreshToken:t}){const n=Nt(e);return n.append("Authorization",function(e){return`${Tt} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={installation:{sdkVersion:bt,appId:e.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Rt((()=>fetch(i,a)));if(c.ok)return kt(await c.json());throw await Pt("Generate Auth Token",c)}async function Yt(e,t=!1){let n;const i=await Vt(e.appConfig,(i=>{if(!Xt(i))throw Ct.create("not-registered");const r=i.authToken;if(!t&&(2===(s=r).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return i;var s;if(1===r.requestStatus)return n=async function(e,t){let n=await Qt(e.appConfig);for(;1===n.authToken.requestStatus;)await At(100),n=await Qt(e.appConfig);const i=n.authToken;return 0===i.requestStatus?Yt(e,t):i}(e,t),i;{if(!navigator.onLine)throw Ct.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await Jt(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await Ht(e.appConfig,i),n}catch(n){if(!Et(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Ht(e.appConfig,n)}else await Bt(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function Qt(e){return Vt(e,(e=>{if(!Xt(e))throw Ct.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function Xt(e){return void 0!==e&&2===e.registrationStatus}function Zt(e){return Ct.create("missing-app-config-values",{valueName:e})}const en="installations";nt(new z(en,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Zt("App Configuration");if(!e.name)throw Zt("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Zt(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:it(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),nt(new z("installations-internal",(e=>{const t=it(e.getProvider("app").getImmediate(),en).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await qt(t);return i?i.catch(console.error):Yt(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await qt(e);t&&await t}(n),(await Yt(n,t)).token}(t,e)}}),"PRIVATE")),ht(wt,It),ht(wt,It,"esm2017");const tn="analytics",nn="https://www.googletagmanager.com/gtag/js",rn=new ne("@firebase/analytics"),sn=new E("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function on(e){if(!e.startsWith(nn)){const t=sn.create("invalid-gtag-resource",{gtagURL:e});return rn.warn(t.message),""}return e}function an(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const cn=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function ln(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function hn(e,t=cn,n){const{appId:i,apiKey:r,measurementId:s}=e.options;if(!i)throw sn.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw sn.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new dn;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),un({appId:i,apiKey:r,measurementId:s},o,a,t)}async function un(e,{throttleEndTimeMillis:t,backoffCount:n},i,r=cn){var s;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,i)=>{const r=Math.max(t-Date.now(),0),s=setTimeout(n,r);e.addEventListener((()=>{clearTimeout(s),i(sn.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(e){if(a)return rn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,r={method:"GET",headers:ln(i)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw sn.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return r.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof C&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(r.deleteThrottleMetadata(o),a)return rn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const l=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?V(n,r.intervalMillis,30):V(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return r.setThrottleMetadata(o,h),rn.debug(`Calling attemptFetch again in ${l} millis`),un(e,h,i,r)}}class dn{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let pn,fn;async function gn(e,t,n,i,r,s,o){var a;const c=hn(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&rn.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>rn.error(e))),t.push(c);const l=async function(){if(!b())return rn.warn(sn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await T()}catch(e){return rn.warn(sn.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[h,u]=await Promise.all([c,l]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(nn)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:on}),i=document.createElement("script"),r=`${nn}?l=${e}&id=${t}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}(s,h.measurementId),fn&&(r("consent","default",fn),fn=void 0),r("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=u&&(d.firebase_id=u),r("config",h.measurementId,d),pn&&(r("set",pn),pn=void 0),h.measurementId}class mn{constructor(e){this.app=e}_delete(){return delete _n[this.app.options.appId],Promise.resolve()}}let _n={},yn=[];const vn={};let wn,In,bn="dataLayer",Tn=!1;function Cn(e,t,n){!function(){const e=[];if(w()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=sn.create("invalid-analytics-context",{errorInfo:t});rn.warn(n.message)}}();const i=e.options.appId;if(!i)throw sn.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw sn.create("no-api-key");rn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=_n[i])throw sn.create("already-exists",{id:i});if(!Tn){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(bn);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,r){let s=function(...e){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(e,t,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(e,t,n,i,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const i=await an(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),r=e&&t[e.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",i,r||{})}catch(e){rn.error(e)}}(e,t,n,i,r)}else if("config"===r){const[r,o]=s;await async function(e,t,n,i,r,s){const o=i[r];try{if(o)await t[o];else{const e=(await an(n)).find((e=>e.measurementId===r));e&&await t[e.appId]}}catch(e){rn.error(e)}e("config",r,s)}(e,t,n,i,r,o)}else if("consent"===r){const[t,n]=s;e("consent",t,n)}else if("get"===r){const[t,n,i]=s;e("get",t,n,i)}else if("set"===r){const[t]=s;e("set",t)}else e(r,...s)}catch(e){rn.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[r]}}(_n,yn,vn,bn,"gtag");In=e,wn=t,Tn=!0}return _n[i]=gn(e,yn,vn,t,wn,bn,n),new mn(e)}const En="@firebase/analytics",Sn="0.10.12";function kn(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}nt(new z(tn,((e,{options:t})=>Cn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),nt(new z("analytics-internal",(function(e){try{const t=e.getProvider(tn).getImmediate();return{logEvent:(e,n,i)=>function(e,t,n,i){e=q(e),async function(e,t,n,i,r){if(r&&r.global)e("event",n,i);else{const r=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(In,_n[e.app.options.appId],t,n,i).catch((e=>rn.error(e)))}(t,e,n,i)}}catch(e){throw sn.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),ht(En,Sn),ht(En,Sn,"esm2017"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Pn=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Nn=new E("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Rn=new ne("@firebase/auth");function An(e,...t){Rn.logLevel<=Q.ERROR&&Rn.error(`Auth (${at}): ${e}`,...t)}function On(e,...t){throw Mn(e,...t)}function Dn(e,...t){return Mn(e,...t)}function xn(e,t,n){const i=Object.assign(Object.assign({},Pn()),{[t]:n});return new E("auth","Firebase",i).create(t,{appName:e.name})}function Ln(e){return xn(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Mn(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return Nn.create(e,...t)}function Un(e,t,...n){if(!e)throw Mn(t,...n)}function Fn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw An(t),new Error(t)}function jn(e,t){e||Fn(t)}function Wn(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function $n(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Hn{constructor(e,t){this.shortDelay=e,this.longDelay=t,jn(t>e,"Short delay should be less than long delay!"),this.isMobile=v()||I()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===$n()||"https:"===$n()||w()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Bn(e,t){jn(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Vn{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Fn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Fn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Fn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const qn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},zn=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Kn=new Hn(3e4,6e4);function Gn(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Jn(e,t,n,i,r={}){return Yn(e,r,(async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});const o=M(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},r);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),Vn.fetch()(await Xn(e,e.config.apiHost,n,o),c)}))}async function Yn(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},qn),t);try{const t=new ei(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw ti(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ti(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw ti(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw ti(e,"user-disabled",s);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw xn(e,a,o);On(e,a)}}catch(t){if(t instanceof C)throw t;On(e,"network-request-failed",{message:String(t)})}}async function Qn(e,t,n,i,r={}){const s=await Jn(e,t,n,i,r);return"mfaPendingCredential"in s&&On(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function Xn(e,t,n,i){const r=`${t}${n}?${i}`,s=e,o=s.config.emulator?Bn(e.config,r):`${e.config.apiScheme}://${r}`;return zn.includes(n)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(o).toString():o}function Zn(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ei{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Dn(this.auth,"network-request-failed"))),Kn.get())}))}}function ti(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=Dn(e,t,i);return r.customData._tokenResponse=n,r}function ni(e){return void 0!==e&&void 0!==e.enterprise}class ii{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Zn(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ri(e,t){return Jn(e,"GET","/v2/recaptchaConfig",Gn(e,t))}async function si(e,t){return Jn(e,"POST","/v1/accounts:lookup",t)}function oi(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function ai(e){return 1e3*Number(e)}function ci(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return An("JWT malformed, contained fewer than 3 sections"),null;try{const e=h(n);return e?JSON.parse(e):(An("Failed to decode base64 JWT payload"),null)}catch(e){return An("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function li(e){const t=ci(e);return Un(t,"internal-error"),Un(void 0!==t.exp,"internal-error"),Un(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function hi(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof C&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ui{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class di{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=oi(this.lastLoginAt),this.creationTime=oi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function pi(e){var t;const n=e.auth,i=await e.getIdToken(),r=await hi(e,si(n,{idToken:i}));Un(null==r?void 0:r.users.length,n,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?fi(s.providerUserInfo):[],a=(c=e.providerData,l=o,[...c.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var c,l;const h=e.isAnonymous,u=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!h&&u,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new di(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,p)}function fi(e){return e.map((e=>{var{providerId:t}=e,n=kn(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class gi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Un(e.idToken,"internal-error"),Un(void 0!==e.idToken,"internal-error"),Un(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):li(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Un(0!==e.length,"internal-error");const t=li(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Un(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(e,t){const n=await Yn(e,{},(async()=>{const n=M({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=await Xn(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Vn.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new gi;return n&&(Un("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(Un("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(Un("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new gi,this.toJSON())}_performRefresh(){return Fn("not implemented")}}function mi(e,t){Un("string"==typeof e||void 0===e,"internal-error",{appName:t})}class _i{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=kn(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ui(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new di(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await hi(this,this.stsTokenManager.getToken(this.auth,e));return Un(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=q(e),i=await n.getIdToken(t),r=ci(i);Un(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:oi(ai(r.auth_time)),issuedAtTime:oi(ai(r.iat)),expirationTime:oi(ai(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=q(e);await pi(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Un(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new _i(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Un(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await pi(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(rt(this.auth.app))return Promise.reject(Ln(this.auth));const e=await this.getIdToken();return await hi(this,async function(e,t){return Jn(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,c,l;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,_=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:y,emailVerified:v,isAnonymous:w,providerData:I,stsTokenManager:b}=t;Un(y&&b,e,"internal-error");const T=gi.fromJSON(this.name,b);Un("string"==typeof y,e,"internal-error"),mi(h,e.name),mi(u,e.name),Un("boolean"==typeof v,e,"internal-error"),Un("boolean"==typeof w,e,"internal-error"),mi(d,e.name),mi(p,e.name),mi(f,e.name),mi(g,e.name),mi(m,e.name),mi(_,e.name);const C=new _i({uid:y,auth:e,email:u,emailVerified:v,displayName:h,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:T,createdAt:m,lastLoginAt:_});return I&&Array.isArray(I)&&(C.providerData=I.map((e=>Object.assign({},e)))),g&&(C._redirectEventId=g),C}static async _fromIdTokenResponse(e,t,n=!1){const i=new gi;i.updateFromServerResponse(t);const r=new _i({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await pi(r),r}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];Un(void 0!==i.localId,"internal-error");const r=void 0!==i.providerUserInfo?fi(i.providerUserInfo):[],s=!(i.email&&i.passwordHash||(null==r?void 0:r.length)),o=new gi;o.updateFromIdToken(n);const a=new _i({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new di(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash||(null==r?void 0:r.length))};return Object.assign(a,c),a}}const yi=new Map;function vi(e){jn(e instanceof Function,"Expected a class definition");let t=yi.get(e);return t?(jn(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,yi.set(e,t),t)}class wi{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}wi.type="NONE";const Ii=wi;function bi(e,t,n){return`firebase:${e}:${t}:${n}`}class Ti{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=bi(this.userKey,i.apiKey,r),this.fullPersistenceKey=bi("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await si(this.auth,{idToken:e}).catch((()=>{}));return t?_i._fromGetAccountInfoResponse(this.auth,t,e):null}return _i._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Ti(vi(Ii),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let r=i[0]||vi(Ii);const s=bi(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){let i;if("string"==typeof t){const n=await si(e,{idToken:t}).catch((()=>{}));if(!n)break;i=await _i._fromGetAccountInfoResponse(e,n,t)}else i=_i._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new Ti(r,e,n)):new Ti(r,e,n)}}function Ci(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Pi(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Ei(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ri(t))return"Blackberry";if(Ai(t))return"Webos";if(Si(t))return"Safari";if((t.includes("chrome/")||ki(t))&&!t.includes("edge/"))return"Chrome";if(Ni(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Ei(e=y()){return/firefox\//i.test(e)}function Si(e=y()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ki(e=y()){return/crios\//i.test(e)}function Pi(e=y()){return/iemobile/i.test(e)}function Ni(e=y()){return/android/i.test(e)}function Ri(e=y()){return/blackberry/i.test(e)}function Ai(e=y()){return/webos/i.test(e)}function Oi(e=y()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Di(e=y()){return Oi(e)||Ni(e)||Ai(e)||Ri(e)||/windows phone/i.test(e)||Pi(e)}function xi(e,t=[]){let n;switch(e){case"Browser":n=Ci(y());break;case"Worker":n=`${Ci(y())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${at}/${i}`}class Li{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Mi{constructor(e){var t,n,i,r;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(r=e.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,r,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(i=a.containsLowercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(r=a.containsUppercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class Ui{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ji(this),this.idTokenSubscription=new ji(this),this.beforeStateQueue=new Li(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Nn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise((e=>this._resolvePersistenceManagerAvailable=e))}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=vi(t)),this._initializationPromise=this.queue((async()=>{var n,i,r;if(!this._deleted&&(this.persistenceManager=await Ti.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(i=this._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await si(this,{idToken:e}),n=await _i._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(rt(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Un(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await pi(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(rt(this.app))return Promise.reject(Ln(this));const t=e?q(e):null;return t&&Un(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Un(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return rt(this.app)?Promise.reject(Ln(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return rt(this.app)?Promise.reject(Ln(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(vi(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Jn(e,"GET","/v2/passwordPolicy",Gn(e,t))}(this),t=new Mi(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new E("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Jn(e,"POST","/v2/accounts:revokeToken",Gn(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&vi(e)||this._popupRedirectResolver;Un(t,this,"argument-error"),this.redirectPersistenceManager=await Ti.create(this,[vi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Un(o,this,"internal-error"),o.then((()=>{s||r(this.currentUser)})),"function"==typeof t){const r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Un(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=xi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(rt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Rn.logLevel<=Q.WARN&&Rn.warn(`Auth (${at}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Fi(e){return q(e)}class ji{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new W(e,void 0);return t.subscribe.bind(t)}((e=>this.observer=e))}get next(){return Un(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Wi={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function $i(e){return Wi.loadJS(e)}function Hi(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Bi{constructor(){this.enterprise=new Vi}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Vi{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const qi="NO_RECAPTCHA";class zi{constructor(e){this.type="recaptcha-enterprise",this.auth=Fi(e)}async verify(e="verify",t=!1){function n(t,n,i){const r=window.grecaptcha;ni(r)?r.enterprise.ready((()=>{r.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(qi)}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new Bi).execute("siteKey",{action:"verify"}):new Promise(((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{ri(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new ii(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((r=>{if(!t&&ni(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=Wi.recaptchaEnterpriseScript;0!==t.length&&(t+=r),$i(t).then((()=>{n(r,e,i)})).catch((e=>{i(e)}))}})).catch((e=>{i(e)}))}))}}async function Ki(e,t,n,i=!1,r=!1){const s=new zi(e);let o;if(r)o=qi;else try{o=await s.verify(n)}catch(e){o=await s.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Gi(e,t,n,i,r){var s,o;if("EMAIL_PASSWORD_PROVIDER"===r){if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await Ki(e,t,n,"getOobCode"===n);return i(e,r)}return i(e,t).catch((async r=>{if("auth/missing-recaptcha-token"===r.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const r=await Ki(e,t,n,"getOobCode"===n);return i(e,r)}return Promise.reject(r)}))}if("PHONE_PROVIDER"===r){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const r=await Ki(e,t,n);return i(e,r).catch((async r=>{var s;if("AUDIT"===(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const r=await Ki(e,t,n,!1,!0);return i(e,r)}return Promise.reject(r)}))}{const r=await Ki(e,t,n,!1,!0);return i(e,r)}}return Promise.reject(r+" provider is not supported.")}function Ji(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Yi(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Qi{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Fn("not implemented")}_getIdTokenResponse(e){return Fn("not implemented")}_linkToIdToken(e,t){return Fn("not implemented")}_getReauthenticationResolver(e){return Fn("not implemented")}}async function Xi(e,t){return Jn(e,"POST","/v1/accounts:signUp",t)}async function Zi(e,t){return Qn(e,"POST","/v1/accounts:signInWithPassword",Gn(e,t))}class er extends Qi{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new er(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new er(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Gi(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Zi,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Qn(e,"POST","/v1/accounts:signInWithEmailLink",Gn(e,t))}(e,{email:this._email,oobCode:this._password});default:On(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Gi(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Xi,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Qn(e,"POST","/v1/accounts:signInWithEmailLink",Gn(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:On(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function tr(e,t){return Qn(e,"POST","/v1/accounts:signInWithIdp",Gn(e,t))}class nr extends Qi{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new nr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):On("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=kn(t,["providerId","signInMethod"]);if(!n||!i)return null;const s=new nr(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return tr(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,tr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,tr(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=M(t)}return e}}async function ir(e,t){return Jn(e,"POST","/v1/accounts:sendVerificationCode",Gn(e,t))}const rr={USER_NOT_FOUND:"user-not-found"};class sr extends Qi{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new sr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new sr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Qn(e,"POST","/v1/accounts:signInWithPhoneNumber",Gn(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Qn(e,"POST","/v1/accounts:signInWithPhoneNumber",Gn(e,t));if(n.temporaryProof)throw ti(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Qn(e,"POST","/v1/accounts:signInWithPhoneNumber",Gn(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),rr)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new sr({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class or{constructor(e){var t,n,i,r,s,o;const a=U(F(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);Un(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(r=a.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(s=a.lang)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=U(F(e)).link,n=t?U(F(t)).deep_link_id:null,i=U(F(e)).deep_link_id;return(i?U(F(i)).link:null)||i||n||t||e}(e);try{return new or(t)}catch(e){return null}}}class ar{constructor(){this.providerId=ar.PROVIDER_ID}static credential(e,t){return er._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=or.parseLink(t);return Un(n,"argument-error"),er._fromEmailAndCode(e,n.code,n.tenantId)}}ar.PROVIDER_ID="password",ar.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ar.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class cr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class lr extends cr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class hr extends lr{constructor(){super("facebook.com")}static credential(e){return nr._fromParams({providerId:hr.PROVIDER_ID,signInMethod:hr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return hr.credentialFromTaggedObject(e)}static credentialFromError(e){return hr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return hr.credential(e.oauthAccessToken)}catch(e){return null}}}hr.FACEBOOK_SIGN_IN_METHOD="facebook.com",hr.PROVIDER_ID="facebook.com";class ur extends lr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return nr._fromParams({providerId:ur.PROVIDER_ID,signInMethod:ur.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ur.credentialFromTaggedObject(e)}static credentialFromError(e){return ur.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ur.credential(t,n)}catch(e){return null}}}ur.GOOGLE_SIGN_IN_METHOD="google.com",ur.PROVIDER_ID="google.com";class dr extends lr{constructor(){super("github.com")}static credential(e){return nr._fromParams({providerId:dr.PROVIDER_ID,signInMethod:dr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return dr.credentialFromTaggedObject(e)}static credentialFromError(e){return dr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return dr.credential(e.oauthAccessToken)}catch(e){return null}}}dr.GITHUB_SIGN_IN_METHOD="github.com",dr.PROVIDER_ID="github.com";class pr extends lr{constructor(){super("twitter.com")}static credential(e,t){return nr._fromParams({providerId:pr.PROVIDER_ID,signInMethod:pr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return pr.credentialFromTaggedObject(e)}static credentialFromError(e){return pr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return pr.credential(t,n)}catch(e){return null}}}pr.TWITTER_SIGN_IN_METHOD="twitter.com",pr.PROVIDER_ID="twitter.com";class fr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const r=await _i._fromIdTokenResponse(e,n,i),s=gr(n);return new fr({user:r,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=gr(n);return new fr({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function gr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class mr extends C{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,mr.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new mr(e,t,n,i)}}function _r(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw mr._fromErrorAndOperation(e,n,t,i);throw n}))}function yr(e,t){return Jn(e,"POST","/v2/accounts/mfaEnrollment:start",Gn(e,t))}new WeakMap;const vr="__sak";class wr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(vr,"1"),this.storage.removeItem(vr),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ir extends wr{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Di(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);!function(){const e=y();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||r===e.newValue||e.newValue===e.oldValue?i():setTimeout(i,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ir.type="LOCAL";const br=Ir;class Tr extends wr{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Tr.type="SESSION";const Cr=Tr;class Er{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Er(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map((async e=>e(t.origin,r))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Sr(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Er.receivers=[];class kr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const c=Sr("",20);i.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(l),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Pr(){return window}function Nr(){return void 0!==Pr().WorkerGlobalScope&&"function"==typeof Pr().importScripts}const Rr="firebaseLocalStorageDb",Ar="firebaseLocalStorage",Or="fbase_key";class Dr{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function xr(e,t){return e.transaction([Ar],t?"readwrite":"readonly").objectStore(Ar)}function Lr(){const e=indexedDB.open(Rr,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Ar,{keyPath:Or})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Ar)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Rr);return new Dr(e).toPromise()}(),t(await Lr()))}))}))}async function Mr(e,t,n){const i=xr(e,!0).put({[Or]:t,value:n});return new Dr(i).toPromise()}function Ur(e,t){const n=xr(e,!0).delete(t);return new Dr(n).toPromise()}class Fr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Lr()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Nr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Er._getInstance(Nr()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new kr(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Lr();return await Mr(e,vr,"1"),await Ur(e,vr),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Mr(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=xr(e,!1).get(t),i=await new Dr(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Ur(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=xr(e,!1).getAll();return new Dr(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Fr.type="LOCAL";const jr=Fr;function Wr(e,t){return Jn(e,"POST","/v2/accounts/mfaSignIn:start",Gn(e,t))}Hi("rcb"),new Hn(3e4,6e4);const $r="recaptcha";async function Hr(e,t,n){var i;if(!e._getRecaptchaConfig())try{await async function(e){const t=Fi(e),n=await ri(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),i=new ii(n);null==t.tenantId?t._agentRecaptchaConfig=i:t._tenantRecaptchaConfigs[t.tenantId]=i,i.isAnyProviderEnabled()&&new zi(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){Un("enroll"===t.type,e,"internal-error");const i=Gi(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",(async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===qi?(Un((null==n?void 0:n.type)===$r,e,"argument-error"),yr(e,await Br(e,t,n))):yr(e,t)),"PHONE_PROVIDER"),s=await i.catch((e=>Promise.reject(e)));return s.phoneSessionInfo.sessionInfo}{Un("signin"===t.type,e,"internal-error");const s=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;Un(s,e,"missing-multi-factor-info");const o=Gi(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",(async(e,t)=>t.phoneSignInInfo.captchaResponse===qi?(Un((null==n?void 0:n.type)===$r,e,"argument-error"),Wr(e,await Br(e,t,n))):Wr(e,t)),"PHONE_PROVIDER"),a=await o.catch((e=>Promise.reject(e)));return a.phoneResponseInfo.sessionInfo}}{const t=Gi(e,{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",(async(e,t)=>t.captchaResponse===qi?(Un((null==n?void 0:n.type)===$r,e,"argument-error"),ir(e,await Br(e,t,n))):ir(e,t)),"PHONE_PROVIDER"),i=await t.catch((e=>Promise.reject(e)));return i.sessionInfo}}finally{null==n||n._reset()}}async function Br(e,t,n){Un(n.type===$r,e,"argument-error");const i=await n.verify();Un("string"==typeof i,e,"argument-error");const r=Object.assign({},t);if("phoneEnrollmentInfo"in r){const e=r.phoneEnrollmentInfo.phoneNumber,t=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,s=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:s}}),r}if("phoneSignInInfo"in r){const e=r.phoneSignInInfo.captchaResponse,t=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),r}return Object.assign(r,{recaptchaToken:i}),r}class Vr{constructor(e){this.providerId=Vr.PROVIDER_ID,this.auth=Fi(e)}verifyPhoneNumber(e,t){return Hr(this.auth,e,q(t))}static credential(e,t){return sr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Vr.credentialFromTaggedObject(t)}static credentialFromError(e){return Vr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?sr._fromTokenResponse(t,n):null}}function qr(e,t){return t?vi(t):(Un(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Vr.PROVIDER_ID="phone",Vr.PHONE_SIGN_IN_METHOD="phone";class zr extends Qi{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return tr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return tr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return tr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Kr(e){return async function(e,t,n=!1){if(rt(e.app))return Promise.reject(Ln(e));const i="signIn",r=await _r(e,i,t),s=await fr._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}(e.auth,new zr(e),e.bypassAuthState)}function Gr(e){const{auth:t,user:n}=e;return Un(n,t,"internal-error"),async function(e,t,n=!1){const{auth:i}=e;if(rt(i.app))return Promise.reject(Ln(i));const r="reauthenticate";try{const s=await hi(e,_r(i,r,t,e),n);Un(s.idToken,i,"internal-error");const o=ci(s.idToken);Un(o,i,"internal-error");const{sub:a}=o;return Un(e.uid===a,i,"user-mismatch"),fr._forOperation(e,r,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&On(i,"user-mismatch"),e}}(n,new zr(e),e.bypassAuthState)}async function Jr(e){const{auth:t,user:n}=e;return Un(n,t,"internal-error"),async function(e,t,n=!1){const i=await hi(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return fr._forOperation(e,"link",i)}(n,new zr(e),e.bypassAuthState)}class Yr{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Kr;case"linkViaPopup":case"linkViaRedirect":return Jr;case"reauthViaPopup":case"reauthViaRedirect":return Gr;default:On(this.auth,"internal-error")}}resolve(e){jn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){jn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Qr=new Hn(2e3,1e4);async function Xr(e,t,n){if(rt(e.app))return Promise.reject(Dn(e,"operation-not-supported-in-this-environment"));const i=Fi(e);!function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&On(e,"argument-error"),xn(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t,cr);const r=qr(i,n);return new Zr(i,"signInViaPopup",t,r).executeNotNull()}class Zr extends Yr{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,Zr.currentPopupAction&&Zr.currentPopupAction.cancel(),Zr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Un(e,this.auth,"internal-error"),e}async onExecution(){jn(1===this.filter.length,"Popup operations only handle one event");const e=Sr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Dn(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Dn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Dn(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Qr.get())};e()}}Zr.currentPopupAction=null;const es=new Map;class ts extends Yr{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=es.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return bi("pendingRedirect",e.config.apiKey,e.name)}(t),i=function(e){return vi(e._redirectPersistence)}(e);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}es.set(this.auth._key(),e)}return this.bypassAuthState||es.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function ns(e,t){es.set(e._key(),t)}async function is(e,t,n=!1){if(rt(e.app))return Promise.reject(Ln(e));const i=Fi(e),r=qr(i,t),s=new ts(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class rs{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return os(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!os(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Dn(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ss(e))}saveEventToCache(e){this.cachedEventUids.add(ss(e)),this.lastProcessedEventTime=Date.now()}}function ss(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function os({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const as=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cs=/^https?/;function ls(e){const t=Wn(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!cs.test(n))return!1;if(as.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const hs=new Hn(3e4,6e4);function us(){const e=Pr().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function ds(e){return new Promise(((t,n)=>{var i,r,s;function o(){us(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{us(),n(Dn(e,"network-request-failed"))},timeout:hs.get()})}if(null===(r=null===(i=Pr().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Pr().gapi)||void 0===s?void 0:s.load)){const t=Hi("iframefcb");return Pr()[t]=()=>{gapi.load?o():n(Dn(e,"network-request-failed"))},$i(`${Wi.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw ps=null,e}))}let ps=null;const fs=new Hn(5e3,15e3),gs={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ms=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _s(e){const t=e.config;Un(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Bn(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:at},r=ms.get(e.config.apiHost);r&&(i.eid=r);const s=e._getFrameworks();return s.length&&(i.fw=s.join(",")),`${n}?${M(i).slice(1)}`}const ys={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class vs{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const ws=encodeURIComponent("fac");async function Is(e,t,n,i,r,s){Un(e.config.authDomain,e,"auth-domain-config-required"),Un(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:at,eventId:r};if(t instanceof cr){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",O(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof lr){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),l=c?`#${ws}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?Bn(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${M(a).slice(1)}${l}`}const bs="webStorageSupport",Ts=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Cr,this._completeRedirectFn=is,this._overrideRedirectResult=ns}async _openPopup(e,t,n,i){var r;return jn(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},ys),{width:i.toString(),height:r.toString(),top:s,left:o}),l=y().toLowerCase();n&&(a=ki(l)?"_blank":n),Ei(l)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=y()){var t;return Oi(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new vs(null);const u=window.open(t||"",a,h);Un(u,e,"popup-blocked");try{u.focus()}catch(e){}return new vs(u)}(e,await Is(e,t,n,Wn(),i),Sr())}async _openRedirect(e,t,n,i){return await this._originValidation(e),r=await Is(e,t,n,Wn(),i),Pr().location.href=r,new Promise((()=>{}));var r}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(jn(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return ps=ps||ds(e),ps}(e),n=Pr().gapi;return Un(n,e,"internal-error"),t.open({where:document.body,url:_s(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gs,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const r=Dn(e,"network-request-failed"),s=Pr().setTimeout((()=>{i(r)}),fs.get());function o(){Pr().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{i(r)}))}))))}(e),n=new rs(e);return t.register("authEvent",(t=>(Un(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(bs,{type:bs},(n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[bs];void 0!==r&&t(!!r),On(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Jn(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(ls(e))return}catch(e){}On(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Di()||Si()||Oi()}};var Cs="@firebase/auth",Es="1.10.1";class Ss{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Un(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ks=m("authIdTokenMaxAge")||300;let Ps=null;function Ns(e=lt()){const t=it(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=it(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(x(n.getOptions(),null!=t?t:{}))return e;On(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Ts,persistence:[jr,br,Cr]}),i=m("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>ks)return;const i=null==t?void 0:t.token;Ps!==i&&(Ps=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(e,t,n){q(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e){q(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}}var r;const s=f("auth");return s&&function(e,t,n){const i=Fi(e);Un(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=Ji(t),{host:o,port:a}=function(e){const t=Ji(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:Yi(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Yi(t)}}}(t),c={url:`${s}//${o}${null===a?"":`:${a}`}/`},l=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator)return Un(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),void Un(x(c,i.config.emulator)&&x(l,i.emulatorConfig),i,"emulator-config-failed");i.config.emulator=c,i.emulatorConfig=l,i.settings.appVerificationDisabledForTesting=!0,r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}var Rs,As;Rs={loadJS:e=>new Promise(((t,n)=>{const i=document.createElement("script");var r,s;i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=Dn("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(null!==(s=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==s?s:document).appendChild(i)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Wi=Rs,As="Browser",nt(new z("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Un(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:As,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:xi(As)},c=new Ui(n,i,r,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(vi);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),nt(new z("auth-internal",(e=>{return t=Fi(e.getProvider("auth").getImmediate()),new Ss(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),ht(Cs,Es,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(As)),ht(Cs,Es,"esm2017");const Os="@firebase/database",Ds="1.0.14";let xs="";class Ls{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),P(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:k(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Ms{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return R(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Us=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Ls(t)}}catch(e){}return new Ms},Fs=Us("localStorage"),js=Us("sessionStorage"),Ws=new ne("@firebase/database"),$s=function(){let e=1;return function(){return e++}}(),Hs=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);if(s>=55296&&s<=56319){const t=s-55296;r++,i(r<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(r)-56320)}s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):s<65536?(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t}(e),n=new j;n.update(t);const r=n.digest();return o.encodeByteArray(r)},Bs=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=Bs.apply(null,i):t+="object"==typeof i?P(i):i,t+=" "}return t};let Vs=null,qs=!0;const zs=function(...e){if(!0===qs&&(qs=!1,null===Vs&&!0===js.get("logging_enabled")&&(t=!0,i(!n||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Ws.logLevel=Q.VERBOSE,Vs=Ws.log.bind(Ws),n&&js.set("logging_enabled",!0)):"function"==typeof t?Vs=t:(Vs=null,js.remove("logging_enabled")))),Vs){const t=Bs.apply(null,e);Vs(t)}var t,n},Ks=function(e){return function(...t){zs(e,...t)}},Gs=function(...e){const t="FIREBASE INTERNAL ERROR: "+Bs(...e);Ws.error(t)},Js=function(...e){const t=`FIREBASE FATAL ERROR: ${Bs(...e)}`;throw Ws.error(t),new Error(t)},Ys=function(...e){const t="FIREBASE WARNING: "+Bs(...e);Ws.warn(t)},Qs=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Xs="[MIN_NAME]",Zs="[MAX_NAME]",eo=function(e,t){if(e===t)return 0;if(e===Xs||t===Zs)return-1;if(t===Xs||e===Zs)return 1;{const n=co(e),i=co(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},to=function(e,t){return e===t?0:e<t?-1:1},no=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+P(t))},io=function(e){if("object"!=typeof e||null===e)return P(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=P(t[i]),n+=":",n+=io(e[t[i]]);return n+="}",n},ro=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function so(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const oo=function(e){i(!Qs(e),"Invalid JSON number");let t,n,r,s,o;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=s+1023,r=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},ao=new RegExp("^-?(0*)\\d{1,10}$"),co=function(e){if(ao.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},lo=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw Ys("Exception was thrown by user callback.",t),e}),Math.floor(0))}},ho=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class uo{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,rt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){Ys(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class po{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(zs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ys(e)}}class fo{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}fo.OWNER="owner";const go="5",mo=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,_o="ac",yo="websocket",vo="long_polling";class wo{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,c=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Fs.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Fs.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Io(e,t,n){let r;if(i("string"==typeof t,"typeof type must == string"),i("object"==typeof n,"typeof params must == object"),t===yo)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==vo)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const s=[];return so(n,((e,t)=>{s.push(e+"="+t)})),r+s.join("&")}class bo{constructor(){this.counters_={}}incrementCounter(e,t=1){R(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return u(this.counters_)}}const To={},Co={};function Eo(e){const t=e.toString();return To[t]||(To[t]=new bo),To[t]}class So{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&lo((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const ko="start";class Po{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ks(e),this.stats_=Eo(t),this.urlFn=e=>(this.appCheckToken&&(e[_o]=this.appCheckToken),Io(t,vo,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new So(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new No(((...e)=>{const[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===ko)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[ko]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=go,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[_o]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&mo.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Po.forceAllow_=!0}static forceDisallow(){Po.forceDisallow_=!0}static isAvailable(){return!(!Po.forceAllow_&&(Po.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=P(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=c(t),i=ro(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=P(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class No{constructor(e,t,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=$s(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=No.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){zs("frame writing exception"),e.stack&&zs(e.stack),zs(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||zs("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{zs("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let Ro=null;"undefined"!=typeof MozWebSocket?Ro=MozWebSocket:"undefined"!=typeof WebSocket&&(Ro=WebSocket);class Ao{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ks(this.connId),this.stats_=Eo(t),this.connURL=Ao.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){const s={};return s.v=go,"undefined"!=typeof location&&location.hostname&&mo.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s[_o]=i),r&&(s.p=r),Io(e,yo,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Fs.set("previous_websocket_failure",!0);try{let e;0,this.mySock=new Ro(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Ao.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Ro&&!Ao.forceDisallow_}static previouslyFailed(){return Fs.isInMemoryStorage||!0===Fs.get("previous_websocket_failure")}markConnectionHealthy(){Fs.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=k(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(i(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=P(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=ro(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ao.responsesRequiredToBeHealthy=2,Ao.healthyTimeout=3e4;class Oo{static get ALL_TRANSPORTS(){return[Po,Ao]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Ao&&Ao.isAvailable();let n=t&&!Ao.previouslyFailed();if(e.webSocketOnly&&(t||Ys("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Ao];else{const e=this.transports_=[];for(const t of Oo.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);Oo.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Oo.globalTransportInitialized_=!1;class Do{constructor(e,t,n,i,r,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ks("c:"+this.id+":"),this.transportManager_=new Oo(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=ho((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=no("t",e),n=no("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=no("t",e),n=no("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=no("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Gs("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Gs("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),go!==n&&Ys("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),ho((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ho((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Fs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class xo{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Lo{constructor(e){this.allowedEvents_=e,this.listeners_={},i(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){i(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class Mo extends Lo{static getInstance(){return new Mo}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||v()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}getInitialEvent(e){return i("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Uo{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Fo(){return new Uo("")}function jo(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Wo(e){return e.pieces_.length-e.pieceNum_}function $o(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Uo(e.pieces_,t)}function Ho(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Bo(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Vo(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Uo(t,0)}function qo(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof Uo)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Uo(n,0)}function zo(e){return e.pieceNum_>=e.pieces_.length}function Ko(e,t){const n=jo(e),i=jo(t);if(null===n)return t;if(n===i)return Ko($o(e),$o(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Go(e,t){if(Wo(e)!==Wo(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function Jo(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(Wo(e)>Wo(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class Yo{constructor(e,t){this.errorPrefix_=t,this.parts_=Bo(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=B(this.parts_[e]);Qo(this)}}function Qo(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Xo(e))}function Xo(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Zo extends Lo{static getInstance(){return new Zo}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}getInitialEvent(e){return i("visible"===e,"Unknown event type: "+e),[this.visible_]}}const ea=1e3;class ta extends xo{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=ta.nextPersistentConnectionId_++,this.log_=Ks("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ea,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Zo.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Mo.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,s={r,a:e,b:t};this.log_(P(s)),i(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new _,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),i(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),i(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,(r=>{const s=r.d,o=r.s;ta.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&R(e,"w")){const n=A(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();Ys(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=N(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=N(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),i(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();const s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+P(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Gs("Unrecognized action received from server: "+P(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){i(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ea,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ea,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=ea),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+ta.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,n())},l=function(e){i(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[i,c]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?zs("getToken() completed but was canceled"):(zs("getToken() completed. Creating connection."),this.authToken_=i&&i.accessToken,this.appCheckToken_=c&&c.token,a=new Do(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{Ys(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&Ys(e),c())}}}interrupt(e){zs("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){zs("Resuming connection for reason: "+e),delete this.interruptReasons_[e],O(this.interruptReasons_)&&(this.reconnectDelay_=ea,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>io(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new Uo(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){zs("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){zs("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+xs.replace(/\./g,"-")]=1,v()?e["framework.cordova"]=1:I()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Mo.getInstance().currentlyOnline();return O(this.interruptReasons_)&&e}}ta.nextPersistentConnectionId_=0,ta.nextConnectionId_=0;class na{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new na(e,t)}}class ia{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new na(Xs,e),i=new na(Xs,t);return 0!==this.compare(n,i)}minPost(){return na.MIN}}let ra;class sa extends ia{static get __EMPTY_NODE(){return ra}static set __EMPTY_NODE(e){ra=e}compare(e,t){return eo(e.name,t.name)}isDefinedOn(e){throw r("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return na.MIN}maxPost(){return new na(Zs,ra)}makePost(e,t){return i("string"==typeof e,"KeyIndex indexValue must always be a string."),new na(e,ra)}toString(){return".key"}}const oa=new sa;class aa{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class ca{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:ca.RED,this.left=null!=i?i:la.EMPTY_NODE,this.right=null!=r?r:la.EMPTY_NODE}copy(e,t,n,i,r){return new ca(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return la.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return la.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,ca.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,ca.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}ca.RED=!0,ca.BLACK=!1;class la{constructor(e,t=la.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new la(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ca.BLACK,null,null))}remove(e){return new la(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ca.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new aa(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new aa(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new aa(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new aa(this.root_,null,this.comparator_,!0,e)}}function ha(e,t){return eo(e.name,t.name)}function ua(e,t){return eo(e,t)}let da;la.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new ca(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const pa=function(e){return"number"==typeof e?"number:"+oo(e):"string:"+e},fa=function(e){if(e.isLeafNode()){const t=e.val();i("string"==typeof t||"number"==typeof t||"object"==typeof t&&R(t,".sv"),"Priority must be a string or number.")}else i(e===da||e.isEmpty(),"priority of unexpected type.");i(e===da||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let ga,ma,_a;class ya{static set __childrenNodeConstructor(e){ga=e}static get __childrenNodeConstructor(){return ga}constructor(e,t=ya.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,i(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),fa(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ya(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:ya.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return zo(e)?this:".priority"===jo(e)?this.priorityNode_:ya.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:ya.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=jo(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(i(".priority"!==n||1===Wo(e),".priority must be the last token in a path"),this.updateImmediateChild(n,ya.__childrenNodeConstructor.EMPTY_NODE.updateChild($o(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+pa(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?oo(this.value_):this.value_,this.lazyHash_=Hs(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ya.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ya.__childrenNodeConstructor?-1:(i(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=ya.VALUE_TYPE_ORDER.indexOf(t),s=ya.VALUE_TYPE_ORDER.indexOf(n);return i(r>=0,"Unknown leaf type: "+t),i(s>=0,"Unknown leaf type: "+n),r===s?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}ya.VALUE_TYPE_ORDER=["object","boolean","number","string"];const va=new class extends ia{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?eo(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return na.MIN}maxPost(){return new na(Zs,new ya("[PRIORITY-POST]",_a))}makePost(e,t){const n=ma(e);return new na(t,new ya("[PRIORITY-POST]",n))}toString(){return".priority"}},wa=Math.log(2);class Ia{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/wa,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const ba=function(e,t,n,i){e.sort(t);const r=function(t,i){const s=i-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new ca(a,o.node,ca.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=r(t,c),h=r(c+1,i);return o=e[c],a=n?n(o):o,new ca(a,o.node,ca.BLACK,l,h)}},s=function(t){let i=null,s=null,o=e.length;const a=function(t,i){const s=o-t,a=o;o-=t;const l=r(s+1,a),h=e[s],u=n?n(h):h;c(new ca(u,h.node,i,null,l))},c=function(e){i?(i.left=e,i=e):(s=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,ca.BLACK):(a(i,ca.BLACK),a(i,ca.RED))}return s}(new Ia(e.length));return new la(i||t,s)};let Ta;const Ca={};class Ea{static get Default(){return i(Ca&&va,"ChildrenNode.ts has not been loaded"),Ta=Ta||new Ea({".priority":Ca},{".priority":va}),Ta}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=A(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof la?t:null}hasIndex(e){return R(this.indexSet_,e.toString())}addIndex(e,t){i(e!==oa,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const s=t.getIterator(na.Wrap);let o,a=s.getNext();for(;a;)r=r||e.isDefinedOn(a.node),n.push(a),a=s.getNext();o=r?ba(n,e.getCompare()):Ca;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const h=Object.assign({},this.indexes_);return h[c]=o,new Ea(h,l)}addToIndexes(e,t){const n=D(this.indexes_,((n,r)=>{const s=A(this.indexSet_,r);if(i(s,"Missing index implementation for "+r),n===Ca){if(s.isDefinedOn(e.node)){const n=[],i=t.getIterator(na.Wrap);let r=i.getNext();for(;r;)r.name!==e.name&&n.push(r),r=i.getNext();return n.push(e),ba(n,s.getCompare())}return Ca}{const i=t.get(e.name);let r=n;return i&&(r=r.remove(new na(e.name,i))),r.insert(e,e.node)}}));return new Ea(n,this.indexSet_)}removeFromIndexes(e,t){const n=D(this.indexes_,(n=>{if(n===Ca)return n;{const i=t.get(e.name);return i?n.remove(new na(e.name,i)):n}}));return new Ea(n,this.indexSet_)}}let Sa;class ka{static get EMPTY_NODE(){return Sa||(Sa=new ka(new la(ua),null,Ea.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&fa(this.priorityNode_),this.children_.isEmpty()&&i(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Sa}updatePriority(e){return this.children_.isEmpty()?this:new ka(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Sa:t}}getChild(e){const t=jo(e);return null===t?this:this.getImmediateChild(t).getChild($o(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(i(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new na(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const s=i.isEmpty()?Sa:this.priorityNode_;return new ka(i,s,r)}}updateChild(e,t){const n=jo(e);if(null===n)return t;{i(".priority"!==jo(e)||1===Wo(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild($o(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,r=!0;if(this.forEachChild(va,((s,o)=>{t[s]=o.val(e),n++,r&&ka.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1})),!e&&r&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+pa(this.getPriority().val())+":"),this.forEachChild(va,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":Hs(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new na(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new na(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new na(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,na.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,na.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Pa?-1:0}withIndex(e){if(e===oa||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ka(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===oa||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(va),n=t.getIterator(va);let i=e.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=e.getNext(),r=n.getNext()}return null===i&&null===r}return!1}return!1}}resolveIndex_(e){return e===oa?null:this.indexMap_.get(e.toString())}}ka.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Pa=new class extends ka{constructor(){super(new la(ua),ka.EMPTY_NODE,Ea.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ka.EMPTY_NODE}isEmpty(){return!1}};function Na(e,t=null){if(null===e)return ka.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),i(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new ya(e,Na(t));if(e instanceof Array){let n=ka.EMPTY_NODE;return so(e,((t,i)=>{if(R(e,t)&&"."!==t.substring(0,1)){const e=Na(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(Na(t))}{const n=[];let i=!1;if(so(e,((e,t)=>{if("."!==e.substring(0,1)){const r=Na(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new na(e,r)))}})),0===n.length)return ka.EMPTY_NODE;const r=ba(n,ha,(e=>e.name),ua);if(i){const e=ba(n,va.getCompare());return new ka(r,Na(t),new Ea({".priority":e},{".priority":va}))}return new ka(r,Na(t),Ea.Default)}}Object.defineProperties(na,{MIN:{value:new na(Xs,ka.EMPTY_NODE)},MAX:{value:new na(Zs,Pa)}}),sa.__EMPTY_NODE=ka.EMPTY_NODE,ya.__childrenNodeConstructor=ka,da=Pa,_a=Pa,function(e){ma=e}(Na);class Ra extends ia{constructor(e){super(),this.indexPath_=e,i(!zo(e)&&".priority"!==jo(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?eo(e.name,t.name):r}makePost(e,t){const n=Na(e),i=ka.EMPTY_NODE.updateChild(this.indexPath_,n);return new na(t,i)}maxPost(){const e=ka.EMPTY_NODE.updateChild(this.indexPath_,Pa);return new na(Zs,e)}toString(){return Bo(this.indexPath_,0).join("/")}}const Aa=new class extends ia{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?eo(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return na.MIN}maxPost(){return na.MAX}makePost(e,t){const n=Na(e);return new na(t,n)}toString(){return".value"}};function Oa(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Da{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=va}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return i(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return i(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Xs}hasEnd(){return this.endSet_}getIndexEndValue(){return i(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return i(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Zs}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return i(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===va}copy(){const e=new Da;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function xa(e){const t={};if(e.isDefault())return t;let n;if(e.index_===va?n="$priority":e.index_===Aa?n="$value":e.index_===oa?n="$key":(i(e.index_ instanceof Ra,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=P(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=P(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+P(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=P(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+P(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function La(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==va&&(t.i=e.index_.toString()),t}class Ma extends xo{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(i(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=Ks("p:rest:"),this.listens_={}}listen(e,t,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const s=Ma.getListenId_(e,n),o={};this.listens_[s]=o;const a=xa(e._queryParams);this.restRequest_(r+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),A(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=Ma.getListenId_(e,t);delete this.listens_[n]}get(e){const t=xa(e._queryParams),n=e._path.toString(),i=new _;return this.restRequest_(n+".json",t,((e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+M(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=k(o.responseText)}catch(e){Ys("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&Ys("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()}))}}class Ua{constructor(){this.rootNode_=ka.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Fa(){return{value:null,children:new Map}}function ja(e,t,n){if(zo(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=jo(t);e.children.has(i)||e.children.set(i,Fa()),ja(e.children.get(i),t=$o(t),n)}}function Wa(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{Wa(i,new Uo(t.toString()+"/"+e),n)}))}class $a{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&so(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Ha{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new $a(e);const n=1e4+2e4*Math.random();ho(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;so(e,((e,i)=>{i>0&&R(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),ho(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Ba,Va;function qa(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(Va=Ba||(Ba={}))[Va.OVERWRITE=0]="OVERWRITE",Va[Va.MERGE=1]="MERGE",Va[Va.ACK_USER_WRITE=2]="ACK_USER_WRITE",Va[Va.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class za{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Ba.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(zo(this.path)){if(null!=this.affectedTree.value)return i(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Uo(e));return new za(Fo(),t,this.revert)}}return i(jo(this.path)===e,"operationForChild called for unrelated child."),new za($o(this.path),this.affectedTree,this.revert)}}class Ka{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Ba.OVERWRITE}operationForChild(e){return zo(this.path)?new Ka(this.source,Fo(),this.snap.getImmediateChild(e)):new Ka(this.source,$o(this.path),this.snap)}}class Ga{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Ba.MERGE}operationForChild(e){if(zo(this.path)){const t=this.children.subtree(new Uo(e));return t.isEmpty()?null:t.value?new Ka(this.source,Fo(),t.value):new Ga(this.source,Fo(),t)}return i(jo(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ga(this.source,$o(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Ja{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(zo(e))return this.isFullyInitialized()&&!this.filtered_;const t=jo(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function Ya(e,t,n,i,s,o){const a=i.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw r("Should only compare child_ events.");const i=new na(t.childName,t.snapshotNode),s=new na(n.childName,n.snapshotNode);return e.index_.compare(i,s)}(e,t,n))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);s.forEach((r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))}))}))}function Qa(e,t){return{eventCache:e,serverCache:t}}function Xa(e,t,n,i){return Qa(new Ja(t,n,i),e.serverCache)}function Za(e,t,n,i){return Qa(e.eventCache,new Ja(t,n,i))}function ec(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function tc(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let nc;class ic{static fromObject(e){let t=new ic(null);return so(e,((e,n)=>{t=t.set(new Uo(e),n)})),t}constructor(e,t=(()=>(nc||(nc=new la(to)),nc))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Fo(),value:this.value};if(zo(e))return null;{const n=jo(e),i=this.children.get(n);if(null!==i){const r=i.findRootMostMatchingPathAndValue($o(e),t);return null!=r?{path:qo(new Uo(n),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(zo(e))return this;{const t=jo(e),n=this.children.get(t);return null!==n?n.subtree($o(e)):new ic(null)}}set(e,t){if(zo(e))return new ic(t,this.children);{const n=jo(e),i=(this.children.get(n)||new ic(null)).set($o(e),t),r=this.children.insert(n,i);return new ic(this.value,r)}}remove(e){if(zo(e))return this.children.isEmpty()?new ic(null):new ic(null,this.children);{const t=jo(e),n=this.children.get(t);if(n){const i=n.remove($o(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new ic(null):new ic(this.value,r)}return this}}get(e){if(zo(e))return this.value;{const t=jo(e),n=this.children.get(t);return n?n.get($o(e)):null}}setTree(e,t){if(zo(e))return t;{const n=jo(e),i=(this.children.get(n)||new ic(null)).setTree($o(e),t);let r;return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new ic(this.value,r)}}fold(e){return this.fold_(Fo(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,r)=>{n[i]=r.fold_(qo(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Fo(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(zo(e))return null;{const i=jo(e),r=this.children.get(i);return r?r.findOnPath_($o(e),qo(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Fo(),t)}foreachOnPath_(e,t,n){if(zo(e))return this;{this.value&&n(t,this.value);const i=jo(e),r=this.children.get(i);return r?r.foreachOnPath_($o(e),qo(t,i),n):new ic(null)}}foreach(e){this.foreach_(Fo(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(qo(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class rc{constructor(e){this.writeTree_=e}static empty(){return new rc(new ic(null))}}function sc(e,t,n){if(zo(t))return new rc(new ic(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const r=i.path;let s=i.value;const o=Ko(r,t);return s=s.updateChild(o,n),new rc(e.writeTree_.set(r,s))}{const i=new ic(n),r=e.writeTree_.setTree(t,i);return new rc(r)}}}function oc(e,t,n){let i=e;return so(n,((e,n)=>{i=sc(i,qo(t,e),n)})),i}function ac(e,t){if(zo(t))return rc.empty();{const n=e.writeTree_.setTree(t,new ic(null));return new rc(n)}}function cc(e,t){return null!=lc(e,t)}function lc(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Ko(n.path,t)):null}function hc(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(va,((e,n)=>{t.push(new na(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new na(e,n.value))})),t}function uc(e,t){if(zo(t))return e;{const n=lc(e,t);return new rc(null!=n?new ic(n):e.writeTree_.subtree(t))}}function dc(e){return e.writeTree_.isEmpty()}function pc(e,t){return fc(Fo(),e.writeTree_,t)}function fc(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,s)=>{".priority"===t?(i(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):n=fc(qo(e,t),s,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(qo(e,".priority"),r)),n}}function gc(e,t){return Sc(t,e)}function mc(e,t){if(e.snap)return Jo(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Jo(qo(e.path,n),t))return!0;return!1}function _c(e){return e.visible}function yc(e,t,n){let i=rc.empty();for(let s=0;s<e.length;++s){const o=e[s];if(t(o)){const e=o.path;let t;if(o.snap)Jo(n,e)?(t=Ko(n,e),i=sc(i,t,o.snap)):Jo(e,n)&&(t=Ko(e,n),i=sc(i,Fo(),o.snap.getChild(t)));else{if(!o.children)throw r("WriteRecord should have .snap or .children");if(Jo(n,e))t=Ko(n,e),i=oc(i,t,o.children);else if(Jo(e,n))if(t=Ko(e,n),zo(t))i=oc(i,Fo(),o.children);else{const e=A(o.children,jo(t));if(e){const n=e.getChild($o(t));i=sc(i,Fo(),n)}}}}}return i}function vc(e,t,n,i,r){if(i||r){const s=uc(e.visibleWrites,t);if(!r&&dc(s))return n;if(r||null!=n||cc(s,Fo())){const s=function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(Jo(e.path,t)||Jo(t,e.path))};return pc(yc(e.allWrites,s,t),n||ka.EMPTY_NODE)}return null}{const i=lc(e.visibleWrites,t);if(null!=i)return i;{const i=uc(e.visibleWrites,t);return dc(i)?n:null!=n||cc(i,Fo())?pc(i,n||ka.EMPTY_NODE):null}}}function wc(e,t,n,i){return vc(e.writeTree,e.treePath,t,n,i)}function Ic(e,t){return function(e,t,n){let i=ka.EMPTY_NODE;const r=lc(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(va,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const r=uc(e.visibleWrites,t);return n.forEachChild(va,((e,t)=>{const n=pc(uc(r,new Uo(e)),t);i=i.updateImmediateChild(e,n)})),hc(r).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return hc(uc(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function bc(e,t,n,r){return function(e,t,n,r,s){i(r||s,"Either existingEventSnap or existingServerSnap must exist");const o=qo(t,n);if(cc(e.visibleWrites,o))return null;{const t=uc(e.visibleWrites,o);return dc(t)?s.getChild(n):pc(t,s.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function Tc(e,t){return function(e,t){return lc(e.visibleWrites,t)}(e.writeTree,qo(e.treePath,t))}function Cc(e,t,n){return function(e,t,n,i){const r=qo(t,n),s=lc(e.visibleWrites,r);return null!=s?s:i.isCompleteForChild(n)?pc(uc(e.visibleWrites,r),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Ec(e,t){return Sc(qo(e.treePath,t),e.writeTree)}function Sc(e,t){return{treePath:e,writeTree:t}}class kc{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;i("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),i(".priority"!==n,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(n);if(s){const i=s.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Oa(n,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,(o=n,{type:"child_removed",snapshotNode:s.oldSnap,childName:o}));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,function(e,t){return{type:"child_added",snapshotNode:t,childName:e}}(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw r("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(n,Oa(n,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(n,e);var o}getChanges(){return Array.from(this.changeMap.values())}}const Pc=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Nc{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Ja(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Cc(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:tc(this.viewCache_),r=function(e,t,n,i,r,s){return function(e,t,n,i,r,s,o){let a;const c=uc(e.visibleWrites,t),l=lc(c,Fo());if(null!=l)a=l;else{if(null==n)return[];a=pc(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<r;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,r,s)}(this.writes_,i,t,1,n,e);return 0===r.length?null:r[0]}}function Rc(e,t,n,r,s,o){const a=t.eventCache;if(null!=Tc(r,n))return t;{let c,l;if(zo(n))if(i(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=tc(t),i=Ic(r,n instanceof ka?n:ka.EMPTY_NODE);c=e.filter.updateFullNode(t.eventCache.getNode(),i,o)}else{const n=wc(r,tc(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const h=jo(n);if(".priority"===h){i(1===Wo(n),"Can't have a priority with additional path components");const s=a.getNode();l=t.serverCache.getNode();const o=bc(r,n,s,l);c=null!=o?e.filter.updatePriority(s,o):a.getNode()}else{const i=$o(n);let u;if(a.isCompleteForChild(h)){l=t.serverCache.getNode();const e=bc(r,n,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(i,e):a.getNode().getImmediateChild(h)}else u=Cc(r,h,t.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),h,u,i,s,o):a.getNode()}}return Xa(t,c,a.isFullyInitialized()||zo(n),e.filter.filtersNodes())}}function Ac(e,t,n,i,r,s,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(zo(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),e,null)}else{const e=jo(n);if(!c.isCompleteForPath(n)&&Wo(n)>1)return t;const r=$o(n),s=c.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?h.updatePriority(c.getNode(),s):h.updateChild(c.getNode(),e,s,r,Pc,null)}const u=Za(t,l,c.isFullyInitialized()||zo(n),h.filtersNodes());return Rc(e,u,n,r,new Nc(r,u,s),a)}function Oc(e,t,n,i,r,s,o){const a=t.eventCache;let c,l;const h=new Nc(r,t,s);if(zo(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=Xa(t,l,!0,e.filter.filtersNodes());else{const r=jo(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),c=Xa(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=$o(n),l=a.getNode().getImmediateChild(r);let u;if(zo(s))u=i;else{const e=h.getCompleteChild(r);u=null!=e?".priority"===Ho(s)&&e.getChild(Vo(s)).isEmpty()?e:e.updateChild(s,i):ka.EMPTY_NODE}c=l.equals(u)?t:Xa(t,e.filter.updateChild(a.getNode(),r,u,s,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function Dc(e,t){return e.eventCache.isCompleteForChild(t)}function xc(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Lc(e,t,n,i,r,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=zo(n)?i:new ic(null).setTree(n,i);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const c=xc(0,t.serverCache.getNode().getImmediateChild(n),i);l=Ac(e,l,new Uo(n),c,r,s,o,a)}})),c.children.inorderTraversal(((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!c){const c=xc(0,t.serverCache.getNode().getImmediateChild(n),i);l=Ac(e,l,new Uo(n),c,r,s,o,a)}})),l}function Mc(e,t){const n=tc(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!zo(t)&&!n.getImmediateChild(jo(t)).isEmpty())?n.getChild(t):null}function Uc(e,t,n,s){t.type===Ba.MERGE&&null!==t.source.queryId&&(i(tc(e.viewCache_),"We should always have a full cache before handling merges"),i(ec(e.viewCache_),"Missing event cache, even though we have a server cache"));const o=e.viewCache_,a=function(e,t,n,s,o){const a=new kc;let c,l;if(n.type===Ba.OVERWRITE){const r=n;r.source.fromUser?c=Oc(e,t,r.path,r.snap,s,o,a):(i(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered()&&!zo(r.path),c=Ac(e,t,r.path,r.snap,s,o,l,a))}else if(n.type===Ba.MERGE){const r=n;r.source.fromUser?c=function(e,t,n,i,r,s,o){let a=t;return i.foreach(((i,c)=>{const l=qo(n,i);Dc(t,jo(l))&&(a=Oc(e,a,l,c,r,s,o))})),i.foreach(((i,c)=>{const l=qo(n,i);Dc(t,jo(l))||(a=Oc(e,a,l,c,r,s,o))})),a}(e,t,r.path,r.children,s,o,a):(i(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered(),c=Lc(e,t,r.path,r.children,s,o,l,a))}else if(n.type===Ba.ACK_USER_WRITE){const r=n;c=r.revert?function(e,t,n,r,s,o){let a;if(null!=Tc(r,n))return t;{const c=new Nc(r,t,s),l=t.eventCache.getNode();let h;if(zo(n)||".priority"===jo(n)){let n;if(t.serverCache.isFullyInitialized())n=wc(r,tc(t));else{const e=t.serverCache.getNode();i(e instanceof ka,"serverChildren would be complete if leaf node"),n=Ic(r,e)}h=e.filter.updateFullNode(l,n,o)}else{const i=jo(n);let s=Cc(r,i,t.serverCache);null==s&&t.serverCache.isCompleteForChild(i)&&(s=l.getImmediateChild(i)),h=null!=s?e.filter.updateChild(l,i,s,$o(n),c,o):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,ka.EMPTY_NODE,$o(n),c,o):l,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=wc(r,tc(t)),a.isLeafNode()&&(h=e.filter.updateFullNode(h,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=Tc(r,Fo()),Xa(t,h,a,e.filter.filtersNodes())}}(e,t,r.path,s,o,a):function(e,t,n,i,r,s,o){if(null!=Tc(r,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(zo(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Ac(e,t,n,c.getNode().getChild(n),r,s,a,o);if(zo(n)){let i=new ic(null);return c.getNode().forEachChild(oa,((e,t)=>{i=i.set(new Uo(e),t)})),Lc(e,t,n,i,r,s,a,o)}return t}{let l=new ic(null);return i.foreach(((e,t)=>{const i=qo(n,e);c.isCompleteForPath(i)&&(l=l.set(e,c.getNode().getChild(i)))})),Lc(e,t,n,l,r,s,a,o)}}(e,t,r.path,r.affectedTree,s,o,a)}else{if(n.type!==Ba.LISTEN_COMPLETE)throw r("Unknown operation type: "+n.type);c=function(e,t,n,i,r){const s=t.serverCache;return Rc(e,Za(t,s.getNode(),s.isFullyInitialized()||zo(n),s.isFiltered()),n,i,Pc,r)}(e,t,n.path,s,a)}const h=a.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=ec(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push({type:"value",snapshotNode:ec(t)})}}(t,c,h),{viewCache:c,changes:h}}(e.processor_,o,t,n,s);var c,l;return c=e.processor_,l=a.viewCache,i(l.eventCache.getNode().isIndexed(c.filter.getIndex()),"Event snap not indexed"),i(l.serverCache.getNode().isIndexed(c.filter.getIndex()),"Server snap not indexed"),i(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,function(e,t,n,i){const r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const r=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Ya(e,r,"child_removed",t,i,n),Ya(e,r,"child_added",t,i,n),Ya(e,r,"child_moved",s,i,n),Ya(e,r,"child_changed",t,i,n),Ya(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}(e,a.changes,a.viewCache.eventCache.getNode(),null)}let Fc,jc;function Wc(e,t,n,r){const s=t.source.queryId;if(null!==s){const o=e.views.get(s);return i(null!=o,"SyncTree gave us an op for an invalid query."),Uc(o,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(Uc(s,t,n,r));return i}}function $c(e,t){let n=null;for(const i of e.views.values())n=n||Mc(i,t);return n}class Hc{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ic(null),this.pendingWriteTree_={visibleWrites:rc.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Bc(e,t,n,r,s){return function(e,t,n,r,s){i(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:s}),s&&(e.visibleWrites=sc(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,s),s?Kc(e,new Ka({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Vc(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));i(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=n&&mc(t,r.path)?s=!1:Jo(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?(function(e){e.visibleWrites=yc(e.allWrites,_c,Fo()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(r.snap?e.visibleWrites=ac(e.visibleWrites,r.path):so(r.children,(t=>{e.visibleWrites=ac(e.visibleWrites,qo(r.path,t))})),!0))}(e.pendingWriteTree_,t)){let t=new ic(null);return null!=r.snap?t=t.set(Fo(),!0):so(r.children,(e=>{t=t.set(new Uo(e),!0)})),Kc(e,new za(r.path,t,n))}return[]}function qc(e,t,n){return Kc(e,new Ka({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function zc(e,t,n){const i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=$c(n,Ko(e,t));if(i)return i}));return vc(i,t,r,n,!0)}function Kc(e,t){return Gc(t,e.syncPointTree_,null,gc(e.pendingWriteTree_,Fo()))}function Gc(e,t,n,i){if(zo(e.path))return Jc(e,t,n,i);{const r=t.get(Fo());null==n&&null!=r&&(n=$c(r,Fo()));let s=[];const o=jo(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Ec(i,o);s=s.concat(Gc(a,c,e,t))}return r&&(s=s.concat(Wc(r,e,i,n))),s}}function Jc(e,t,n,i){const r=t.get(Fo());null==n&&null!=r&&(n=$c(r,Fo()));let s=[];return t.children.inorderTraversal(((t,r)=>{const o=n?n.getImmediateChild(t):null,a=Ec(i,t),c=e.operationForChild(t);c&&(s=s.concat(Jc(c,r,o,a)))})),r&&(s=s.concat(Wc(r,e,i,n))),s}function Yc(e,t){return e.tagToQueryMap.get(t)}function Qc(e){const t=e.indexOf("$");return i(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Uo(e.substr(0,t))}}function Xc(e,t,n){const r=e.syncPointTree_.get(t);return i(r,"Missing sync point for query tag that we're tracking"),Wc(r,n,gc(e.pendingWriteTree_,t),null)}class Zc{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Zc(t)}node(){return this.node_}}class el{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=qo(this.path_,e);return new el(this.syncTree_,t)}node(){return zc(this.syncTree_,this.path_)}}const tl=function(e,t,n){return e&&"object"==typeof e?(i(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?nl(e[".sv"],t,n):"object"==typeof e[".sv"]?il(e[".sv"],t):void i(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},nl=function(e,t,n){if("timestamp"===e)return n.timestamp;i(!1,"Unexpected server value: "+e)},il=function(e,t,n){e.hasOwnProperty("increment")||i(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&i(!1,"Unexpected increment value: "+r);const s=t.node();if(i(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return"number"!=typeof o?r:o+r},rl=function(e,t,n){return sl(e,new Zc(t),n)};function sl(e,t,n){const i=e.getPriority().val(),r=tl(i,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const i=e,s=tl(i.getValue(),t,n);return s!==i.getValue()||r!==i.getPriority().val()?new ya(s,Na(r)):e}{const i=e;return s=i,r!==i.getPriority().val()&&(s=s.updatePriority(new ya(r))),i.forEachChild(va,((e,i)=>{const r=sl(i,t.getImmediateChild(e),n);r!==i&&(s=s.updateImmediateChild(e,r))})),s}}class ol{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function al(e,t){let n=t instanceof Uo?t:new Uo(t),i=e,r=jo(n);for(;null!==r;){const e=A(i.node.children,r)||{children:{},childCount:0};i=new ol(r,i,e),n=$o(n),r=jo(n)}return i}function cl(e){return e.node.value}function ll(e,t){e.node.value=t,fl(e)}function hl(e){return e.node.childCount>0}function ul(e,t){so(e.node.children,((n,i)=>{t(new ol(n,e,i))}))}function dl(e,t,n,i){n&&!i&&t(e),ul(e,(e=>{dl(e,t,!0,i)})),n&&i&&t(e)}function pl(e){return new Uo(null===e.parent?e.name:pl(e.parent)+"/"+e.name)}function fl(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===cl(e)&&!hl(e)}(n),r=R(e.node.children,t);i&&r?(delete e.node.children[t],e.node.childCount--,fl(e)):i||r||(e.node.children[t]=n.node,e.node.childCount++,fl(e))}(e.parent,e.name,e)}const gl=/[\[\].#$\/\u0000-\u001F\u007F]/,ml=/[\[\].#$\u0000-\u001F\u007F]/,_l=10485760,yl=function(e){return"string"==typeof e&&0!==e.length&&!gl.test(e)},vl=function(e){return"string"==typeof e&&0!==e.length&&!ml.test(e)},wl=function(e,t,n){const i=n instanceof Uo?new Yo(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Xo(i));if("function"==typeof t)throw new Error(e+"contains a function "+Xo(i)+" with contents = "+t.toString());if(Qs(t))throw new Error(e+"contains "+t.toString()+" "+Xo(i));if("string"==typeof t&&t.length>_l/3&&B(t)>_l)throw new Error(e+"contains a string greater than "+_l+" utf8 bytes "+Xo(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(so(t,((t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!yl(t)))throw new Error(e+" contains an invalid key ("+t+") "+Xo(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=B(t),Qo(e)}(i,t),wl(e,s,i),function(e){const t=e.parts_.pop();e.byteLength_-=B(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&r)throw new Error(e+' contains ".value" child '+Xo(i)+" in addition to actual children.")}},Il=function(e,t,n,i){if(!(i&&void 0===n||vl(n)))throw new Error(H(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')};class bl{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Tl(e,t){let n=null;for(let i=0;i<t.length;i++){const r=t[i],s=r.getPath();null===n||Go(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function Cl(e,t,n){Tl(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];r&&(t(r.path)?(El(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,(e=>Jo(e,t)||Jo(t,e)))}function El(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();Vs&&zs("event: "+n.toString()),lo(i)}}}class Sl{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new bl,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fa(),this.transactionQueueTree_=new ol,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function kl(e,t,n){if(e.stats_=Eo(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Ma(e.repoInfo_,((t,n,i,r)=>{Rl(e,t,n,i,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Al(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{P(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new ta(e.repoInfo_,t,((t,n,i,r)=>{Rl(e,t,n,i,r)}),(t=>{Al(e,t)}),(t=>{!function(e,t){so(t,((t,n)=>{Ol(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(t){const n=t.toString();return Co[n]||(Co[n]=new Ha(e.stats_,e.server_)),Co[n]}(e.repoInfo_),e.infoData_=new Ua,e.infoSyncTree_=new Hc({startListening:(t,n,i,r)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=qc(e.infoSyncTree_,t._path,o),setTimeout((()=>{r("ok")}),0)),s},stopListening:()=>{}}),Ol(e,"connected",!1),e.serverSyncTree_=new Hc({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,((n,i)=>{const s=r(n,i);Cl(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Pl(e){const t=e.infoData_.getNode(new Uo(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Nl(e){return(t=(t={timestamp:Pl(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function Rl(e,t,n,i,r){e.dataUpdateCount++;const s=new Uo(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){const t=D(n,(e=>Na(e)));o=function(e,t,n,i){const r=Yc(e,i);if(r){const i=Qc(r),s=i.path,o=i.queryId,a=Ko(s,t),c=ic.fromObject(n);return Xc(e,s,new Ga(qa(o),a,c))}return[]}(e.serverSyncTree_,s,t,r)}else{const t=Na(n);o=function(e,t,n,i){const r=Yc(e,i);if(null!=r){const i=Qc(r),s=i.path,o=i.queryId,a=Ko(s,t);return Xc(e,s,new Ka(qa(o),a,n))}return[]}(e.serverSyncTree_,s,t,r)}else if(i){const t=D(n,(e=>Na(e)));o=function(e,t,n){const i=ic.fromObject(n);return Kc(e,new Ga({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,s,t)}else{const t=Na(n);o=qc(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=Fl(e,s)),Cl(e.eventQueue_,a,o)}function Al(e,t){Ol(e,"connected",t),!1===t&&function(e){Ll(e,"onDisconnectEvents");const t=Nl(e),n=Fa();Wa(e.onDisconnect_,Fo(),((i,r)=>{const s=function(e,t,n,i){return sl(t,new el(n,e),i)}(i,r,e.serverSyncTree_,t);ja(n,i,s)}));let i=[];Wa(n,Fo(),((t,n)=>{i=i.concat(qc(e.serverSyncTree_,t,n));const r=Bl(e,t);Fl(e,r)})),e.onDisconnect_=Fa(),Cl(e.eventQueue_,Fo(),i)}(e)}function Ol(e,t,n){const i=new Uo("/.info/"+t),r=Na(n);e.infoData_.updateSnapshot(i,r);const s=qc(e.infoSyncTree_,i,r);Cl(e.eventQueue_,i,s)}function Dl(e){return e.nextWriteId_++}function xl(e,t,n,i,r){Ll(e,"set",{path:t.toString(),value:n,priority:i});const s=Nl(e),o=Na(n,i),a=zc(e.serverSyncTree_,t),c=rl(o,a,s),l=Dl(e),h=Bc(e.serverSyncTree_,t,c,l,!0);Tl(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),((n,i)=>{const s="ok"===n;s||Ys("set at "+t+" failed: "+n);const o=Vc(e.serverSyncTree_,l,!s);Cl(e.eventQueue_,t,o),function(e,t,n,i){t&&lo((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let r=e;i&&(r+=": "+i);const s=new Error(r);s.code=e,t(s)}}))}(0,r,n,i)}));const u=Bl(e,t);Fl(e,u),Cl(e.eventQueue_,u,[])}function Ll(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),zs(n,...t)}function Ml(e,t,n){return zc(e.serverSyncTree_,t,n)||ka.EMPTY_NODE}function Ul(e,t=e.transactionQueueTree_){if(t||Hl(e,t),cl(t)){const n=Wl(e,t);i(n.length>0,"Sending zero length transaction queue"),n.every((e=>0===e.status))&&function(e,t,n){const r=n.map((e=>e.currentWriteId)),s=Ml(e,t,r);let o=s;const a=s.hash();for(let e=0;e<n.length;e++){const r=n[e];i(0===r.status,"tryToSendTransactionQueue_: items in queue should all be run."),r.status=1,r.retryCount++;const s=Ko(t,r.path);o=o.updateChild(s,r.currentOutputSnapshotRaw)}const c=o.val(!0),l=t;e.server_.put(l.toString(),c,(i=>{Ll(e,"transaction put response",{path:l.toString(),status:i});let r=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(Vc(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();Hl(e,al(e.transactionQueueTree_,t)),Ul(e,e.transactionQueueTree_),Cl(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)lo(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{Ys("transaction at "+l.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}Fl(e,t)}}),a)}(e,pl(t),n)}else hl(t)&&ul(t,(t=>{Ul(e,t)}))}function Fl(e,t){const n=jl(e,t),r=pl(n);return function(e,t,n){if(0===t.length)return;const r=[];let s=[];const o=t.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let c=0;c<t.length;c++){const l=t[c],h=Ko(n,l.path);let u,d=!1;if(i(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,s=s.concat(Vc(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)d=!0,u="maxretry",s=s.concat(Vc(e.serverSyncTree_,l.currentWriteId,!0));else{const n=Ml(e,l.path,o);l.currentInputSnapshot=n;const i=t[c].update(n.val());if(void 0!==i){wl("transaction failed: Data returned ",i,l.path);let t=Na(i);"object"==typeof i&&null!=i&&R(i,".priority")||(t=t.updatePriority(n.getPriority()));const r=l.currentWriteId,a=Nl(e),c=rl(t,n,a);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=c,l.currentWriteId=Dl(e),o.splice(o.indexOf(r),1),s=s.concat(Bc(e.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),s=s.concat(Vc(e.serverSyncTree_,r,!0))}else d=!0,u="nodata",s=s.concat(Vc(e.serverSyncTree_,l.currentWriteId,!0))}Cl(e.eventQueue_,n,s),s=[],d&&(t[c].status=2,a=t[c].unwatcher,setTimeout(a,Math.floor(0)),t[c].onComplete&&("nodata"===u?r.push((()=>t[c].onComplete(null,!1,t[c].currentInputSnapshot))):r.push((()=>t[c].onComplete(new Error(u),!1,null)))))}var a;Hl(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)lo(r[e]);Ul(e,e.transactionQueueTree_)}(e,Wl(e,n),r),r}function jl(e,t){let n,i=e.transactionQueueTree_;for(n=jo(t);null!==n&&void 0===cl(i);)i=al(i,n),n=jo(t=$o(t));return i}function Wl(e,t){const n=[];return $l(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function $l(e,t,n){const i=cl(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);ul(t,(t=>{$l(e,t,n)}))}function Hl(e,t){const n=cl(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,ll(t,n.length>0?n:void 0)}ul(t,(t=>{Hl(e,t)}))}function Bl(e,t){const n=pl(jl(e,t)),i=al(e.transactionQueueTree_,t);return function(e,t){let n=e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(i,(t=>{Vl(e,t)})),Vl(e,i),dl(i,(t=>{Vl(e,t)})),n}function Vl(e,t){const n=cl(t);if(n){const r=[];let s=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(i(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(i(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),s=s.concat(Vc(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?ll(t,void 0):n.length=o+1,Cl(e.eventQueue_,pl(t),s);for(let e=0;e<r.length;e++)lo(r[e])}}const ql=function(e,t){const n=zl(e),i=n.namespace;"firebase.com"===n.domain&&Js(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||Js("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ys("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new wo(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new Uo(n.pathString)}},zl=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(r=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Ys(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class Kl{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return zo(this._path)?null:Ho(this._path)}get ref(){return new Gl(this._repo,this._path)}get _queryIdentifier(){const e=La(this._queryParams),t=io(e);return"{}"===t?"default":t}get _queryObject(){return La(this._queryParams)}isEqual(e){if(!((e=q(e))instanceof Kl))return!1;const t=this._repo===e._repo,n=Go(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Gl extends Kl{constructor(e,t){super(e,t,new Da,!1)}get parent(){const e=Vo(this._path);return null===e?null:new Gl(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}function Jl(e,t){return(e=q(e))._checkNotDeleted("ref"),void 0!==t?function(e,t){var n,i,r,s;return null===jo((e=q(e))._path)?(n="child",i="path",s=!1,(r=t)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),Il(n,i,r,s)):Il("child","path",t,!1),new Gl(e._repo,qo(e._path,t))}(e._root,t):e._root}function Yl(e,t){(function(e,t){if(".info"===jo(t))throw new Error(e+" failed = Can't modify data under /.info/")})("set",(e=q(e))._path),function(e,t,n,i){i&&void 0===t||wl(H(e,"value"),t,n)}("set",t,e._path,!1);const n=new _;return xl(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}!function(e){i(!Fc,"__referenceConstructor has already been defined"),Fc=e}(Gl),function(e){i(!jc,"__referenceConstructor has already been defined"),jc=e}(Gl);const Ql={};function Xl(e,t,n,i,r){let s=i||e.options.databaseURL;void 0===s&&(e.options.projectId||Js("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),zs("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=ql(s,r),l=c.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s=`http://${a}?ns=${l.namespace}`,c=ql(s,r),l=c.repoInfo):o=!c.repoInfo.secure;const h=r&&o?new fo(fo.OWNER):new po(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!yl(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),vl(e)}(n))throw new Error(H(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",c),zo(c.path)||Js("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,i){let r=Ql[t.name];r||(r={},Ql[t.name]=r);let s=r[e.toURLString()];return s&&Js("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Sl(e,false,n,i),r[e.toURLString()]=s,s}(l,e,h,new uo(e,n));return new Zl(u,e)}class Zl{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(kl(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Gl(this._repo,Fo())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=Ql[t];n&&n[e.key]===e||Js(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Js("Cannot call "+e+" on a deleted database.")}}const eh={".sv":"timestamp"};function th(){return eh}ta.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},ta.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},xs=at,nt(new z("database",((e,{instanceIdentifier:t})=>Xl(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),ht(Os,Ds,void 0),ht(Os,Ds,"esm2017");const nh="https://helloworld-331777483172.us-west1.run.app/processes",ih={apiKey:"AIzaSyAr5BXnNexqOGuVoXikWZS4hSUKFh8cmDA",authDomain:"interview-proctor.firebaseapp.com",databaseURL:"https://interview-proctor-default-rtdb.firebaseio.com",projectId:"interview-proctor",storageBucket:"interview-proctor.firebasestorage.app",messagingSenderId:"124879970402",appId:"1:124879970402:web:80ce4ae7b862d6be7db13b",measurementId:"G-1SCPSVG9F2"};document.addEventListener("DOMContentLoaded",(()=>{console.log("DOM Loaded. Initializing Addon with Role Selection and Timeline.");const e=document.getElementById("status"),t=document.getElementById("error-message"),i=document.getElementById("collect-data-button"),r=document.body,s=document.getElementById("role-selection"),o=document.getElementById("host-button"),a=document.getElementById("login-section"),c=document.getElementById("login-google"),h=document.getElementById("login-facebook"),u=(document.getElementById("login-microsoft"),document.getElementById("login-error-message")),d=document.getElementById("guest-button"),p=document.getElementById("guest-connection-status"),g=document.getElementById("extension-link"),m=document.getElementById("daemon-link"),_=document.getElementById("host-guest-name"),y=document.getElementById("host-overall-status-icon"),v=document.getElementById("host-last-update"),w=document.getElementById("host-processes-section"),I=document.getElementById("host-processes-status"),b=document.getElementById("host-processes-list"),T=document.getElementById("host-tabs-section"),C=document.getElementById("host-tabs-status"),E=document.getElementById("host-tabs-list"),S=document.getElementById("host-screenshot-section"),k=document.getElementById("host-screenshot-status"),P=document.getElementById("host-screenshot-details"),N=document.getElementById("host-timeline-section"),R=document.getElementById("host-timeline-list");let A=!1,O=!1,D=null,L=null,M=null,U=null,F=null,j=null;const W=ct(ih),$=(function(e=lt()){const t=it(e=q(e),tn);t.isInitialized()?t.getImmediate():function(e,t={}){const n=it(e,tn);if(n.isInitialized()){const e=n.getImmediate();if(x(t,n.getOptions()))return e;throw sn.create("already-initialized")}n.initialize({options:t})}(e)}(W),Ns(W)),H=function(e=lt(),t){const n=it(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=(()=>{const e=f("database");if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),n]:[e.substring(0,t),n]})();e&&function(e,t,n,i={}){(e=q(e))._checkNotDeleted("useEmulator");const r=`${t}:${n}`,s=e._repoInternal;if(e._instanceStarted){if(r===e._repoInternal.repoInfo_.host&&x(i,s.repoInfo_.emulatorOptions))return;Js("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&Js('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new fo(fo.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(s)),""].join(".")}(i.mockUserToken,e.app.options.projectId);o=new fo(t)}!function(e,t,n,i){e.repoInfo_=new wo(t,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(e.authTokenProvider_=i)}(s,r,i,o)}(n,...e)}return n}(W),B=new ur,V=new hr;async function z(){null==D&&(D=await n.addon.createAddonSession({cloudProjectNumber:"331777483172"})),null==L&&(L=await D.createSidePanelClient(),M=await L.getMeetingInfo(),console.log("Meeting ID:",M.meetingId),console.log("Meeting Code:",M.meetingCode))}function K(t){e.textContent=`Status: ${t}`}function G(e){e?(t.textContent=e,t.style.display="block"):(t.textContent="",t.style.display="none")}function J(e){const t=document.createElement("li");return t.textContent=e,t}function Y(){if(!A||!O)return;if(!U)return _.textContent="Guest: ---",y.textContent="⚪",y.className="status-icon unknown",v.textContent="Last Update: Waiting for guest...",I.textContent="---",I.className="status-text unknown",b.innerHTML="",C.textContent="---",C.className="status-text unknown",E.innerHTML="",k.textContent="---",k.className="status-text unknown",P.textContent="",R.innerHTML="<li><i>Waiting for guest data...</i></li>",w.style.display="none",T.style.display="none",S.style.display="none",void(N.style.display="none");_.textContent=`Guest: ${U.userName||"Unknown"}`,v.textContent=`Last Update: ${U.collectionTime?new Date(U.collectionTime).toLocaleString():"N/A"}`;let e="ok",t="🟢",n="ok";U.error?(e="alert",G(`Guest Daemon Error: ${U.error}`)):U.status&&"ok"!==U.status&&"success"!==U.status?(e="warning",G(null)):G(null);const i=U.flaggedProcesses||[];b.innerHTML="",i.length>0?(I.textContent="FLAGGED",I.className="status-text warning",i.forEach((e=>{const t=`${e.processName} (PID: ${e.pid||"N/A"})${e.title?` - ${e.title}`:""}`;b.appendChild(J(t))})),w.style.display="block","ok"===e&&(e="warning")):(I.textContent="OK",I.className="status-text ok",b.innerHTML="<li><i>No flagged processes.</i></li>",w.style.display="block");const r=U.flaggedTabs||[];E.innerHTML="",r.length>0?(C.textContent="FLAGGED",C.className="status-text warning",r.forEach((e=>{const t=`${e.title||"Untitled Tab"} - ${e.url||"N/A"}`;E.appendChild(J(t))})),T.style.display="block","ok"===e&&(e="warning")):(C.textContent="OK",C.className="status-text ok",E.innerHTML="<li><i>No restricted tabs detected.</i></li>",T.style.display="block");const s=U.screenshot||[];P.textContent="",s.length>0?(k.textContent="CAPTURED",k.className="status-text ok",s.forEach((e=>{const t=`Display ${e.displayId||"N/A"}: ${e.imageSize||e.originalSize||"Size unknown"} (${e.format||"format unknown"})`,n=document.createElement("p");n.textContent=t,P.appendChild(n)})),S.style.display="block"):(k.textContent="N/A",k.className="status-text unknown",P.textContent="No screenshots received in this update.",S.style.display="block"),R.innerHTML="";const o=U.collectionTime?new Date(U.collectionTime).toLocaleTimeString():"No timestamp";let a=`Update received. Status: ${U.status||"N/A"}.`;if(U.error)a+=` Error: ${U.error}`;else{const e=[];i.length>0&&e.push(`${i.length} flagged process(es)`),r.length>0&&e.push(`${r.length} flagged tab(s)`),e.length>0?a+=` Issues: ${e.join(", ")}.`:a+=" No issues detected."}const c=document.createElement("li"),l=document.createElement("span"),h=document.createElement("span");l.className="timestamp",l.textContent=`[${o}]`,h.className="description",h.textContent=a,c.appendChild(l),c.appendChild(h),R.appendChild(c),N.style.display="block","alert"===e?(t="🔴",n="alert"):"warning"===e?(t="🟡",n="warning"):(t="🟢",n="ok"),y.textContent=t,y.className=`status-icon ${n}`}async function Q(){if(!A||!O||!M?.meetingId)return void console.warn("Host fetch skipped: Conditions not met (isHost, roleSelected, meetingId).");const e=M.meetingId;console.log(`Host fetching data for meetingId: ${e}...`),K("Host mode fetching data...");const t=new URL(nh);t.searchParams.append("meetingId",e);try{const n=await fetch(t.toString(),{method:"GET",mode:"cors",cache:"no-cache"});if(!n.ok)throw new Error(`HTTP error ${n.status}`);const i=await n.json();if(console.log(`Host received data for meeting ${e}:`,i),"object"!=typeof i||null===i)throw console.error("Received unexpected data format from server:",i),new Error("Invalid data format received from server");{const t=Object.keys(i);if(t.length>0){const e=t[0];U=i[e],console.log(`Displaying data for first candidate found: ${e}`),Y(),K(`Host mode listening. Displaying data for ${U.userName||e}. Last fetch: ${(new Date).toLocaleTimeString()}`)}else console.log(`No guest data found for meeting ${e} yet.`),U=null,Y(),K(`Host mode listening. Waiting for guest data in meeting ${e}...`)}}catch(t){console.error(`Error fetching data for meeting ${e}:`,t),G(`Network error fetching data: ${t.message}`),K("Network Error (GET)")}}async function X(e){if(O)console.warn("Role already selected; no need to run this again.");else{if(O=!0,A=e,console.log("Role selected: "+(A?"Host":"Guest")),G(null),s.style.display="none",r.classList.add("role-selected"),A){r.classList.add("host-mode"),r.classList.remove("guest-mode");const e=$.currentUser;if(e&&M){const t=e.uid,n=e.displayName||"Unknown Host";j=crypto.randomUUID();const i=th();Yl(Jl(H,`users/${t}/sessions/${j}`),{startTime:i,meetingId:M.meetingId,meetingCode:M.meetingCode,role:"interviewer"}).catch((e=>console.error("Firebase: Error writing user session data:",e))),Yl(Jl(H,`sessions/${j}/interviewers/${t}`),{name:n,joinTime:i}).catch((e=>console.error("Firebase: Error writing interviewer data:",e))),console.log(`Firebase: Host data written for session ${j}`)}else console.warn("Firebase: User not logged in or meetingInfo not available, skipping host data write.");i&&(i.style.display="block")}else r.classList.add("guest-mode"),r.classList.remove("host-mode");M?console.log("meetingId: ",M.meetingId," meetingCode: ",M.meetingCode):console.log("meetingInfo is still null"),K("Initializing codoing session...");try{if(console.log("Make sure the sidePanelClient has initialized..."),L||(console.log("The addon session and side panel has not been initialed. doing now..."),await z()),console.log("The side panel has started/joined."),A)L.startActivity({sidePanelUrl:"https://binp.github.io/addon/src/SidePanel.html"}),K("Host mode active. Fetching initial data..."),Y(),Q(),F||(F=setInterval(Q,15e3));else{const e="https://meet.google.com";console.log("Guest sending 'addonOpened' message to target:",e),window.top.postMessage({type:"addonOpened"},e),p.textContent="Status: Waiting for connection from extension...",K("Guest mode active."),g.href="https://binp.github.io",m.href="https://binp.github.io"}}catch(e){console.error("Error starting collaboration:",e),G(`Collaboration failed: ${e.message||e}`),K("Collaboration Error"),O=!1,r.className=""}}}function Z(e){if("https://meet.google.com"!==e.origin)return;const t=e.data;if(console.log("Addon received message from parent window:",t),!A&&O&&"proctorUpdate"===t?.type){console.log("Guest received process update from extension:",t.payload),p.textContent=`Status: Connected (Last update: ${(new Date).toLocaleTimeString()})`,K(`Process info received (${t.payload?.length||0}). Sending to server...`);const e=t.payload.candidateInfo,n=$.currentUser;n&&M?(e.userId=n.uid,e.userName=n.displayName||"Unknown Guest",e.meetingId=M.meetingId,e.meetingCode=M.meetingCode):(console.warn("Guest: User not logged in or meetingInfo not available for enriching candidateInfo."),e.userId="guest_fallback_uid",e.userName="Unknown Guest",e.meetingId=M?.meetingId||"unknown_meeting_id",e.meetingCode=M?.meetingCode||"unknown_meeting_code"),console.log("Send the payload to the backend server: ",e),fetch(nh,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{e.success?(console.log("Successfully POSTed data to server:",e),K("Guest info sent."),p.textContent="Guest info sent. Waiting for next update..."):(console.error("Server returned error:",e.error),p.textContent=`Status: Error sending data! ${e.error}`,K("Server Error (POST)"))})).catch((e=>{console.error("Error POSTing data to server:",e),K("Network Error (POST)"),p.textContent="Error sending process info."}))}else A||!O||"daemonError"!==t?.type&&"daemonDisconnected"!==t?.type||(console.warn("Received daemon status from extension:",t.type,t.data),K("Extension Error"),p.textContent=`Extension reported an error: ${t.type}.`)}function ee(e){e?(u.textContent=e,u.style.display="block"):(u.textContent="",u.style.display="none")}!function(e){q(e).onAuthStateChanged((async e=>{e?(console.log("User is signed in:",e),ee(null),r.classList.add("logged-in"),a.style.display="none",s.style.display="flex",await z(),K("Please select your role above.")):(console.log("User is signed out"),r.classList.remove("logged-in"),r.classList.remove("role-selected","host-mode","guest-mode"),a.style.display="flex",s.style.display="none",K("Please log in to continue."))}),void 0,void 0)}($),c.addEventListener("click",(()=>{Xr($,B).then((e=>{const t=e.user;console.log("Google sign-in successful:",t)})).catch((e=>{console.error("Google sign-in error:",e),ee("Google login failed. "+e.message)}))})),h.addEventListener("click",(()=>{Xr($,V).then((e=>{const t=e.user;console.log("Facebook sign-in successful:",t)})).catch((e=>{console.error("Facebook sign-in error:",e),ee("Facebook login failed. "+e.message)}))})),o.addEventListener("click",(()=>X(!0))),d.addEventListener("click",(()=>X(!1))),window.addEventListener("message",Z),z(),i&&i.addEventListener("click",(()=>async function(e){if(!$.currentUser||!j)return void console.warn("sendCommandToSession: User not logged in or session not initialized.");const t=th(),n=Jl(H,`sessions/${j}/commands`);try{await Yl(n,{command:e,time:t}),console.log(`sendCommandToSession: Sent '${e}' command to session ${j}`)}catch(e){console.error("sendCommandToSession: Error sending command:",e)}}("collect"))),window.addEventListener("unload",(()=>{window.removeEventListener("message",Z),F&&clearInterval(F)}))})),helloWorld={}})();